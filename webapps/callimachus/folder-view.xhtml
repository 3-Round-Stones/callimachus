<?xml version="1.0" encoding="UTF-8" ?>
<?xml-stylesheet type="text/xsl" href="/layout/template.xsl"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
	xmlns:dcterms="http://purl.org/dc/terms/"
	xmlns:calli="http://callimachusproject.org/rdf/2009/framework#" xmlns:audit="http://www.openrdf.org/rdf/2009/auditing#">
<head>
	<title about="?this">{rdfs:label}</title>
	<link href="?feed" type="application/atom+xml" rel="alternate" title="ATOM Feed" />
	<link rel="stylesheet" href="/layout/jquery-ui.css" />
	<style type="text/css">
		.filecol { width:100% }
		.ui-grid table tbody td.filecell { text-align: left }

		/* Grid
		----------------------------------*/
		.ui-grid { font-size:small}
		.ui-grid .ui-grid-content { width: 100%; border-collapse: collapse; border-spacing:0; }
		.ui-grid table thead th { white-space:nowrap; }
		.ui-grid table tbody td { text-align: right; white-space:nowrap; }
		.ui-grid table tbody td, .ui-grid .ui-grid-header, .ui-grid table thead a { padding: .4em;  }
		.ui-grid .ui-grid-header, .ui-grid .ui-grid-footer { padding: .8em .4em; text-align: center; }
		.ui-grid .ui-grid-footer { background-image: none; font-weight: normal; text-align: left; }
		.ui-grid table thead a { display: block;  }
		.ui-grid .ui-icon { float: right; }
	</style>
	<script type="text/javascript">
		(function($){
			function createTextCell(text, url, src) {
				var td = $('<td/>');
				td.addClass('ui-widget-content');
				td.addClass('filecell');
				var a = $('<a/>');
				if (url) {
					a.attr('href', url);
					a.addClass('view');
				}
				a.text(text);
				if (src) {
					var img = $('<img/>');
					img.addClass('icon');
					img.attr('src', src);
					a.prepend(img);
				}
				td.append(a);
				return td;
			}
			function createTimeCell(text) {
				var td = $('<td/>');
				td.addClass('ui-widget-content');
				td.addClass('timecell');
				if (text) {
					var time = $('<time/>');
					time.addClass("abbreviated");
					time.text(text);
					td.append(time);
				}
				return td;
			}
			function createPermissionCell(entry, tagName) {
				var td = $('<td/>');
				td.addClass('ui-widget-content');
				var tags = entry.children().filter(function(){return this.tagName==tagName});
				tags.each(function() {
					var uri = $(this).children('uri').text();
					var name = $(this).children('name').text();
					var a = $('<a/>');
					if (uri) {
						a.attr('href', uri);
					}
					if (name) {
						a.text(name);
					} else {
						a.text(uri);
					}
					td.append(' ');
					td.append(a);
				});
				return td;
			}
			var url = $('link[type="application/atom+xml"]').attr('href');
			jQuery.get(url, function(doc) {
				jQuery(function() {
					var tbody = $('<tbody/>');
					tbody.attr('id', 'tfiles');
					var feed = $(doc).children('feed');
					var totalEntries = 0;
					feed.children('entry').each(function() {
						var entry = $(this);
						totalEntries++;
						if (!entry.children('link[type="application/atom+xml"]').length) {
							var tr = $('<tr/>');
							var icon = entry.children('icon').text();
							var title = entry.children('title').text();
							var link = entry.children('link').attr('href');
							tr.append(createTextCell(title, link, icon));
							tr.append(createTimeCell(entry.children('updated').text()));
							tr.append(createPermissionCell(entry, 'calli:reader'));
							tr.append(createPermissionCell(entry, 'contributor'));
							tr.append(createPermissionCell(entry, 'calli:editor'));
							tr.append(createPermissionCell(entry, 'calli:administrator'));
							tbody.append(tr);
						}
					});
					$('#tfiles').replaceWith(tbody);
					var totalResults = feed.children().filter(function(){return this.tagName=='openSearch:totalResults'}).text();
					$('#totalResults').text(totalResults);
					$('#totalEntries').text(totalEntries);
				});
			});
		})(jQuery);
	</script>
</head>
<body about="?this">
	<ul class="optional aside">
		<li>
			<label>Create a new...</label>
			<ul rel="rdf:type">
				<li about="?type" typeof="calli:Creatable" rel="calli:creates" resource="?class">
					<img about="?class" rel="calli:icon" resource="?icon" src="{?icon}"/>
					<a href="?create={?class}" property="rdfs:label" content="?clabel">
						{?clabel}
					</a>
				</li>
			</ul>
		</li>
	</ul>
	<ul class="optional aside">
		<li rel="dcterms:isPartOf">
			<div about="?parent">
				<a class="view" href="?parent" property="rdfs:label" content="?plabel">Up to {?plabel}</a>
			</div>
		</li>
	</ul>
	<ul class="optional aside">
		<li property="rdfs:comment" />
	</ul>
	<div class="ui-grid ui-widget ui-widget-content ui-corner-all auto-expand">
		<div class="ui-grid-header ui-widget-header ui-corner-top" property="rdfs:label"></div>
		<table class="ui-grid-content ui-widget-content">
			<colgroup class="filecol" />
			<thead>
				<tr>
					<th class="ui-state-default"><a><span class="ui-icon ui-icon-triangle-1-s" title="sort ascending"></span> File</a></th>
					<th class="ui-state-default"><a><span class="ui-icon ui-icon-triangle-1-s" title="sort ascending"></span> Updated</a></th>
					<th class="ui-state-default"><a><span class="ui-icon ui-icon-triangle-1-s" title="sort ascending"></span> Readers</a></th>
					<th class="ui-state-default"><a><span class="ui-icon ui-icon-triangle-1-s" title="sort ascending"></span> Contributors</a></th>
					<th class="ui-state-default"><a><span class="ui-icon ui-icon-triangle-1-s" title="sort ascending"></span> Editors</a></th>
					<th class="ui-state-default"><a><span class="ui-icon ui-icon-triangle-1-s" title="sort ascending"></span> Administrators</a></th>
				</tr>
			</thead>
			<tbody id="tfolders" rev="dcterms:isPartOf">
				<tr about="?folder" typeof="calli:Folder">
					<td class="ui-widget-content filecell">
						<a class="view" href="?folder" property="rdfs:label" content="?flabel"><img class="icon" src="/callimachus/folder.png" />{?flabel}</a>
					</td>
					<td class="ui-widget-content timecell">
						<span rel="audit:revision" resource="?revision">
							<time class="abbreviated" property="audit:committedOn"/>
						</span>
					</td>
					<td class="ui-widget-content">
						<a rel="calli:reader" href="?reader">
							<span property="rdfs:label"/>
						</a>
					</td>
					<td class="ui-widget-content">
						<a rel="calli:contributor" href="?contributor">
							<span property="rdfs:label"/>
						</a>
					</td>
					<td class="ui-widget-content">
						<a rel="calli:editor" href="?editor">
							<span property="rdfs:label"/>
						</a>
					</td>
					<td class="ui-widget-content">
						<a rel="calli:administrator" href="?administrator">
							<span property="rdfs:label"/>
						</a>
					</td>
				</tr>
			</tbody>
			<tbody id="tfiles">
			</tbody>
		</table>
		<div class="ui-grid-footer ui-widget-header ui-corner-bottom">
			<div class="ui-grid-results">Showing results <span id="totalEntries" /> of <span id="totalResults" /></div>
		</div>
	</div>
</body>
</html>

