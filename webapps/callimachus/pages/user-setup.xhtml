<?xml version="1.0" encoding="UTF-8" ?>
<?xml-stylesheet type="text/xsl" href="/callimachus/manifest?template"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
	xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
	xmlns:calli="http://callimachusproject.org/rdf/2009/framework#"
	xmlns:xsd="http://www.w3.org/2001/XMLSchema#">
<head>
	<title>Administrator Account</title>
	<link type="text/css" href="/callimachus/styles/jquery.validate.password.css" rel="stylesheet" />	
	<script type="text/javascript" src="/callimachus/scripts/jquery.validate.password.js">
	</script>
	<script type="text/javascript" src="/callimachus/scripts/md5.js">
	</script>
	<script type="text/javascript">//<![CDATA[
		$(document).ready(function() {
			$("#form").validate({submitHandler: userSetup});
		});
		function userSetup(form) {
			var label = $("#label").val();
			var name = $("#name").val();
			var realm = $("#realm-link")[0].href;
			var value = $("#password").val();
			var encoded = hex_md5(name + ':' + realm + ':' + value);
			var data = {name: name, label: label, algorithm: 'MD5', encoded: encoded};
			try {
				var xhr = jQuery.post(location.href, data, function(data, textStatus) {
					var event = jQuery.Event("calliLogin");
					event.username = name;
					event.password = value;
					event.location = "/";
					$(document).trigger(event);
				});
			} catch (e) {
				$(form).trigger("calliError", e.description ? e.description : e);
				return false;
			}
			return false;
		}
		// ]]>
	</script>
</head>
<body>
	<h1>Initial Setup</h1>
	<ul class="aside">
		<li>The username cannot be changed once created.</li>
		<li>Please provide your full name for identification.</li>
		<li>The password can be changed using the settings link.</li>
		<li><label>Choosing a good password:</label>
			<ul>
				<li>Never share your password with colleagues, friends, or family members, even when asked</li>
				<li>Don't choose passwords that relate to you as a person</li>
				<li>Don't use your last name, your spouse's name, the name of your pet, the date of birth, your favourite flower etc.</li>
				<li>Use complex multiple word pass phrases, never a single word</li>
			</ul>
		</li>
	</ul>
	<form id="form" method="POST" action="" autocomplete="off" >
		<span style="display:none">
			<a id="realm-link" href="/" />
		</span>
		<label for="name">Username</label>
		<div>
			<input id="name" name="name" type="text" class="auto-expand" required="required" autofocus="autofocus" />
		</div>
		<label for="label">Full name</label>
		<div>
			<input id="label" name="label" type="text" class="auto-expand" required="required" />
		</div>
		<label for="password">Password</label>
		<div>
			<input id="password" type="password" password="#username" class="required password" onkeyup="$(this).valid()" />
			<div class="password-meter">
				<label for="password" class="password-meter-message" />
				<div class="password-meter-bg">
					<div class="password-meter-bar"></div>
				</div>
			</div>
		</div>
		<button id="submit" type="submit">Create</button>
		<button id="cancel" type="button" onclick="location.replace('/')">Cancel</button>
	</form>
</body>
</html>
