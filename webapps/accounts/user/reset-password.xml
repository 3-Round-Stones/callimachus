<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../../layout/template.xsl"?>
<html>
	<head>
		<title>Reset Password</title>
		<script>
			// <![CDATA[
			function parameter(name) {
				var regex = new RegExp("[\\?&]"+name+"=([^&#]*)")
				var m = regex.exec(location.href)
				return m ? m[1] : null
			}
			function init() {
				if (parameter("token")) {
					document.getElementById("nonce").value = parameter("nonce")
					document.getElementById("token").value = parameter("token")
				}
			}
			function resetPassword(url, elements) {
				var req = new XMLHttpRequest()
				req.open("POST", url, true)
				req.setHeader("Content-Type", "application/x-www-form-urlencoded")
				req.onreadystatechange = function() {
					if (req.readyState == 4) {
						if (req.status < 300) {
							document.getElementById("success").style.display = "block"
						} else {
							document.getElementById("error").textContent = req.statusText
							document.getElementById("error").innerText = req.statusText
						}
					}
				}
				var encoded = []
				for (var i = 0; i < elements.length; i++) {
					if (encoded.length) {
						encoded[encoded.length] = '&'
					}
					encoded[encoded.length] = encodeURIComponent(elements[i].name)
					encoded[encoded.length] = '='
					encoded[encoded.length] = encodeURIComponent(elements[i].value)
				}
				req.send(encoded.join(''))
			}
			// ]]>
		</script>
	</head>
	<body class="user" onload="init()">
		<form id="reset-form" method="POST" action="?reset-password"
				onsubmit="resetPassword(action,elements)">
			<input type="hidden" name="nonce" id="nonce" />
			<input type="hidden" name="token" id="token" />
			<p>Are you sure you want to reset your password?</p>
			<button type="button" onclick="location.href='?view'">No, Keep Password</button>
			<button type="submit">Yes, Reset Password</button>
		</form>
		<p id="success" style="display:none">Please follow the instructions sent in an email to proceed.</p>
		<p id="error"/>
	</body>
</html>
