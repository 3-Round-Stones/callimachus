@prefix xsd:<http://www.w3.org/2001/XMLSchema#>.
@prefix rdf:<http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs:<http://www.w3.org/2000/01/rdf-schema#>.
@prefix owl:<http://www.w3.org/2002/07/owl#>.
@prefix msg:<http://www.openrdf.org/rdf/2011/messaging#>.
@prefix audit:<http://www.openrdf.org/rdf/2009/auditing#>.
@prefix calli:<http://callimachusproject.org/rdf/2009/framework#>.
@prefix :<#>.

:MigrateMaintainers owl:equivalentClass calli:Started;
	msg:imports <java:org.openrdf.model.vocabulary>;
	msg:script """
		var con = this.objectConnection;
		var vf = con.valueFactory;
		var calli = "http://callimachusproject.org/rdf/2009/framework#";

		function migrate(from, to) {
			var reviewer = vf.createURI(calli, from);
			var reader = vf.createURI(calli, to);
			var reviewers = con.getStatements(null, reviewer, null, true, []);
			try {
				while (reviewers.hasNext()) {
					var st = reviewers.next();
					if (!con.hasStatement(st.subject, reader, null, true, [])) {
						java.lang.System.err.println("Migrating authorization " + st.subject);
						con.add(st.subject, reader, st.object, []);
					}
				}
			} finally {
				reviewers.close();
			}
		}

		migrate("reviewer",	    "reader");
		migrate("scribe",       "contributor");
		migrate("curator",      "editor");
		migrate("conservator",  "editor");
		migrate("maintainer",   "administrator");
		proceed();
	""".

