<?xml version="1.0" encoding="UTF-8" ?>
<?xml-stylesheet type="text/xsl" href="/manifest?layout"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:calli="http://callimachusproject.org/rdf/2009/framework#"
	xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#">
	<head>
		<title>Reset Password</title>
		<script type="text/javascript">
			// <![CDATA[
			function parameter(name) {
				var regex = new RegExp("[\\?&]"+name+"=([^&#]*)")
				var m = regex.exec(location.href)
				return m ? m[1] : null
			}
			function init() {
				if (parameter("token")) {
					document.getElementById("nonce").value = parameter("nonce")
					document.getElementById("token").value = parameter("token")
				}
			}
			function resetPassword(url, elements) {
				var encoded = []
				for (var i = 0; i < elements.length; i++) {
					if (encoded.length) {
						encoded[encoded.length] = '&'
					}
					encoded[encoded.length] = encodeURIComponent(elements[i].name)
					encoded[encoded.length] = '='
					encoded[encoded.length] = encodeURIComponent(elements[i].value)
				}
				document.getElementById("success").style.display = "none"
				jQuery.ajax({type: "POST", url: url, data: encoded.join(''),
					success: function() {
						document.getElementById("success").style.display = "block"
					}
				});
			}
			// ]]>
		</script>
	</head>
	<body class="user" onload="init()" about="?this">
		<h1><a href="?this" property="rdfs:label" /></h1>
		<p property="calli:email" />
		<pre class="wiki" property="rdfs:comment" />
		<form id="reset-form" method="POST" action="?resetpassword"
				onsubmit="resetPassword(action,elements);return false">
			<input type="hidden" name="nonce" id="nonce" />
			<input type="hidden" name="token" id="token" />
			<p>Are you sure you want to reset your password?</p>
			<div>
				<button type="submit">Yes, reset password</button>
				<button type="button" onclick="location.replace('/')">No, keep existing password</button>
			</div>
		</form>
		<p id="success" style="display:none">Please follow the instructions sent in an email to proceed.</p>
	</body>
</html>
