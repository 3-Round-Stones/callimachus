@prefix xsd:<http://www.w3.org/2001/XMLSchema#>.
@prefix rdf:<http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs:<http://www.w3.org/2000/01/rdf-schema#>.
@prefix owl:<http://www.w3.org/2002/07/owl#>.
@prefix skos:<http://www.w3.org/2004/02/skos/core#>.
@prefix msg:<http://www.openrdf.org/rdf/2011/messaging#>.
@prefix calli:<http://callimachusproject.org/rdf/2009/framework#>.
@prefix audit:<http://www.openrdf.org/rdf/2009/auditing#>.
@prefix :<#>.

<> a <SchemaGraph>.

<Menu> rdfs:subClassOf <Viewable>, <Editable>, calli:Menu;
	rdfs:isDefinedBy </callimachus>;
	calli:view <menu-view.xhtml>;
	calli:edit <menu-edit.xhtml>.

:GetMenuItems rdfs:subClassOf msg:Message;
	rdfs:subClassOf [owl:onProperty msg:target; owl:allValuesFrom <Menu>];
	rdfs:subClassOf [owl:onProperty msg:object; owl:allValuesFrom <java:java.io.InputStream>];
	calli:method "GET";
	calli:query "items";
	calli:type "application/sparql-results+xml";
	calli:transform :TransformMenu;
	msg:sparql  """
		SELECT DISTINCT ?heading ?label ?link ?group
		WHERE {
			{
				$this calli:item ?item
			} UNION {
				$this calli:item [rdfs:label ?heading; calli:item ?item]
			}
			?item rdfs:label ?label.
			OPTIONAL {
				?item calli:position ?position
			}
			OPTIONAL {
				?item calli:link ?link
			}
			OPTIONAL {
				?item calli:group ?group
			}
		}
		ORDER BY ?position ?label
		LIMIT 100
	""".

:TransformMenu rdfs:subClassOf msg:Message;
	rdfs:subClassOf [owl:onProperty msg:target; owl:allValuesFrom <Menu>];
	rdfs:subClassOf [owl:onProperty msg:object; owl:allValuesFrom <java:java.io.InputStream>];
	calli:type "application/xhtml+xml";
	msg:xslt <transforms/menu.xsl>.

:xml a owl:ObjectProperty; a owl:FunctionalProperty;
	rdfs:domain :TransformMenu;
	rdfs:range <java:java.io.InputStream>;
	calli:type "application/sparql-results+xml".

:PostEditMenu owl:intersectionOf (<toolbox/edit.ttl#PostEdit>
		[owl:onProperty msg:target; owl:allValuesFrom <Menu>]);
	msg:imports <java:org.callimachusproject.server.HTTPObjectServer>;
	msg:script "HTTPObjectServer.resetAllCache(); return proceed();".

