<?xml version="1.0" encoding="iso-8859-1" standalone="yes" ?>

<!-- 
    Callimachus FLOSS installation file.
    Uses IzPack (see http://izpack.org).
    
    To compile the installer JAR file:
    - Run 'ant installer' from the Callimachus root directory.
    - The installer JAR will be created in the dist directory.

    David Wood (david @ http://3roundstones.com)
    6 March 2012
-->

<installation version="1.0" xmlns:xi="http://www.w3.org/2001/XInclude">

    <variables>
        <variable name="JDKPathPanel.minVersion" value="1.6.0_18" />
        <variable name="JDKPathPanel.maxVersion" value="1.6.9_99" />
        <variable name="JDKPathPanel.skipIfValid" value="yes" />
        <variable name="ShowCreateDirectoryMessage" value="false" />
        <xi:include href="../tmp/variables" xpointer="element(/1/1)" />
    </variables>

    <!-- 
        The info section.
        The meaning of the tags should be natural ...
    -->
    <info>
        <appname>Callimachus</appname>
        <appversion><xi:include href="../tmp/version" parse="text" /></appversion>
        <authors>
            <author name="3 Round Stones Inc." email="info@3roundstones.com"/>
        </authors>
        <url>http://3roundstones.com/</url>
        <javaversion>1.6</javaversion>
        <requiresjdk>yes</requiresjdk>
        <writeinstallationinformation>no</writeinstallationinformation>
        <uninstaller write="no" />
    </info>

    <!-- 
        The gui preferences indication.
        Sets the installer window to 640x480. It will not be able to change the size.
    -->
    <guiprefs width="640" height="480" resizable="yes">
        <modifier key="layoutAnchor" value="CENTER"/>
        <modifier key="useHeadingPanel" value="yes"/>
        <modifier key="useHeadingForSummary" value="yes"/>
        <modifier key="headingImageOnLeft" value="yes"/>
        <modifier key="headingLineCount" value="2"/>
        <modifier key="headingFontSize" value="1.5"/>
        <modifier key="headingBackgroundColor" value="0x00ffffff"/>
        <modifier key="headingPanelCounter" value="text"/>
        <modifier key="headingPanelCounterPos" value="inHeading"/>
    </guiprefs>

    <!-- 
        The locale section.
        Asks here to include the English and French langpacks.
    -->
    <locale>
        <langpack iso3="eng"/>
    </locale>

    <conditions>
        <condition type="variable" id="isroot">
            <name>USER_NAME</name>
            <value>root</value>
        </condition>
        <condition type="variable" id="newinstall">
            <name>callimachus.upgrading</name>
            <value>false</value>
        </condition>
        <condition type="variable" id="upgrading">
            <name>callimachus.upgrading</name>
            <value>true</value>
        </condition>
    </conditions>

    <!-- 
        The resources section.
        The ids must be these ones if you want to use the LicencePanel and/or the InfoPanel.
    -->
    <resources>
        <res id="HTMLHelloPanel.hello" src="installer/hello.html"/>
        <res id="HTMLHelloPanel.3rs" src="installer/3rs.html"/>
        <res id="callimachus_logo" src="installer/images/callimachus-logo.png"/>
        <res id="callimachus_enterprise" src="installer/images/callimachus-enterprise-logo.png"/>
        <res id="3roundstones_logo" src="installer/images/3roundstones_logo.png"/>
        <res id="Heading.image" src="installer/images/callimachus-logo-wide.png"/>
        <res id="LicencePanel.licence" src="LICENSE.txt"/>
        <res id="HTMLInfoPanel.readme" src="README.txt"/>
        <res id="userInputSpec.xml" src="installer/userInputSpec.xml" />
        <res id="TargetPanel.dir.macosx" src="tmp/macosx.dir" />
        <res id="TargetPanel.dir.windows" src="tmp/windows.dir" />
        <res id="TargetPanel.dir.unix" src="tmp/unix.dir" />
        <res id="ProcessPanel.Spec.xml" src="installer/ProcessPanel.Spec.xml" />
        <res id="CustomLangpack.xml_eng" src="installer/CustomLangpack.xml"/>
    </resources>
    <xi:include href="../tmp/jar" />
    <xi:include href="../tmp/mail-jar" />

    <!-- 
        The panels section.
        We indicate here which panels we want to use. The order will be respected.
    -->
    <panels>
        <panel classname="HTMLHelloPanel" id="hello"/>
        <panel classname="LicencePanel" id="license"/>
        <panel classname="JDKPathPanel"/>
        <panel classname="TargetPanel">
          <validator classname="org.callimachusproject.installer.ConfigurationReader" />
        </panel>
				<!-- TODO: Ask about backing up the existing repo -->
        <panel classname="UserInputPanel" id="primary" condition="newinstall"> <!-- primary authority config -->
          <validator classname="org.callimachusproject.installer.PrimaryOriginValidator" />
        </panel>
        <panel classname="InstallPanel">
          <validator classname="org.callimachusproject.installer.SetupProcessor" />
        </panel>
        <panel classname="HTMLInfoPanel" id="readme"/>
        <panel classname="UserInputPanel" id="secondary" /> <!-- virtual hosts config -->
        <panel classname="UserInputPanel" id="daemon" condition="isroot"> <!-- daemon config -->
          <validator classname="org.callimachusproject.installer.DaemonAccountValidator" />
        </panel>
        <panel classname="UserInputPanel" id="port" /> <!-- port config -->
        <panel classname="UserInputPanel" id="mail"> <!-- mail config -->
          <validator classname="org.callimachusproject.installer.MailServerValidator" />
        </panel>
        <panel classname="UserInputPanel" id="usersetup" condition="newinstall"/> <!-- initial user config -->
        <panel classname="UserInputPanel" id="userpassword" condition="upgrading"/> <!-- change password -->
        <panel classname="UserInputPanel" id="browser"> <!-- optionally start server/open browser -->
          <validator classname="org.callimachusproject.installer.ConfigurationWriter" />
        </panel>
        <panel classname="ProcessPanel" />
        <panel classname="HTMLHelloPanel" id="3rs"/>
        <panel classname="SimpleFinishPanel"/>
    </panels>

    <!-- 
        The packs section.
    -->
    <packs>
        <pack name="Base" required="yes">
            <description>The base files</description>
            <file src="README.txt" targetdir="$INSTALL_PATH"/>
            <file src="RELEASE_NOTES.txt" targetdir="$INSTALL_PATH"/>
            <file src="LICENSE.txt" targetdir="$INSTALL_PATH"/>
            <file src="LEGAL.txt" targetdir="$INSTALL_PATH"/>
            <file src="CONTRIBUTORS.txt" targetdir="$INSTALL_PATH"/>
            <file src="lib" targetdir="$INSTALL_PATH"/>
            <file src="dist/callimachus-${Version}.jar" targetdir="$INSTALL_PATH/lib/"/>
            <updatecheck>
                <!-- delete other files in the lib directory -->
                <include name="lib/**" />
            </updatecheck>
            <!-- These files will be parsed -->
            <!--
            <parsable targetfile="$INSTALL_PATH/README.txt"/>
            -->
        </pack>
        <pack name="Scripts" required="yes">
            <description>Scripts</description>
            <fileset dir="bin" targetdir="$INSTALL_PATH/bin" casesensitive="yes" os="unix">
              <include name="*.sh" />
              <include name="callimachus-linux-*" />
            </fileset>
            <fileset dir="bin" targetdir="$INSTALL_PATH/bin" casesensitive="yes" os="mac">
              <include name="*.sh" />
              <include name="callimachus-darwin" />
            </fileset>
            <fileset dir="bin" targetdir="$INSTALL_PATH/bin" casesensitive="yes" os="windows">
              <include name="*.bat" />
            </fileset>
            <executable targetfile="$INSTALL_PATH/bin/callimachus-start.sh" stage="never">
                <os family="unix"/>
                <os family="mac"/>
            </executable>
            <executable targetfile="$INSTALL_PATH/bin/callimachus-stop.sh" stage="never">
                <os family="unix"/>
                <os family="mac"/>
            </executable>
            <executable targetfile="$INSTALL_PATH/bin/callimachus-dump.sh" stage="never">
                <os family="unix"/>
                <os family="mac"/>
            </executable>
            <executable targetfile="$INSTALL_PATH/bin/callimachus-reset.sh" stage="never">
                <os family="unix"/>
                <os family="mac"/>
            </executable>
        </pack>
				<!--
        <pack name="Source" required="no" preselected="no">
            <description>Source Code</description>
            <file src="src" targetdir="$INSTALL_PATH"/>
        </pack>
				-->
    </packs>

</installation>
