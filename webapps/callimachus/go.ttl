@prefix xsd:<http://www.w3.org/2001/XMLSchema#>.
@prefix rdf:<http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs:<http://www.w3.org/2000/01/rdf-schema#>.
@prefix owl:<http://www.w3.org/2002/07/owl#>.
@prefix skos:<http://www.w3.org/2004/02/skos/core#>.
@prefix msg:<http://www.openrdf.org/rdf/2011/messaging#>.
@prefix calli:<http://callimachusproject.org/rdf/2009/framework#>.
@prefix audit:<http://www.openrdf.org/rdf/2009/auditing#>.
@prefix :<#>.

:LookupAndGo rdfs:subClassOf msg:Message;
	rdfs:subClassOf [owl:onProperty msg:target; owl:hasValue <go>];
	rdfs:subClassOf [owl:onProperty msg:literalFunctional; owl:allValuesFrom xsd:string];
	msg:method "GET";
	msg:expect "302-see-other";
	msg:header "cache-control:no-store";
	msg:imports <java:org.openrdf.model.vocabulary.RDFS>;
	msg:imports <java:java.net.URLEncoder>;
	msg:imports <lookup>;
	msg:imports </diverted>;
	msg:script """
		try {
			if (q.indexOf(":") > 0) {
				if (java.net.URI.create(q).isAbsolute())
					return diverted.toString() + ";" + URLEncoder.encode(q);
			}
		} catch (e) {
		}
		var vf = this.objectConnection.valueFactory;
		var stmts = this.objectConnection.getStatements(null, RDFS.LABEL, vf.createLiteral(q), []);
		try {
			if (stmts.hasNext()) {
				var uri = stmts.next().subject;
				while (!(uri instanceof org.openrdf.model.URI) && stmts.hasNext()) {
					uri = stmts.next().subject;
				}
				if (uri instanceof org.openrdf.model.URI && !stmts.hasNext())
					return uri.stringValue();
			}
		} finally {
			stmts.close();
		}
		return lookup + "?q=" + URLEncoder.encode(q);
	""".

:q a owl:DatatypeProperty, owl:FunctionalProperty;
	rdfs:domain :LookupAndGo;
	rdfs:range xsd:string;
	msg:query "q".

