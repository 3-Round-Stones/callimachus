@prefix xsd:<http://www.w3.org/2001/XMLSchema#>.
@prefix rdf:<http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs:<http://www.w3.org/2000/01/rdf-schema#>.
@prefix owl:<http://www.w3.org/2002/07/owl#>.
@prefix obj:<http://www.openrdf.org/rdf/2009/object#>.
@prefix http:<http://www.openrdf.org/rdf/2009/httpobject#>.
@prefix calli:<http://callimachusproject.org/rdf/2009/framework#>.
@prefix :<#>.

<User> rdfs:subClassOf calli:User, calli:MailSubmitter;
	rdfs:subClassOf calli:Viewable, calli:Editable, calli:Deletable;
	calli:icon <favicon.png>;
	calli:view <view.xml>;
	calli:edit <edit.xml>;
	calli:delete <delete.xml>.

# Removes the user's password.
# Called in user delete
:post-user-delete owl:intersectionOf (calli:post-delete
		[owl:onProperty obj:target; owl:allValuesFrom <User>]);
	obj:precedes calli:post-delete;
	obj:groovy """
		calliAlgorithm = null
		calliEncoded = null
		msg.proceed()
	""".

# User operations must be authorized
<User> http:realm <../authority>.

# any authenticated user can view any other user
:user-view-authorize owl:equivalentClass calli:authorize-credential;
	obj:sparql """
		ASK {
			$subject a <User>
			FILTER ($method = "GET" || $method = "HEAD")
			FILTER ($qs = "view" || !bound($qs))
		}
	""".

