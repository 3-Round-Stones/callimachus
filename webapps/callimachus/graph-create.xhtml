<?xml version="1.0" encoding="UTF-8" ?>
<?xml-stylesheet type="text/xsl" href="/callimachus/manifest?template"?>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>RDF Graph</title>
		<script type="text/javascript">
			jQuery(function($){
				$(':input[type=file]').live('change', function() {
					var form = $('.graph-form:last');
					if (form.find(':input[type=file]').val()) {
						var button = $('<button type="button" class="remove"/>');
						button.click(function() {
							form.remove();
						});
						var clone = form.clone();
						clone.find(':input[type=file]').val('');
						form.find('div').remove();
						form.append(button);
						form.after(clone);
					}
				});
				var advance = function() {
					$('.graph-form:last').find('button').attr('disabled', 'disabled');
					var next = $(':input[type=file]:enabled:first').parents('form');
					if (next.find(':input[type=file]').val()) {
						next.submit();
						next.find(':input').attr('disabled', 'disabled');
					} else {
						$(':input[type=file]').parents('form').find('button').removeAttr('disabled');
					}
					return false;
				};
				var retreat = function() {
					$('.graph-form').find('button').removeAttr('disabled');
					$(':input[type=file]:disabled:last').removeAttr('disabled');
					return false;
				};
				$('button[type=submit]').live('click', advance);
				$('iframe').load(function() {
					if ($('#graph-link', this.contentWindow.document).length) {
						advance();
					} else {
						retreat();
					}
				});
			});
		</script>
	</head>
	<body>
		<h1>RDF Graph</h1>
		<ul class="aside">
			<li>Upload an RDF file into the database as a Named Graph</li>
			<li>The system should be idle before attempting to upload a graph</li>
			<li>Files can be formatted as <a href="http://www.w3.org/TR/rdf-syntax-grammar/">RDF/XML</a> or <a href="http://www.w3.org/TeamSubmission/turtle/">Turtle</a> and can optionally be in ZIP or GZIP compression</li>
		</ul>
		<form class="graph-form" action="/callimachus/Graph?create" method="POST" enctype="multipart/form-data" target="iframe">
			<input type="file" name="graph" autofocus="autofocus" />
			<div>
				<button type="submit">Upload Graph</button>
				<button type="button" onclick="history.back()">Cancel</button>
			</div>
		</form>
		<iframe id="iframe" name="iframe" src="about:blank" style="width:40em;height:20em;border:none"> </iframe>
	</body>
</html>
