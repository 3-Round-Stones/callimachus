<?xml version="1.0" encoding="UTF-8" ?>
<?xml-stylesheet type="text/xsl" href="/layout/template.xsl"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
	xmlns:calli="http://callimachusproject.org/rdf/2009/framework#">
<head>
	<title>New Named Query</title>
	<script>// <![CDATA[
		jQuery(function($){
			$('#iframe')[0].src = $('#iframe')[0].src + '#sparql';
			$('#form').submit(function(event) {
				event.preventDefault();
				var name = prompt('Save as...', 'Untitled Query');
				if (name) {
					var local = encodeURI(name).replace(/%20/g,'-').toLowerCase();
					var header = 'POST create'
						+ '\nAction: ' + location.href
						+ '\nLocation: ' + location.pathname + local + '.rq'
						+ '\nContent-Type: application/sparql-query';
					if ($('#cache').val()) {
						header += '\nCache-Control: ' + $('#cache').val();
					}
					$(window).bind('message', function(event) {
						if (event.originalEvent.source == $('#iframe')[0].contentWindow) {
							var msg = event.originalEvent.data;
							if (msg == 'OK\n\n' + header) {
								location.replace('/query/' + local + '.rq?view');
							}
						}
					});
					$('#iframe')[0].contentWindow.postMessage(header, '*');
				}
				return false;
			});
		});
	// ]]>
	</script>
</head>
<body>
	<form id="form" method="POST" action="">
		<iframe id="iframe" class="auto-expand" src="/callimachus/editor/editor.html"> </iframe>
		<button type="submit">Create</button>
	</form>
</body>
</html>

