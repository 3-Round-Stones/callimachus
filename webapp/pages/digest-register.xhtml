<?xml version="1.0" encoding="UTF-8" ?>
<html xmlns="http://www.w3.org/1999/xhtml"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema#"
        xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
        xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
        xmlns:calli="http://callimachusproject.org/rdf/2009/framework#">
<head>
    <title resource="?this">{rdfs:label} Sign Up</title>
    <link rel="help" href="../../callimachus-for-web-developers" target="_blank" title="Help" />
    <style type="text/css">
    .password-meter {
        position:relative;
        width: 180px;
    }
    .password-meter-message {
        text-align: right;
        font-weight: bold;
        font-size: x-small;
        color: #676767;
    }
    .password-meter-bg, .password-meter-bar {
        height: 4px;
    }
    .password-meter-bg {
        top: 8px;
        background: #e0e0e0;
    }

    .password-meter-message-very-weak {
        color: #aa0033;
    }
    .password-meter-message-weak {
        color: #f5ac00;
    }
    .password-meter-message-good {
        color: #6699cc;
    }
    .password-meter-message-strong {
        color: #008000;
    }

    .password-meter-bg .password-meter-very-weak {
        background: #aa0033;
        width: 30px;
    }
    .password-meter-bg .password-meter-weak {
        background: #f5ac00;
        width: 60px;
    }
    .password-meter-bg .password-meter-good {
        background: #6699cc;
        width: 135px;
    }
    .password-meter-bg .password-meter-strong {
        background: #008000;
        width: 180px;
    }
    </style>
    <script type="text/javascript" src="../scripts/jquery.validate.js">
    </script>
    <script type="text/javascript" src="../scripts/jquery.validate.password.js">
    </script>
    <script type="text/javascript" src="../scripts/md5.js">
    </script>
    <script type="text/javascript">//<![CDATA[
        jQuery(function($) {
            function parameter(name) {
                var regex = new RegExp("[\\?&]"+name+"=([^&#]*)");
                var m = regex.exec(window.location.search);
                return m ? decodeURIComponent(m[1]) : null;
            }
            $('#email').val(parameter("email"));
            $('#username').val(parameter("email").replace(/@.*/,''));
            $('#fullname').val(parameter("fullname") || $('#username').val());
            $("#form").validate({submitHandler: function(form) {
                var username = $("#username").val();
                var email = $('#email').val();
                var authName = $("#authName").text();
                var password = $("#password").val();
                var hash1 = hex_md5(username + ':' + authName + ':' + password);
                var hash2 = hex_md5(email + ':' + authName + ':' + password);
                jQuery.ajax({type: 'POST', url: form.action,
                    traditional: true,
                    data: {
                        nonce: parameter("nonce"),
                        token: parameter("token"),
                        fullname: $("#fullname").val(),
                        email: parameter('email'),
                        "auth-email": email,
                        username: username,
                        password: [hash1, hash2]
                    },
                    success: function() {
                        window.location.replace('?login&return_to=' + encodeURIComponent(parameter('return_to')));
                    }
                });
                return false;
            }});
        });
        // ]]>
    </script>
</head>
<body resource="?this">
    <hgroup>
        <h1>{rdfs:label} Sign Up</h1>
        <h2 id="authName">{calli:authName}</h2>
    </hgroup>
    <div id="sidebar">
        <aside>
            <p>Your full name is used to indentify your work on this website</p>
            <p>Your E-mail address is used to manage your password and is not shown on the website</p>
            <p>Your username is used to uniquely identify your account on this website</p>
            <p>Please double check your email address is correct before signing up</p>
        </aside>
    </div>
    <p>{rdfs:comment}</p>
    <p>To accept this invitation please confirm the information belove and provide a password.</p>
    <form id="form" method="POST" action="?register">
        <div class="control-group">
            <label for="fullname" class="control-label">Full name</label>
            <div class="controls">
                <input id="fullname" name="fullname" type="text" required="required" />
            </div>
        </div>
        <div class="control-group">
            <label for="email" class="control-label">Email address</label>
            <div class="controls">
                <input id="email" name="email" type="text" required="required" />
            </div>
        </div>
        <div class="control-group">
            <label for="username" class="control-label">Username</label>
            <div class="controls">
                <input id="username" name="username" type="text" required="required" />
            </div>
        </div>
        <div class="control-group">
        	<label for="password" class="control-label">New password</label>
    		<div class="controls">
                <input id="password" type="password" password="#email" class="password" onkeyup="$(this).valid()" required="required" autofocus="autofocus" />
                <div class="password-meter">
                    <label for="password" class="password-meter-message" />
                    <div class="password-meter-bg">
                        <div class="password-meter-bar"></div>
                    </div>
                </div>
    		</div>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Yes, sign me up!</button>
            <button type="button" onclick="window.location.replace('/')">I'll come back later</button>
        </div>
    </form>
</body>
</html>
