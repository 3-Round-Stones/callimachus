<?xml version="1.0" encoding="UTF-8"?>
<rdf:RDF xml:base="http://example.com/"
	xmlns="/#"
	xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
	xmlns:calli="http://callimachusproject.org/rdf/2009/framework#"
	xmlns:foaf="http://xmlns.com/foaf/0.1/"
	xmlns:xsd="http://www.w3.org/2001/XMLSchema#"
	xmlns:owl="http://www.w3.org/2002/07/owl#"
	xmlns:sd="http://www.w3.org/ns/sparql-service-description#"
	xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
	xmlns:void="http://rdfs.org/ns/void#"
	xmlns:audit="http://www.openrdf.org/rdf/2009/auditing#"
	xmlns:skos="http://www.w3.org/2004/02/skos/core#"
	xmlns:msg="http://www.openrdf.org/rdf/2011/messaging#"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:skosxl="http://www.w3.org/2008/05/skos-xl#"
	xmlns:keyword="http://www.openrdf.org/rdf/2011/keyword#"
	xmlns:dcterms="http://purl.org/dc/terms/"
	xmlns:callimachusproject="http://callimachusproject.org/rdf/2009/"
	xmlns:meeting="/schema/"
	xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"
	xmlns:frs="http://usepa.3roundstones.net/id/us/fed/agency/epa/frs/schema#"
	xmlns:place="http://purl.org/ontology/places#"
	xmlns:vcard="http://www.w3.org/2006/vcard/ns#">

<rdf:Description rdf:about="/callimachus/Article">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Article</rdfs:label>
	<rdfs:comment>New articles can be created from a folder</rdfs:comment>
	<rdfs:subClassOf rdf:resource="/callimachus/File"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/users"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/article.png"/>
	<calli:view rdf:resource="/callimachus/article-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/article-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/article-create.xhtml"/>
	<calli:type>application/docbook+xml</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/article.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/article.ttl#GetArticleSource">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x1"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x2"/>
	<calli:type>application/docbook+xml</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openInputStream()</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/article.ttl#GetPage">
	<msg:script>
		return this.InlineArticle(proceed());
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x3"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/article.ttl#InlineArticle">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x6"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x7"/>
	<calli:type>application/xhtml+xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/transforms/article-inline.xsl"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/article.ttl#xmlInput">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/xhtml+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/article.ttl#InlineArticle"/>
	<rdfs:range rdf:resource="java:javax.xml.stream.XMLEventReader"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/article.ttl#LookupArticleFile">
	<msg:script>
		if (type == "application/docbook+xml") {
			var uri = this.toUri().resolve("/callimachus/Article").toString();
			return this.objectConnection.getObject(uri);
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x8"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/article.ttl#CreateArticle">
	<msg:script>
		var con = this.objectConnection;
		var vf = con.valueFactory;
		if (!location)
			throw new BadRequest("Missing location request header");
		if (location instanceof File) {
			location = location.RemoveFile();
		}
		var created = location;

		var filename = created.resource.localName.replace(/([a-zA-Z_0-9])\.[a-zA-Z]+$/, "$1");
		var label = vf.createLiteral(URLDecoder.decode(filename, "UTF-8").replace(/-/g, " "));
		con.add(created.resource, RDFS.LABEL, label, []);

		created = con.addDesignation(created, this.toString());
		created = con.addDesignation(created, Document);

		created.UploadArticle(body);
		return created;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x11"/>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Document"/>
	<msg:imports rdf:resource="/callimachus/File"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.InternalServerError"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/article.ttl#UploadArticle">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x14"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x15"/>
	<calli:method>PUT</calli:method>
	<msg:script>
		var read;
		var buf = java.lang.reflect.Array.newInstance(java.lang.Byte.TYPE, 1024);
		var out = this.openOutputStream();
		try {
			while ((read = docbookStream.read(buf)) &gt;= 0) {
				out.write(buf, 0, read);
			}
		} finally {
			out.close();
		}
		this.touchRevision();
	</msg:script>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Document"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/article.ttl#docbookStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/docbook+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/article.ttl#UploadArticle"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x1">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Article"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x2">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x3">
	<rdf:first rdf:resource="/callimachus/toolbox/view.ttl#GetViewPage"/>
	<rdf:rest rdf:nodeID="node16tas22o6x4"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x4">
	<rdf:first rdf:nodeID="node16tas22o6x5"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x5">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Article"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x6">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Article"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x7">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:javax.xml.stream.XMLEventReader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x8">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x9"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x9">
	<rdf:first rdf:nodeID="node16tas22o6x10"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x10">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x11">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x12"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x12">
	<rdf:first rdf:nodeID="node16tas22o6x13"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x13">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/Article"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x14">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Article"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x15">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#Origin">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Origin</rdfs:label>
	<rdfs:comment>A URI with a '/' path that is served by a Callimachus system</rdfs:comment>
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#Realm"/>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#Realm">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Realm</rdfs:label>
	<rdfs:comment>Web application realm</rdfs:comment>
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#Folder"/>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#Folder">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Folder</rdfs:label>
	<rdfs:comment>A resource URI namespace ending in a slash</rdfs:comment>
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#Composite"/>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#reader">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>reader</rdfs:label>
	<rdfs:comment>User or group of users that can view individual resources of this class</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#editor">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>editor</rdfs:label>
	<rdfs:comment>User or group of users that can create resources in this namespace, can edit this resource, and edit members of this class</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#administrator">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>administrator</rdfs:label>
	<rdfs:comment>User or group of users that can interact, create and modify this resource and members of this class</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#unauthorized">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdfs:label>authorized</rdfs:label>
	<rdfs:comment>The RDFa page template used when an agent is aunothorized from the requested resource</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#Realm"/>
	<rdfs:range rdf:resource="http://callimachusproject.org/rdf/2009/framework#Page"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#forbidden">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdfs:label>forbidden</rdfs:label>
	<rdfs:comment>The RDFa page template used when an agent is forbidden from the requested resource</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#Realm"/>
	<rdfs:range rdf:resource="http://callimachusproject.org/rdf/2009/framework#Page"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#authentication">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdfs:label>authentication</rdfs:label>
	<rdfs:comment>The realm used for authentication</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#Realm"/>
	<rdfs:range rdf:resource="http://callimachusproject.org/rdf/2009/framework#AuthenticationManager"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#menu">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:label>menu</rdfs:label>
	<rdfs:comment>The menu used in this realm</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#Realm"/>
	<rdfs:range rdf:resource="http://callimachusproject.org/rdf/2009/framework#Menu"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#favicon">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:label>favicon</rdfs:label>
	<rdfs:comment>A small logo image that should be shown on pages using the configured theme</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#Realm"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#theme">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:label>theme</rdfs:label>
	<rdfs:comment>The primary theme used for this realm</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#Realm"/>
	<rdfs:range rdf:resource="http://callimachusproject.org/rdf/2009/framework#Theme"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#hasComponent">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdfs:label>has component</rdfs:label>
	<rdfs:comment>A nested resource with a URI that starts with this resource URI with one additional path, fragement, or component segment</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#Composite"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#DigestManager">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Digest Manager</rdfs:label>
	<rdfs:comment>A managed set of users that can authenticate using HTTP digest credentials</rdfs:comment>
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#AuthenticationManager"/>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#authName">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"/>
	<rdfs:label>auth name</rdfs:label>
	<rdfs:comment>A string to be displayed to users so they know which username and password to use. This string should contain at least the name of the host performing the authentication and might additionally indicate the collection of users who might have access. This string is used to encode the passwords and changing it will invalidates existing encoded passwords</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#DigestManager"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#authNamespace">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:label>auth namespace</rdfs:label>
	<rdfs:comment>Folder of users that can be authenticated by this realm</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#DigestManager"/>
	<rdfs:range rdf:resource="http://callimachusproject.org/rdf/2009/framework#Folder"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#Party">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Party</rdfs:label>
	<rdfs:comment>A user or group of users</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#Group">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Group</rdfs:label>
	<rdfs:comment>A collection of users</rdfs:comment>
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#Party"/>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#Menu">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Menu</rdfs:label>
	<rdfs:comment>A hierarchical menu of human-readable links</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#link">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:label>link</rdfs:label>
	<rdfs:comment>The target of this menu entry</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#Menu"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#item">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdfs:label>item</rdfs:label>
	<rdfs:comment>A menu item that is part of this menu</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#Menu"/>
	<rdfs:range rdf:resource="http://callimachusproject.org/rdf/2009/framework#Menu"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#position">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:label>position</rdfs:label>
	<rdfs:comment>The position this menu item should be placed</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#Menu"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#integer"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#describedBy">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:label>described by</rdfs:label>
	<rdfs:comment>The target URL to use as a directory index</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#Folder"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#author">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>author</rdfs:label>
	<rdfs:comment>User or group of users that can create an instance resource of this class</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#view">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>view</rdfs:label>
	<rdfs:comment>The RDFa page template used to display individual resources of this class in a Web browser</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#edit">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>edit</rdfs:label>
	<rdfs:comment>The RDFa page template used to edit individual resources of this class using a Web browser</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#create">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>create</rdfs:label>
	<rdfs:comment>The RDFa page template used to create resources of this class using a Web browser</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#type">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>type</rdfs:label>
	<rdfs:comment>The content type for binary or text representations of resources of this class, property, or message response</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#method">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>method</rdfs:label>
	<rdfs:comment>Placed on messages that should be called for the given HTTP method</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#header">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>header</rdfs:label>
	<rdfs:comment>Placed on message parameters that should be populated with request headers. Placed on messages to add a response header. Response header of 'cache-control:no-validate' disable server side validation and 'cache-control:cache-range' use strong etag validation</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#realm">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>realm</rdfs:label>
	<rdfs:comment>The Realm used to secure members of this class or use of this message</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/callimachus-ontology.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Ontology"/>
	<rdfs:label>Callimachus Ontology</rdfs:label>
	<rdfs:comment>Vocabulary used to create Callimachus applications</rdfs:comment>
	<owl:versionInfo>0.17</owl:versionInfo>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#Composite">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Composite</rdfs:label>
	<rdfs:comment>Class of resources that contain nested components, where the component URIs have their parent URI as a prefix</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#AuthenticationManager">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Authentication Manager</rdfs:label>
	<rdfs:comment>A managed set of users that can authenticate using HTTP digest credentials</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#User">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Agent</rdfs:label>
	<rdfs:comment>A digest credential with a MD5 algorithm</rdfs:comment>
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#Party"/>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#Theme">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Theme</rdfs:label>
	<rdfs:comment>A Callimachus Web theme of HTML templates, CSS, and JavaScript</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#ScriptBundle">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Script Bundle</rdfs:label>
	<rdfs:comment>A collection of JavaScript files that are downloaded and compressed together</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#Page">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DeprecatedClass"/>
	<rdfs:label>Page</rdfs:label>
	<rdfs:comment>Use &lt;/callimachus/Page&gt; instead</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#contributor">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>contributor</rdfs:label>
	<rdfs:comment>User or group of users that can create a resource in this namespace</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#expect">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>expect</rdfs:label>
	<rdfs:comment>Placed on a method to indicate the HTTP response status code of a successful response. Possible values include '201-created', '202-accepted', '205-reset-content', '300-multiple-choices', '301-moved-permanently', and '302-found'</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#query">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>query</rdfs:label>
	<rdfs:comment>Placed on messages that should be called when the given request query parameter name is sent without a value. Placed on message properties that should be populated with request GET query parameters</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#rel">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>rel</rdfs:label>
	<rdfs:comment>Placed on properties or messages and describes the relationship between the message target and message response</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#title">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>title</rdfs:label>
	<rdfs:comment>Labels the relationship between message target and message response such that it can be used as identification within a human-readable menu</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#transform">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#AnnotationProperty"/>
	<rdfs:label>transform</rdfs:label>
	<rdfs:comment>The messages that should be used to transform the parameter or response</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#algorithm">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:label>algorithm</rdfs:label>
	<rdfs:comment>A value of 'MD5' indicates this Agent is uses digest authentication</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#User"/>
	<rdfs:range rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#PlainLiteral"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#encoded">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:label>encoded</rdfs:label>
	<rdfs:comment>The MD5 encoded username:realm:password</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#User"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#hexBinary"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#name">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:label>name</rdfs:label>
	<rdfs:comment>The username for this agent</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#User"/>
	<rdfs:range rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#PlainLiteral"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#email">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:label>email</rdfs:label>
	<rdfs:comment>The primary email address for this user</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#User"/>
	<rdfs:range rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#PlainLiteral"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#variation">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:label>variation</rdfs:label>
	<rdfs:comment>An CSS file that overrides the style of the theme</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#Realm"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#rights">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:label>rights</rdfs:label>
	<rdfs:comment>Rights statement for the data in this Web application server</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#Realm"/>
	<rdfs:range rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#XMLLiteral"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#member">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdfs:label>member</rdfs:label>
	<rdfs:comment>Agent that is part of this group</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#Group"/>
	<rdfs:range rdf:resource="http://callimachusproject.org/rdf/2009/framework#Agent"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#minified">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:label>minified</rdfs:label>
	<rdfs:comment>Level of minification that should be applied to this bundle. Zero represents no minification. One represents minimal minification</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#ScriptBundle"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#integer"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#layout">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:label>layout</rdfs:label>
	<rdfs:comment>The HTML template used by this theme as the primary page layout</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#Theme"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#IsAuthorized">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x16"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x17"/>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework/IsAuthorized#credential">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#IsAuthorized"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework/IsAuthorized#method">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#IsAuthorized"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework/IsAuthorized#query">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
	<rdfs:domain rdf:resource="http://callimachusproject.org/rdf/2009/framework#IsAuthorized"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="http://callimachusproject.org/rdf/2009/framework#nobody">
	<rdf:type rdf:resource="http://callimachusproject.org/rdf/2009/framework#NobodyRealm"/>
	<rdfs:isDefinedBy rdf:resource="http://callimachusproject.org/rdf/2009/framework"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x16">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:cardinality rdf:datatype="http://www.w3.org/2001/XMLSchema#nonNegativeInteger">1</owl:cardinality>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x17">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2001/XMLSchema#boolean"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/change.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Change">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2009/auditing#Transaction"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Serviceable"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:realm rdf:resource="/"/>
	<msg:matching rdf:resource="/change/*"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/change.ttl#AuthorizeTransaction">
	<owl:intersectionOf rdf:nodeID="node16tas22o6x18"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		ASK {
			{
				# they created this transaction
				$this audit:contributor $credential
			} UNION {
				# they administer the user that did this
				$this audit:contributor [calli:administrator $credential]
			} UNION {
				# they are part of a group that administers the user that did this
				$this audit:contributor [calli:administrator [calli:member $credential]]
			}
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/change.ttl#AuthorizeTransactionView">
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#IsAuthorized"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x21"/>
	<msg:script>
		function findAnnotatedClass(klass, ann) {
			if (klass.isAnnotationPresent(ann)) {
				return [klass];
			}
			var result = [];
			if (klass.getSuperclass()) {
				result = findAnnotatedClass(klass.getSuperclass(), ann);
			}
			var interfaces = klass.getInterfaces();
			for (var i = interfaces.length; i--;) {
				var face = findAnnotatedClass(interfaces[i], ann);
				for (var f = face.length; f--;) {
					for (var r = result.length; r--;) {
						if (result[r].isAssignableFrom(face[f])) {
							result.splice(r, 1); //# annotation overridden
						}
					}
					result.push(face[f]);
				}
			}
			return result;
		}
		if (proceed())
			return true;
		var reading = (method == "GET" || method == "HEAD" || method == "POST" &amp;&amp; query == "discussion")
			&amp;&amp; (query == null || query == "view" || query == "discussion" || query == "history"
				|| query == "whatlinkshere" || query == "relatedchanges");
		if (!reading)
			reurn false;
		var iter = this.ListSubjectsOfTransaction().iterator();
		while (iter.hasNext()) {
			var subject = iter.next();
			if (!findAnnotatedClass(subject.getClass(), realm).length)
				continue; // class is not protected
			if (!subject.IsAuthorized(credential, "GET", "describe"))
				return false;
		}
		// if they can view the RDF of all of the subjects they can view this transaction
		return true;
	</msg:script>
	<msg:imports rdf:resource="java:org.callimachusproject.annotations.realm"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/change.ttl#ListSubjectsOfTransaction">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x22"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT DISTINCT ?subj
		WHERE {
			{
				GRAPH $this { ?subj ?pred ?obj }
			} UNION {
				GRAPH $this { [rdf:subject ?subj] }
			} UNION {
				$this audit:contained [rdf:subject ?subj]
			}
			OPTIONAL { ?subj a ?trans FILTER(?trans = audit:Transaction) }
			FILTER (!bound(?trans))
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/change.ttl#GetChangesetView">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x23"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x24"/>
	<calli:type>application/sparql-results+xml</calli:type>
	<calli:method>GET</calli:method>
	<calli:query>view</calli:query>
	<calli:rel>alternate</calli:rel>
	<calli:transform rdf:resource="/callimachus/change.ttl#TransformChangesetView"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT REDUCED ?modified ?user ?name ?previous ?subsequent ?removed ?added ?subject ?predicate ?object
		WHERE {
			{
				$this audit:committedOn ?modified
				OPTIONAL {
					$this audit:contributor ?user
					OPTIONAL { ?user skos:prefLabel ?name }
					OPTIONAL { ?user rdfs:label ?name }
				}
			} UNION {
				$this audit:modified ?previous . ?previous audit:committedOn ?asof
			} UNION {
				?subsequent audit:modified $this . ?subsequent audit:committedOn ?asof
			} UNION {
				GRAPH ?added {
					?subject ?predicate ?object
					FILTER (?subject != $this)
					FILTER (?predicate != audit:revision)
					FILTER (?predicate != audit:contained)
					FILTER (?predicate != rdf:subject)
					FILTER (?predicate != rdf:predicate)
					FILTER (?predicate != rdf:object)
				}
				?added audit:committedOn ?asof
				FILTER (?added = $this)
			} UNION {
				GRAPH ?removed {
					?added audit:contained [
						rdf:subject ?subject;
						rdf:predicate ?predicate;
						rdf:object ?object
					]
					FILTER (?subject != $this)
					FILTER (?predicate != audit:revision)
					FILTER (?predicate != rdf:subject)
					FILTER (?predicate != rdf:predicate)
					FILTER (?predicate != rdf:object)
				}
				OPTIONAL { ?added audit:committedOn ?asof }
				FILTER (?added = $this || ?removed = $this)
			}
		}
		ORDER BY ?subject ?predicate ?asof ?object
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/change.ttl#TransformChangesetView">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x25"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x26"/>
	<calli:type>application/xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/transforms/change.xsl"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformLayout"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/change.ttl#inputStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/sparql-results+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/change.ttl#TransformChangesetView"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x18">
	<rdf:first rdf:resource="http://callimachusproject.org/rdf/2009/framework#IsAuthorized"/>
	<rdf:rest rdf:nodeID="node16tas22o6x19"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x19">
	<rdf:first rdf:nodeID="node16tas22o6x20"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x20">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Change"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x21">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Change"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x22">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Change"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x23">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Change"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x24">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x25">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Change"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x26">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/class.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Class">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Class</rdfs:label>
	<rdfs:comment>A class is a construct that is used as a blueprint (or template) to create and edit resources of that class</rdfs:comment>
	<rdfs:subClassOf rdf:resource="/callimachus/Creatable"/>
	<rdfs:subClassOf rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Viewable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Editable"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/class.png"/>
	<calli:view rdf:resource="/callimachus/class-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/class-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/class-create.xhtml"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/class.ttl#GetClassIndex">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x27"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x28"/>
	<calli:type>application/sparql-results+xml;q=0.1</calli:type>
	<calli:method>GET</calli:method>
	<calli:query>index</calli:query>
	<calli:transform rdf:resource="/callimachus/class.ttl#TransformClassIndex"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX owl:&lt;http://www.w3.org/2002/07/owl#&gt;
		PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;
		PREFIX foaf:&lt;http://xmlns.com/foaf/0.1/&gt;
		SELECT REDUCED ?title ?description ?resource ?label (ucase(substr(?label, 1, 1)) as ?index) (regex(?label, "^[a-zA-Z]") as ?letter) {
			{
				$this rdfs:label ?title
				OPTIONAL {
					$this rdfs:comment ?description
				}
			} UNION {
				?resource a $this
				OPTIONAL {
					?resource skos:prefLabel ?label
				} OPTIONAL {
					?resource rdfs:label ?label
				} OPTIONAL {
					?resource foaf:name ?label
				}
			} UNION {
				$this owl:equivalentClass ?type . ?resource a ?type
				OPTIONAL {
					?resource skos:prefLabel ?label
				} OPTIONAL {
					?resource rdfs:label ?label
				} OPTIONAL {
					?resource foaf:name ?label
				}
			}
		} ORDER BY ?label ?resource LIMIT 101
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/class.ttl#TransformClassIndex">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x29"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x30"/>
	<calli:type>application/xhtml+xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/class-index.xhtml"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformLayout"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/class.ttl#inputStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/sparql-results+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/class.ttl#TransformClassIndex"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/class.ttl#CreateClass">
	<msg:script>
		var ret = proceed();
		var con = this.objectConnection;
		var of = con.objectFactory;
		con.addDesignation(of.createObject(Audit.CURRENT_TRX), SchemaGraph);
		con.recompileSchemaOnClose();
		return ret;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x31"/>
	<msg:imports rdf:resource="/callimachus/SchemaGraph"/>
	<msg:imports rdf:resource="java:org.openrdf.sail.auditing.vocabulary.Audit"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDF"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/class.ttl#PostClassEdit">
	<msg:script>
		var ret = proceed();
		var con = this.objectConnection;
		var of = con.objectFactory;
		con.addDesignation(of.createObject(Audit.CURRENT_TRX), SchemaGraph);
		con.recompileSchemaOnClose();
		return ret;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x34"/>
	<msg:imports rdf:resource="/callimachus/SchemaGraph"/>
	<msg:imports rdf:resource="java:org.openrdf.sail.auditing.vocabulary.Audit"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDF"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x27">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Class"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x28">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x29">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Class"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x30">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x31">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x32"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x32">
	<rdf:first rdf:nodeID="node16tas22o6x33"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x33">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/Class"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x34">
	<rdf:first rdf:resource="/callimachus/toolbox/edit.ttl#PostEdit"/>
	<rdf:rest rdf:nodeID="node16tas22o6x35"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x35">
	<rdf:first rdf:nodeID="node16tas22o6x36"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x36">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Class"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/concept.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Concept">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Concept</rdfs:label>
	<rdfs:comment>Concepts are ideas, meanings, or categories of objects and events</rdfs:comment>
	<rdfs:subClassOf rdf:resource="/callimachus/Viewable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Editable"/>
	<rdfs:subClassOf rdf:resource="http://www.w3.org/2004/02/skos/core#Concept"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/users"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/concept.png"/>
	<calli:view rdf:resource="/callimachus/concept-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/concept-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/concept-create.xhtml"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/DigestManager">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#DigestManager"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Viewable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Editable"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:view rdf:resource="/callimachus/digest-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/digest-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/digest-create.xhtml"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#GetLoginPage">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x37"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x38"/>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:max-age:3600</calli:header>
	<msg:script>
		if ("settings" == query)
			return this.findCredential(cookie) + "?edit";
		if ("contributions" == query)
			return this.findCredential(cookie) + "?contributions";
		return this.findCredential(cookie).toString(); //# login Deprecated
	</msg:script>
	<calli:realm rdf:resource="/"/>
	<calli:expect>302-found</calli:expect>
	<calli:query>login</calli:query>
	<calli:query>settings</calli:query>
	<calli:query>contributions</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#cookie">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<calli:header>Authorization</calli:header>
	<calli:header>Cookie</calli:header>
	<rdfs:domain rdf:resource="/callimachus/digest.ttl#GetLoginPage"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#query">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/digest.ttl#GetLoginPage"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
	<calli:query>*</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#AuthorizeLoginPage">
	<owl:intersectionOf rdf:nodeID="node16tas22o6x39"/>
	<msg:sparql>
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		ASK {
			$this calli:authNamespace [calli:hasComponent $credential]
			FILTER ($method = "GET" || $method = "HEAD")
			FILTER ($query = "login" || $query = "settings" || $query = "contributions")
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#GetLogout">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x42"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x43"/>
	<calli:type>message/x-response</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		var ver = new ProtocolVersion("HTTP", 1, 1);
		if (authorization &amp;&amp; authorization.indexOf('username="logout"') &gt; 0) {
			//# bogus credentials received
			var resp = new BasicHttpResponse(ver, 303, "See Other");
			resp.setHeader("Location", "/");
			return resp;
		}
		//# the browser must send invalid credentials to logout
		var resp = new BasicHttpResponse(ver, 401, "Unauthorized");
		var hd = 'Digest realm="' + this.calliAuthName + '", domain="'
			+ this.protectionDomain() + '", nonce="logout", algorithm="MD5", qop="auth"';
		resp.setHeader('WWW-Authenticate', hd);
		return resp;
	</msg:script>
	<msg:imports rdf:resource="java:org.apache.http.ProtocolVersion"/>
	<msg:imports rdf:resource="java:org.apache.http.message.BasicHttpResponse"/>
	<calli:query>logout</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#authorization">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<calli:header>Authorization</calli:header>
	<rdfs:domain rdf:resource="/callimachus/digest.ttl#GetLogout"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#GetForgotPasswordPage">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x44"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x45"/>
	<calli:type>application/xhtml+xml</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-store</calli:header>
	<msg:script>
		return forgot_password_xhtml.calliConstruct(this);
	</msg:script>
	<msg:imports rdf:resource="/callimachus/pages/forgot-password.xhtml"/>
	<calli:query>forgotpassword</calli:query>
	<calli:transform rdf:resource="/callimachus/transforms/TransformPage"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#PostForgotPassword">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x46"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x47"/>
	<calli:method>POST</calli:method>
	<msg:script>
		if (!formEmail)
			throw new BadRequest("Missing Email");
		var iter = this.FindUsersByEmail(formEmail).iterator();
		if (!iter.hasNext()) {
			println("No users with email " + formEmail + " found");
		}
		while (iter.hasNext()) {
			var user = iter.next();
			var ha1 = DigestUtils.md5Hex(user.calliEncoded);
			var nonce = Integer.toHexString(new Random(System.nanoTime()).nextInt());
			var ha2 = DigestUtils.md5Hex(user.toString());
			var token = DigestUtils.md5Hex(ha1 + ":" + nonce + ":" + ha2);
			var qs = "?resetpassword&amp;amp;nonce=" + nonce + "&amp;amp;token=" + token + "&amp;amp;username=" + user.calliName;
			var body = mail_request_password_xhtml.calliConstructHTML(user);
			body = body.replace(/\?resetpassword/g, qs);
			user.sendMessage(body, user.rdfsLabel.iterator().next() + " &lt;" + formEmail + "&gt;");
		}
		java.lang.Thread.sleep(new java.util.Random().nextInt() % 2000 + 2000);
	</msg:script>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.apache.commons.codec.digest.DigestUtils"/>
	<msg:imports rdf:resource="/callimachus/pages/mail-request-password.xhtml"/>
	<msg:imports rdf:resource="java:java.io.CharArrayWriter"/>
	<msg:imports rdf:resource="java:java.util.Random"/>
	<msg:imports rdf:resource="java:java.lang.Integer"/>
	<msg:imports rdf:resource="java:java.lang.System"/>
	<calli:query>forgotpassword</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#formEmail">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<calli:type>text/plain</calli:type>
	<rdfs:domain rdf:resource="/callimachus/digest.ttl#PostForgotPassword"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#FindUsersByEmail">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x48"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x49"/>
	<msg:sparql>
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT REDUCED ?user
		WHERE {
			$this calli:authNamespace [calli:hasComponent ?user] .
			?user calli:email $email .
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#email">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/digest.ttl#FindUsersByEmail"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#GetResetPassword">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x50"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x51"/>
	<calli:type>application/xhtml+xml</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-store</calli:header>
	<msg:script>
		if (!nonce || !token || !username)
			throw new BadRequest("Missing nonce and/or token and/or username");
		var user = this.objectConnection.getObject(this.calliAuthNamespace + username);
		var ha1 = DigestUtils.md5Hex(user.calliEncoded);
		var ha2 = DigestUtils.md5Hex(user.toString());
		var hex = DigestUtils.md5Hex(ha1 + ":" + nonce + ":" + ha2);
		if (token != hex)
			throw new BadRequest("Request is No Longer Valid");
		return reset_password_xhtml.calliConstruct(user);
	</msg:script>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.apache.commons.codec.digest.DigestUtils"/>
	<msg:imports rdf:resource="/callimachus/pages/reset-password.xhtml"/>
	<calli:query>resetpassword</calli:query>
	<calli:transform rdf:resource="/callimachus/transforms/TransformPage"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#nonce">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/digest.ttl#GetResetPassword"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
	<calli:query>nonce</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#token">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/digest.ttl#GetResetPassword"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
	<calli:query>token</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#username">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/digest.ttl#GetResetPassword"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
	<calli:query>username</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#PostResetPassword">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x52"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x53"/>
	<calli:method>POST</calli:method>
	<calli:header>cache-control:no-store</calli:header>
	<msg:script>
		if (!resetForm.get('nonce') || !resetForm.get("token") || !resetForm.get("username"))
			throw new BadRequest("Missing nonce and/or token and/or username");
		var user = this.objectConnection.getObject(this.calliAuthNamespace + resetForm.get('username')[0]);
		var ha1 = DigestUtils.md5Hex(user.calliEncoded);
		var nonce = resetForm.get('nonce')[0];
		var ha2 = DigestUtils.md5Hex(user.toString());
		var token = DigestUtils.md5Hex(ha1 + ":" + nonce + ":" + ha2);
		if (token != resetForm.get("token")[0])
			throw new BadRequest("Request is No Longer Valid");
		var password = this.generatePassword();
		var decoded = user.calliName + ":" + this.calliAuthName + ":" + password;
		user.calliAlgorithm = "MD5";
		user.calliEncoded = DigestUtils.md5(new java.lang.String(decoded).getBytes("UTF-8"));
		var body = mail_password_xhtml.calliConstructHTML(user);
		body = body.replace(/@@USERNAME@@/g, user.calliName);
		body = body.replace(/@@PASSWORD@@/g, password);
		user.sendMessage(body, user.rdfsLabel.iterator().next() + " &lt;" + user.calliEmail + "&gt;");
	</msg:script>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.apache.commons.codec.digest.DigestUtils"/>
	<msg:imports rdf:resource="java:java.io.CharArrayWriter"/>
	<msg:imports rdf:resource="java:java.util.Random"/>
	<msg:imports rdf:resource="java:java.lang.Integer"/>
	<msg:imports rdf:resource="/callimachus/pages/mail-password.xhtml"/>
	<calli:query>resetpassword</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/digest.ttl#resetForm">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/x-www-form-urlencoded</calli:type>
	<rdfs:domain rdf:resource="/callimachus/digest.ttl#PostResetPassword"/>
	<rdfs:range rdf:resource="java:java.util.Map"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x37">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/DigestManager"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x38">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x39">
	<rdf:first rdf:resource="http://callimachusproject.org/rdf/2009/framework#IsAuthorized"/>
	<rdf:rest rdf:nodeID="node16tas22o6x40"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x40">
	<rdf:first rdf:nodeID="node16tas22o6x41"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x41">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/DigestManager"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x42">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/DigestManager"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x43">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:org.apache.http.HttpResponse"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x44">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/DigestManager"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x45">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:javax.xml.stream.XMLEventReader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x46">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/DigestManager"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x47">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x48">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/DigestManager"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x49">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#objectSet"/>
	<owl:allValuesFrom rdf:resource="http://callimachusproject.org/rdf/2009/framework#User"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x50">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/DigestManager"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x51">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:javax.xml.stream.XMLEventReader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x52">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/DigestManager"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x53">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/File">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>File</rdfs:label>
	<rdfs:subClassOf rdf:resource="http://xmlns.com/foaf/0.1/Document"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Viewable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Editable"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/users"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:view rdf:resource="/callimachus/file-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/file-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/file-create.xhtml"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/file.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/file.ttl#GetFileContentType">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x54"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x55"/>
	<msg:sparql>
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT DISTINCT ?type { $this a [calli:type ?type] }
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/file.ttl#RemoveFile">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x56"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x57"/>
	<msg:script>
		var con = this.objectConnection;
		var vf = con.getValueFactory();
		var hasComponent = vf.createURI("http://callimachusproject.org/rdf/2009/framework#hasComponent");

		con.clear([this.resource]); //# clear graph
		con.remove(this.resource, null, null, []); //# delete out bound triples
		con.remove(null, hasComponent, this.resource, []); //# remove from parent folder
		//#TODO this['delete'](); //# remove document
		return con.getObjectFactory().createObject(this.resource);
	</msg:script>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x54">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x55">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x56">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x57">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2000/01/rdf-schema#Resource"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Folder">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Folder</rdfs:label>
	<rdfs:comment>A folder of resources</rdfs:comment>
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#Folder"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Viewable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Editable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Composite"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/folder.png"/>
	<calli:view rdf:resource="/callimachus/folder-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/folder-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/folder-create.xhtml"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#RedirectToIndex">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x58"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x59"/>
	<calli:type>message/x-response</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		var http11 = new ProtocolVersion("HTTP", 1, 1);
		var resp = new BasicHttpResponse(http11, 303, "Directory Index");
		if (this.calliDescribedBy) {
			resp.addHeader("Location", this.calliDescribedBy.toString());
		} else {
			resp.addHeader("Location", this.toString() + "?view");
		}
		return resp;
	</msg:script>
	<msg:imports rdf:resource="java:org.apache.http.ProtocolVersion"/>
	<msg:imports rdf:resource="java:org.apache.http.message.BasicHttpResponse"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#PostFileSlug">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x60"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x61"/>
	<calli:type>text/plain</calli:type>
	<calli:method>POST</calli:method>
	<msg:script>
		if (!slug)
			throw new BadRequest("Missing Slug HTTP header");
		if (!contentType)
			throw new BadRequest("Missing Content-Type HTTP header");
		if (!content)
			throw new BadRequest("Missing request content");
		var con = this.objectConnection;
		var File = con.getObject(folder_ttl.toUri().resolve("File").toASCIIString());
		var location = this.toString() + encodeURIComponent(decodeURIComponent(slug)).replace(/%20/g, '-');
		return this.PostFactoryCreate(content, File, false, con.getObject(location), contentType);
	</msg:script>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="/callimachus/folder.ttl"/>
	<calli:realm rdf:resource="/"/>
	<calli:expect>201-created</calli:expect>
	<calli:query>contents</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#slug">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<calli:header>Slug</calli:header>
	<rdfs:domain rdf:resource="/callimachus/folder.ttl#PostFileSlug"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#contentType">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<calli:header>Content-Type</calli:header>
	<rdfs:domain rdf:resource="/callimachus/folder.ttl#PostFileSlug"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#content">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>*/*</calli:type>
	<rdfs:domain rdf:resource="/callimachus/folder.ttl#PostFileSlug"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#GetFolderFeed">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x62"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x63"/>
	<calli:type>application/sparql-results+xml;q=0.1</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<calli:query>contents</calli:query>
	<calli:rel>contents</calli:rel>
	<calli:transform rdf:resource="/callimachus/transforms/TransformIntoAtom"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;
		PREFIX skosxl:&lt;http://www.w3.org/2008/05/skos-xl#&gt;
		PREFIX dc:&lt;http://purl.org/dc/elements/1.1/&gt;
		PREFIX dcterms:&lt;http://purl.org/dc/terms/&gt;
		PREFIX foaf:&lt;http://xmlns.com/foaf/0.1/&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT REDUCED * {
			{
				$this rdfs:label ?title
				BIND (concat(str($this),"?contents") as ?id)
				BIND ("feed" as ?type)
				BIND (?title as ?collection_title)
				BIND (concat(str($this),"?contents") as ?collection_href)
				BIND (concat(str($this),"?describe") as ?link_href)
				BIND ("describedby" as ?link_rel)
			} UNION {
				{ $this a &lt;Realm&gt; } UNION { $this a &lt;Origin&gt; }
				BIND (concat(str($this),"?contents") as ?id)
				BIND (concat(str($this),"?search") as ?link_href)
				BIND ("search" as ?link_rel)
				BIND ("application/opensearchdescription+xml" as ?link_type)
			} UNION {
				BIND ("feed" as ?type)
				BIND (concat(str($this),"?contents") as ?id)
				$this audit:revision [audit:committedOn ?updated]
				BIND (concat(str($this),"?changes") as ?link_href)
				BIND ("alternate" as ?link_rel)
				BIND ("application/atom+xml" as ?link_type)
			} UNION {
				BIND ("feed" as ?type)
				BIND (concat(str($this),"?contents") as ?id)
				[a &lt;Creatable&gt;] calli:type ?collection_accept
			} UNION {
				{
					SELECT (concat(str($this),"?contents") as ?id) (count(distinct ?part) as ?totalResults) ("feed" as ?type) {
						$this calli:hasComponent ?part
					} GROUP BY $this
				}
			} UNION {
				{
					SELECT REDUCED ?id ?title {
						$this calli:hasComponent ?id
						FILTER (isIRI(?id))
						OPTIONAL {
							?id skos:prefLabel ?title
						} OPTIONAL {
							?id foaf:name ?title
						} OPTIONAL {
							?id rdfs:label ?title
						} OPTIONAL {
							?id skosxl:literalForm ?title
						} OPTIONAL {
							?id dcterms:title ?title
						}
					} ORDER BY ?id LIMIT 100
				}
				OPTIONAL {
					{
						?id audit:revision ?revision . ?revision audit:committedOn ?updated
						OPTIONAL {
							?revision audit:contributor ?contributor_uri
							OPTIONAL {
								?contributor_uri rdfs:label ?contributor_name
							}
						}
					} UNION {
						?id rdfs:comment ?summary
					} UNION {
						?id a [calli:icon ?icon]
					} UNION {
						?id calli:reader ?link_reader_href
						OPTIONAL {
							?link_reader_href rdfs:label ?link_reader_title
						}
					} UNION {
						?id calli:contributor ?link_contributor_href
						OPTIONAL {
							?link_contributor_href rdfs:label ?link_contributor_title
						}
					} UNION {
						?id calli:editor ?link_editor_href
						OPTIONAL {
							?link_editor_href rdfs:label ?link_editor_title
						}
					} UNION {
						?id calli:administrator ?link_administrator_href
						OPTIONAL {
							?link_administrator_href rdfs:label ?link_administrator_title
						}
					} UNION {
						$this calli:hasComponent ?id
						BIND (?id as ?content_src)
						OPTIONAL {
							?id a [calli:type ?content_type]
							BIND (?id as ?link_edit_media_href)
						}
					} UNION {
						{ ?id a &lt;Folder&gt; } UNION { ?id a &lt;Realm&gt; }
						BIND (concat(str(?id),"?contents") as ?link_href)
						BIND ("contents" as ?link_rel)
						BIND ("application/atom+xml" as ?link_type)
					} UNION {
						{ ?id a &lt;Folder&gt; } UNION { ?id a &lt;Realm&gt; }
						BIND (concat(str(?id),"?archive") as ?link_href)
						BIND (calli:archive as ?link_rel)
						BIND ("application/zip" as ?link_type)
					} UNION {
						$this calli:hasComponent ?id
						BIND (concat(str(?id),"?view") as ?link_view_href)
						BIND (concat(str(?id),"?describe") as ?link_describedby_href)
						BIND (concat(str(?id),"?history") as ?link_history_href)
					}
				}
			}
		} ORDER BY desc(?type) ?id
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#DownloadFolderComponents">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x64"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x65"/>
	<calli:type>message/x-response</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-store</calli:header>
	<msg:script>
		var http11 = new ProtocolVersion("HTTP", 1, 1);
		var resp = new BasicHttpResponse(http11, 200, "OK");
		var name = this.resource.localName;
		var filename = this.toUri().path.substring(1).replace(/\//g, '-') + this.toUri().authority.replace(/:.*/,'') + '.car';
		resp.setHeader("Content-Disposition", 'attachment;filename="' + filename + '"');
		var baseURI = this.toString();
		if (this.calliHasComponent.isEmpty() || baseURI.charAt(baseURI.length - 1) != '/')
			return null;
		var component = this;
		var entity = new InputStreamEntity(new org.callimachusproject.server.util.ProducerStream(function(outputStream) {
			var carStream = new org.callimachusproject.io.CarOutputStream(outputStream);
			component.ExportComponents(baseURI, carStream);
			carStream.finish();
		}), -1);
		entity.contentType = "application/zip";
		resp.setEntity(entity);
		return resp;
	</msg:script>
	<msg:imports rdf:resource="java:org.apache.http.ProtocolVersion"/>
	<msg:imports rdf:resource="java:org.apache.http.message.BasicHttpResponse"/>
	<msg:imports rdf:resource="java:org.apache.http.entity.InputStreamEntity"/>
	<calli:realm rdf:resource="/"/>
	<calli:query>archive</calli:query>
	<calli:rel rdf:resource="http://callimachusproject.org/rdf/2009/framework#archive"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#ExportComponents">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x66"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x67"/>
	<msg:script>
		var buf = java.lang.reflect.Array.newInstance(java.lang.Byte.TYPE, 1024);
		var xf = new org.callimachusproject.io.RDFXMLStreamWriterFactory();
		function writeTo(triples, entryStream) {
			try {
				var writer = xf.createWriter(entryStream, component.toString());
				writer.startRDF();
				var namespaces = component.objectConnection.getNamespaces();
				while (namespaces.hasNext()) {
					var ns = namespaces.next();
					writer.handleNamespace(ns.getPrefix(), ns.getName());
				}
				while (triples.hasNext()) {
					var st = triples.next();
					var pred = st.predicate.toString();
					if (pred != "http://www.openrdf.org/rdf/2009/auditing#revision"
							&amp;&amp; pred != "http://www.openrdf.org/rdf/2011/keyword#phone") {
						writer.handleStatement(st);
					}
				}
				writer.endRDF();
			} finally {
				entryStream.close();
			}
		}
		var writtenNames = new java.util.HashSet();
		var components = this.calliHasComponent.iterator();
		while (components.hasNext()) {
			var component = components.next();
			if (component.toString().indexOf(baseURI) != 0 || !component.auditRevision)
				continue;
			var name = component.toString().substring(baseURI.length);
			if (!writtenNames.add(name))
				continue;
			var time = component.auditRevision.getCommittedOn().toGregorianCalendar().getTimeInMillis();
			if (name.lastIndexOf('/') == name.length - 1 &amp;&amp; component instanceof Folder) {
				//# Export Folder
				carStream.writeFolderEntry(name, time).close();
			} else if (component instanceof File) {
				//# Export File
				var content = component.openInputStream();
				if (content) {
					try {
						var entryStream = carStream.writeFileEntry(name, time, component.GetFileContentType());
						try {
							var read;
							while ((read = content.read(buf)) &gt;= 0) {
								entryStream.write(buf, 0, read);
							}
						} finally {
							entryStream.close();
						}
					} finally {
						content.close();
					}
				} else if (component.objectConnection.hasStatement(null, null, null, false, [component.resource])) {
					//# Export Graph
					var triples = component.objectConnection.getStatements(null, null, null, false, [component.resource]);
					try {
						writeTo(triples, carStream.writeFileEntry(name, time, "application/rdf+xml"));
					} finally {
						triples.close();
					}
				}
			} else if (component instanceof Class) {
				//# Export Schema
				var triples = component.GetDescription();
				try {
					writeTo(triples, carStream.writeSchemaEntry(name, time, "application/rdf+xml"));
				} finally {
					triples.close();
				}
			} else {
				//# Export Triples
				var triples = component.GetDescription();
				try {
					writeTo(triples, carStream.writeResourceEntry(name, time, "application/rdf+xml"));
				} finally {
					triples.close();
				}
			}
			//# Export nested components
			if (component instanceof Composite) {
				component.ExportComponents(baseURI, carStream);
			}
		}
	</msg:script>
	<msg:imports rdf:resource="/callimachus/Folder"/>
	<msg:imports rdf:resource="/callimachus/File"/>
	<msg:imports rdf:resource="/callimachus/Class"/>
	<msg:imports rdf:resource="/callimachus/Composite"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#baseURI">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/folder.ttl#ExportComponents"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#carStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:domain rdf:resource="/callimachus/folder.ttl#ExportComponents"/>
	<rdfs:range rdf:resource="java:org.callimachusproject.io.CarOutputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#GetFolderUploadPage">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x68"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x69"/>
	<calli:type>application/xhtml+xml</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<msg:script>
		return folder_import_xhtml.calliConstruct(this);
	</msg:script>
	<msg:imports rdf:resource="/callimachus/pages/folder-import.xhtml"/>
	<calli:realm rdf:resource="/"/>
	<calli:query>import</calli:query>
	<calli:transform rdf:resource="/callimachus/transforms/TransformPage"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#ImportFolderComponents">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x70"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x71"/>
	<calli:method>POST</calli:method>
	<msg:script>
		var bio = new org.callimachusproject.io.LatencyInputStream(formData);
		var multipart = new org.callimachusproject.io.MultipartParser(bio);
		var inputStream = multipart.next();
		try {
			println("Importing folder content from: " + multipart.headers.get("content-disposition"));
			this.UploadFolderComponents(inputStream);
			println("Imported folder content for: " + this);
			return this;
		} finally {
			inputStream.close();
			if (multipart.next() != null)
				throw new BadRequest("Only one file can be uploaded");
		}
	</msg:script>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<calli:realm rdf:resource="/"/>
	<calli:expect>302-see-other</calli:expect>
	<calli:query>import</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#formData">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>multipart/form-data</calli:type>
	<rdfs:domain rdf:resource="/callimachus/folder.ttl#ImportFolderComponents"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#UploadFolderComponents">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x72"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x73"/>
	<calli:method>PUT</calli:method>
	<msg:script>
		var con = this.objectConnection;
		var vf = con.getValueFactory();
		function readFrom(entryStream, uri, graphs) {
			var inserter = new org.callimachusproject.form.helpers.TripleInserter(con);
			inserter.enforceContext(graphs);
			var parser = new org.openrdf.rio.rdfxml.RDFXMLParser();
			parser.setValueFactory(vf);
			parser.setRDFHandler(inserter);
			parser.parse(entryStream, uri);
			if (inserter.isEmpty())
				throw new BadRequest("Missing resource information for: " + uri);
			if (!inserter.isSingleton())
				throw new BadRequest("Multiple resources for: " + uri);
			if (inserter.getSubject().toString() != uri)
				throw new BadRequest("Wrong subject for: " + uri);
			if (inserter.isDisconnectedNodePresent())
				throw new BadRequest("Blank nodes must be connected in: " + uri);
		}
		var baseURI = this.toString();
		if (baseURI.lastIndexOf('/') != baseURI.length - 1) {
			baseURI = baseURI + '/';
		}
		var File = con.getObject(callimachus.toUri().resolve("/callimachus/File").toString());
		var SchemaGraph = vf.createURI(callimachus.toUri().resolve("/callimachus/SchemaGraph").toString());
		var dependency = new java.util.HashSet(this.FindComponentsWithExternalDependent());
		this.DeleteComponents(); //# remove existing components
		var iter = dependency.iterator();
		while (iter.hasNext()) {
			if (!con.hasStatement(null, null, iter.next().resource, true, []))
				iter.remove(); //# no longer a dependency 
		}
		var name;
		var carStream = new org.callimachusproject.io.CarInputStream(payload);
		while (name = carStream.readEntryName()) {
			var uri = baseURI + name;
			var location = con.getObject(uri);
			var folder = null;
			var container = this.FindExistingContainer(location);
			if (!container) {
				container = folder = con.getObject(uri.substring(0, uri.lastIndexOf('/', uri.length - 2) + 1));
				if (!(container instanceof Composite)) {
					container = folder = this.DesignateAsFolder(container);
				}
			}
			var entryStream = carStream.getEntryStream();
			try {
				if (carStream.isFolderEntry()) {
					this.DesignateAsFolder(location);
					dependency.remove(location);
				} else if (carStream.isFileEntry()) {
					if (!(container instanceof Composite))
						throw new BadRequest("Schema data about " + container + " must be imported before " + uri);
					var type = carStream.getEntryType();
					container.PostFactoryCreate(entryStream, File, null, location, type);
					dependency.remove(location);
				} else if (carStream.isResourceEntry()) {
					readFrom(entryStream, uri, []);
					if (folder) {
						folder.calliHasComponent.add(location);
					}
					dependency.remove(location);
				} else if (carStream.isSchemaEntry()) {
					var graphURI = vf.createURI(uri + ".owl");
					con.clear([graphURI]);
					con.add(graphURI, RDF.TYPE, SchemaGraph, [graphURI]);
					readFrom(entryStream, uri, [graphURI]);
					if (folder) {
						folder.calliHasComponent.add(location);
					}
					dependency.remove(location);
					con.recompileSchemaOnClose();
				}
			} finally {
				entryStream.close();
			}
		}
		if (!dependency.isEmpty())
			throw new BadRequest(dependency.size() + " required resource(s) not present: " + dependency.iterator().next());
	</msg:script>
	<msg:imports rdf:resource="/callimachus"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDF"/>
	<msg:imports rdf:resource="/callimachus/Composite"/>
	<msg:imports rdf:resource="java:org.openrdf.rio.RDFFormat"/>
	<calli:realm rdf:resource="/"/>
	<calli:query>archive</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#payload">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/zip</calli:type>
	<rdfs:domain rdf:resource="/callimachus/folder.ttl#UploadFolderComponents"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#FindComponentsWithExternalDependent">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x74"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x75"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;
		PREFIX skosxl:&lt;http://www.w3.org/2008/05/skos-xl#&gt;
		PREFIX dc:&lt;http://purl.org/dc/elements/1.1/&gt;
		PREFIX dcterms:&lt;http://purl.org/dc/terms/&gt;
		PREFIX foaf:&lt;http://xmlns.com/foaf/0.1/&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT ?component {
			$this calli:hasComponent+ ?component .
			?external ?dependent ?component
			FILTER (!isIRI(?external) || !strstarts(str(?external), str($this)))
			FILTER (?dependent != audit:contributedTo &amp;&amp; ?dependent != audit:modified)
			FILTER (?dependent != rdf:subject &amp;&amp; ?dependent != rdf:object)
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#DeleteComponents">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x76"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x77"/>
	<msg:script>
		var con = this.objectConnection;
		var vf = con.getValueFactory();
		function removeTriples(subject, hash) {
			var stmts = con.getStatements(subject, null, null, []);
			try {
				while (stmts.hasNext()) {
					var st = stmts.next();
					if (st.object instanceof BNode &amp;&amp; !st.object.equals(subject)) {
						removeTriples(st.object, hash);
					} else if (st.object instanceof URI &amp;&amp; !st.object.equals(subject)) {
						if (st.object.stringValue().indexOf(hash) == 0) {
							removeTriples(st.object, hash);
						} else {
							con.getObjectFactory().createObject(st.object).touchRevision();
						}
					}
					con.remove(st, []);
				}
			} finally {
				stmts.close();
			}
		}
		var components = this.calliHasComponent.iterator();
		while (components.hasNext()) {
			var component = components.next();
			if (component instanceof Composite) {
				component.DeleteComponents();
			}

			con.clear([component.resource]); //# clear graph
			removeTriples(component.resource, component.resource.stringValue() + '#'); //# follow blank and hash references
			if (component instanceof FileObject) {
				component['delete'](); //# remove document
			}
			components.remove();
		}
	</msg:script>
	<msg:imports rdf:resource="/callimachus/Composite"/>
	<msg:imports rdf:resource="java:org.openrdf.model.BNode"/>
	<msg:imports rdf:resource="java:org.openrdf.model.URI"/>
	<msg:imports rdf:resource="java:javax.tools.FileObject"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#FindExistingContainer">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x78"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x79"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;
		PREFIX skosxl:&lt;http://www.w3.org/2008/05/skos-xl#&gt;
		PREFIX dc:&lt;http://purl.org/dc/elements/1.1/&gt;
		PREFIX dcterms:&lt;http://purl.org/dc/terms/&gt;
		PREFIX foaf:&lt;http://xmlns.com/foaf/0.1/&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT ?composite {
			?composite calli:hasComponent $component
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#component">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:domain rdf:resource="/callimachus/folder.ttl#FindExistingContainer"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#DesignateAsFolder">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x80"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x81"/>
	<msg:script>
		if (nonFolder instanceof Folder)
			return nonFolder;
		var con = this.objectConnection;
		var vf = con.getValueFactory();
		var uri = nonFolder.toString();
		var container = this.FindExistingContainer(nonFolder);
		if (!container) {
			container = con.getObject(uri.substring(0, uri.lastIndexOf('/', uri.length - 2) + 1));
			if (!(container instanceof Folder)) {
				container = this.DesignateAsFolder(container);
			}
		}
		if (!(container instanceof Composite))
			throw new BadRequest("Schema data about " + container + " must be imported before " + uri);
		var label = decodeURI(uri.substring(uri.lastIndexOf('/', uri.length - 2) + 1, uri.length - 1)).replace(/-/g, ' ');
		con.add(nonFolder.resource, RDFS.LABEL, vf.createLiteral(label), []);
		nonFolder.calliEditor.addAll(container.FindContributor(nonFolder));
		nonFolder.calliReader.addAll(container.SelectAllReaders());
		nonFolder.calliEditor.addAll(container.SelectAllEditors());
		nonFolder.calliAdministrator.addAll(container.SelectAllAdministrators());
		container.calliHasComponent.add(nonFolder);
		con.add(nonFolder.resource, RDF.TYPE, vf.createURI("http://callimachusproject.org/rdf/2009/framework#Folder"), []);
		return con.addDesignation(nonFolder, Folder);
	</msg:script>
	<msg:imports rdf:resource="/callimachus/Folder"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDF"/>
	<msg:imports rdf:resource="/callimachus/Composite"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/folder.ttl#nonFolder">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:domain rdf:resource="/callimachus/folder.ttl#DesignateAsFolder"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x58">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Folder"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x59">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:org.apache.http.HttpResponse"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x60">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Folder"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x61">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x62">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Folder"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x63">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x64">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Folder"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x65">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:org.apache.http.HttpResponse"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x66">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Composite"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x67">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x68">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Folder"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x69">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:javax.xml.stream.XMLEventReader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x70">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Folder"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x71">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2000/01/rdf-schema#Resource"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x72">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Folder"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x73">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x74">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Folder"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x75">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#objectSet"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x76">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Composite"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x77">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x78">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Folder"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x79">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2000/01/rdf-schema#Resource"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x80">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Folder"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x81">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Folder"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/font.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Font">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Font</rdfs:label>
	<rdfs:subClassOf rdf:resource="/callimachus/File"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/users"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/font.png"/>
	<calli:create rdf:resource="/callimachus/file-create.xhtml"/>
	<calli:type>application/font-woff</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/font.ttl#GetFont">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x82"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x83"/>
	<calli:type>application/font-woff</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openInputStream()</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/font.ttl#LookupFontFile">
	<msg:script>
		if (type == "application/font-woff") {
			var uri = this.toUri().resolve("/callimachus/Font");
			return this.objectConnection.getObject(uri.toString());
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x84"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/font.ttl#PostFontCreate">
	<msg:script>
		var con = this.objectConnection;
		var vf = con.getValueFactory();

		//# font resource
		if (location instanceof File) {
			location = location.RemoveFile();
		}
		var obj = location;
		if (!obj)
			throw new BadRequest("Missing location");

		obj = con.addDesignation(obj, this.toString()) ;

		//# add the font label
		var fileName = location.resource.localName;
		var label = fileName.replace(/([a-zA-Z_0-9])\.[a-zA-Z]+$/, "$1");
		con.add(obj.resource, RDFS.LABEL, vf.createLiteral(label), []);

		//# load font data
		var out = obj.PutFont(body) ;

		return obj;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x87"/>
	<msg:imports rdf:resource="/callimachus/File"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:java.net.URLEncoder"/>
	<msg:imports rdf:resource="java:javax.mail.util.ByteArrayDataSource"/>
	<msg:imports rdf:resource="java:javax.mail.internet.MimeMultipart"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.Conflict"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/font.ttl#PutFont">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x90"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x91"/>
	<calli:method>PUT</calli:method>
	<msg:script>
		var out = this.openOutputStream() ;
		var buf = java.lang.reflect.Array.newInstance(java.lang.Byte.TYPE, 1024);
		var read;
		try {
			while ((read = stream.read(buf)) &gt;= 0) {
				out.write(buf, 0, read);
			}
		} finally {
			out.close();
		}
		this.touchRevision();
	</msg:script>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/font.ttl#stream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<calli:type>application/font-woff</calli:type>
	<rdfs:domain rdf:resource="/callimachus/font.ttl#PutFont"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x82">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Font"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x83">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x84">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x85"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x85">
	<rdf:first rdf:nodeID="node16tas22o6x86"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x86">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x87">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x88"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x88">
	<rdf:first rdf:nodeID="node16tas22o6x89"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x89">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/Font"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x90">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Font"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x91">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/SchemaGraph">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Schema Graph</rdfs:label>
	<rdfs:subClassOf rdf:resource="/callimachus/Serviceable"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/graph.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/NamedGraph">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Named Graph</rdfs:label>
	<rdfs:subClassOf rdf:resource="/callimachus/File"/>
	<rdfs:subClassOf rdf:resource="http://www.w3.org/ns/sparql-service-description#NamedGraph"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/graph.png"/>
	<calli:create rdf:resource="/callimachus/file-create.xhtml"/>
	<calli:type>application/rdf+xml</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/GraphDocument">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Graph Document</rdfs:label>
	<rdfs:comment>Terse RDF Triple documents</rdfs:comment>
	<rdfs:subClassOf rdf:resource="/callimachus/File"/>
	<rdfs:subClassOf rdf:resource="http://www.w3.org/ns/sparql-service-description#NamedGraph"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/graph.png"/>
	<calli:edit rdf:resource="/callimachus/graph-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/graph-create.xhtml"/>
	<calli:type>text/turtle</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/graph.ttl#GetGraphDocument">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x92"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x93"/>
	<calli:type>text/turtle</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openReader(true)</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/graph.ttl#LookupGraphDocument">
	<msg:script>
		if (type == "text/turtle") {
			var uri = this.toUri().resolve("/callimachus/GraphDocument").toString();
			return this.objectConnection.getObject(uri);
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x94"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/graph.ttl#CreateGraphDocument">
	<msg:script>
		var con = this.objectConnection;
		var vf = con.valueFactory;
		if (!location)
			throw new BadRequest("Missing location request header");
		if (location instanceof File) {
			location = location.RemoveFile();
		}
		var created = location;

		var filename = created.resource.localName.replace(/([a-zA-Z_0-9])\.[a-zA-Z]+$/, "$1");
		var label = vf.createLiteral(URLDecoder.decode(filename, "UTF-8").replace(/-/g, " "));
		con.add(created.resource, RDFS.LABEL, label, []);

		created = con.addDesignation(created, this.toString());
		created = con.addDesignation(created, Document);
		created = con.addDesignation(created, NamedGraph);

		created.UploadGraphDocument(new java.io.InputStreamReader(body, "UTF-8"));
		return created;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x97"/>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Document"/>
	<msg:imports rdf:resource="/callimachus/File"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.InternalServerError"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
	<msg:imports rdf:resource="http://www.w3.org/ns/sparql-service-description#NamedGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/graph.ttl#UploadGraphDocument">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x100"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x101"/>
	<calli:method>PUT</calli:method>
	<msg:script>
		if (!reader)
			throw new BadRequest("Missing PUT request payload");
		var con = this.objectConnection;
		con.clear([this.resource]); //# clear graph
		var object = this;
		var inputStream = new org.callimachusproject.server.util.ProducerStream(function(outputStream) {
			var pipe = new java.io.OutputStreamWriter(outputStream, "UTF-8");
			var read;
			var buf = java.lang.reflect.Array.newInstance(java.lang.Character.TYPE, 1024);
			var out = object.openWriter();
			try {
				while ((read = reader.read(buf)) &gt;= 0) {
					out.write(buf, 0, read); //# save to blob
					pipe.write(buf, 0, read); //# pipe to RDF store
				}
			} finally {
				out.close();
				pipe.close();
			}
		});
		
		java.lang.System.err.println("Parsing " + this);
		con.add(inputStream, this.toString(), RDFFormat.TURTLE, [this.resource]);

		this.touchRevision();
		con.recompileSchemaOnClose();
	</msg:script>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.openrdf.rio.RDFFormat"/>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/graph.ttl#reader">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>text/turtle</calli:type>
	<rdfs:domain rdf:resource="/callimachus/graph.ttl#UploadGraphDocument"/>
	<rdfs:range rdf:resource="java:java.io.Reader"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/graph.ttl#GetNamedGraph">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x102"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x103"/>
	<calli:type>application/rdf+xml;q=0.4</calli:type>
	<calli:method>GET</calli:method>
	<calli:transform rdf:resource="/callimachus/graph.ttl#TransformNamedGraph"/>
	<msg:sparql>CONSTRUCT { ?s ?p ?o } WHERE { GRAPH $this { ?s ?p ?o } }</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/graph.ttl#TransformNamedGraph">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x104"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x105"/>
	<calli:type>application/xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/transforms/graph.xsl"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformLayout"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/graph.ttl#inputStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/graph.ttl#TransformNamedGraph"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/graph.ttl#LookupNamedGraphFile">
	<msg:script>
		if (type == "application/rdf+xml") {
			var uri = this.toUri().resolve("/callimachus/NamedGraph").toString();
			return this.objectConnection.getObject(uri);
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x106"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/graph.ttl#PostNamedGraphCreate">
	<msg:script>
		if (!location)
			throw new BadRequest("No graph location provided");
		if (location instanceof File) {
			location = location.RemoveFile();
		}

		var con = this.objectConnection;
		var vf = con.getValueFactory();
		var format = RDFFormat.forMIMEType(type.replace(/;.*/,""), RDFFormat.RDFXML);
		var fileName = location.resource.localName;
		var name = fileName.replace(/([a-zA-Z_0-9])\.[a-zA-Z]+$/g, "$1");
		var label = vf.createLiteral(name.replace(/-/g, " "));
		var obj = location;
		var uri = obj.toString();

		obj = con.addDesignation(obj, this.toString());
		obj = con.addDesignation(obj, Document);
		obj = con.addDesignation(obj, NamedGraph);
		con.add(obj.resource, RDFS.LABEL, label, []);

		obj.UploadNamedGraph(body);
		return obj;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x109"/>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Document"/>
	<msg:imports rdf:resource="/callimachus/File"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.openrdf.rio.RDFFormat"/>
	<msg:imports rdf:resource="java:java.net.URLEncoder"/>
	<msg:imports rdf:resource="http://www.w3.org/ns/sparql-service-description#NamedGraph"/>
	<msg:imports rdf:resource="java:org.callimachusproject.io.MultipartParser"/>
	<msg:imports rdf:resource="/callimachus/graph-uploaded.xhtml"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/graph.ttl#UploadNamedGraph">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x112"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x113"/>
	<calli:method>PUT</calli:method>
	<msg:script>
		if (!graphStream)
			throw new BadRequest("Missing PUT request payload");
		var con = this.objectConnection;
		con.clear([this.resource]); //# clear graph
		var object = this;
		
		java.lang.System.err.println("Parsing " + this);
		con.add(graphStream, this.toString(), RDFFormat.RDFXML, [this.resource]);

		this.touchRevision();
		java.lang.System.err.println("Imported " + this);
		con.recompileSchemaOnClose();
	</msg:script>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.openrdf.rio.RDFFormat"/>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/graph.ttl#graphStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/rdf+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/graph.ttl#UploadNamedGraph"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x92">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/GraphDocument"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x93">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.Reader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x94">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x95"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x95">
	<rdf:first rdf:nodeID="node16tas22o6x96"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x96">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x97">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x98"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x98">
	<rdf:first rdf:nodeID="node16tas22o6x99"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x99">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/GraphDocument"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x100">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/GraphDocument"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x101">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x102">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/NamedGraph"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x103">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:org.openrdf.query.GraphQueryResult"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x104">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/NamedGraph"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x105">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x106">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x107"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x107">
	<rdf:first rdf:nodeID="node16tas22o6x108"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x108">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x109">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x110"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x110">
	<rdf:first rdf:nodeID="node16tas22o6x111"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x111">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/NamedGraph"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x112">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/NamedGraph"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x113">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Group">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Group</rdfs:label>
	<rdfs:comment>Groups provide a way to assign permissions to a named set of users</rdfs:comment>
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#Group"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Viewable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Editable"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/group.png"/>
	<calli:view rdf:resource="/callimachus/group-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/group-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/group-create.xhtml"/>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/group.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/hypertext.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/HypertextFile">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Hypertext File</rdfs:label>
	<rdfs:comment>Hypertext files</rdfs:comment>
	<rdfs:subClassOf rdf:resource="/callimachus/File"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/hypertext.png"/>
	<calli:view rdf:resource="/callimachus/hypertext-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/hypertext-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/hypertext-create.xhtml"/>
	<calli:type>text/html</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/hypertext.ttl#GetHypertextFile">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x114"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x115"/>
	<calli:type>text/html</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openReader(true)</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/hypertext.ttl#LookupHypertextFile">
	<msg:script>
		if (type == "text/html") {
			var uri = this.toUri().resolve("/callimachus/HypertextFile").toString();
			return this.objectConnection.getObject(uri);
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x116"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/hypertext.ttl#CreateHypertextFile">
	<msg:script>
		var con = this.objectConnection;
		var vf = con.valueFactory;
		if (!location)
			throw new BadRequest("Missing location request header");
		if (location instanceof File) {
			location = location.RemoveFile();
		}
		var created = location;

		var filename = created.resource.localName.replace(/([a-zA-Z_0-9])\.[a-zA-Z]+$/, "$1");
		var label = vf.createLiteral(URLDecoder.decode(filename, "UTF-8").replace(/-/g, " "));
		con.add(created.resource, RDFS.LABEL, label, []);

		created = con.addDesignation(created, this.toString());
		created = con.addDesignation(created, Document);

		created.UploadHypertextFile(new java.io.InputStreamReader(body, "UTF-8"));
		return created;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x119"/>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Document"/>
	<msg:imports rdf:resource="/callimachus/File"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.InternalServerError"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/hypertext.ttl#UploadHypertextFile">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x122"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x123"/>
	<calli:method>PUT</calli:method>
	<msg:script>
		if (!reader)
			throw new BadRequest("Missing PUT request payload");
		var read;
		var buf = java.lang.reflect.Array.newInstance(java.lang.Character.TYPE, 1024);
		var out = this.openWriter();
		try {
			while ((read = reader.read(buf)) &gt;= 0) {
				out.write(buf, 0, read);
			}
		} finally {
			out.close();
		}
		this.touchRevision();
	</msg:script>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
	<msg:imports rdf:resource="java:org.openrdf.query.QueryLanguage"/>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/hypertext.ttl#reader">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>text/html</calli:type>
	<rdfs:domain rdf:resource="/callimachus/hypertext.ttl#UploadHypertextFile"/>
	<rdfs:range rdf:resource="java:java.io.Reader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x114">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/HypertextFile"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x115">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.Reader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x116">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x117"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x117">
	<rdf:first rdf:nodeID="node16tas22o6x118"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x118">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x119">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x120"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x120">
	<rdf:first rdf:nodeID="node16tas22o6x121"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x121">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/HypertextFile"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x122">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/HypertextFile"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x123">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/image.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Image">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Image</rdfs:label>
	<rdfs:subClassOf rdf:resource="/callimachus/File"/>
	<rdfs:subClassOf rdf:resource="http://xmlns.com/foaf/0.1/Image"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/users"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/image.png"/>
	<calli:view rdf:resource="/callimachus/image-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/image-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/file-create.xhtml"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/AnimatedGraphic">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Animated Graphic</rdfs:label>
	<rdfs:subClassOf rdf:resource="/callimachus/Image"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/users"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/image.png"/>
	<calli:create rdf:resource="/callimachus/file-create.xhtml"/>
	<calli:type>image/gif</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/IconGraphic">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Icon Graphic</rdfs:label>
	<rdfs:subClassOf rdf:resource="/callimachus/Image"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/users"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/image.png"/>
	<calli:create rdf:resource="/callimachus/file-create.xhtml"/>
	<calli:type>image/vnd.microsoft.icon</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/NetworkGraphic">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Network Graphic</rdfs:label>
	<rdfs:subClassOf rdf:resource="/callimachus/Image"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/users"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/image.png"/>
	<calli:create rdf:resource="/callimachus/file-create.xhtml"/>
	<calli:type>image/png</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/VectorGraphic">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Vector Graphic</rdfs:label>
	<rdfs:subClassOf rdf:resource="/callimachus/Image"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/users"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/image.png"/>
	<calli:create rdf:resource="/callimachus/file-create.xhtml"/>
	<calli:type>image/svg+xml</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/image.ttl#GetAnimatedGraphic">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x124"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x125"/>
	<calli:type>image/gif</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openInputStream()</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/image.ttl#GetIconGraphic">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x126"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x127"/>
	<calli:type>image/vnd.microsoft.icon</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openInputStream()</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/image.ttl#GetNetworkGraphic">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x128"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x129"/>
	<calli:type>image/png</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openInputStream()</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/image.ttl#GetVectorGraphic">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x130"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x131"/>
	<calli:type>image/svg+xml</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openInputStream()</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/image.ttl#LookupImageFile">
	<msg:script>
		var uri = null;
		if (type == "image/x-png" || type == "image/png") {
			uri = this.toUri().resolve("/callimachus/NetworkGraphic");
		} else if (type == "image/svg+xml") {
			uri = this.toUri().resolve("/callimachus/VectorGraphic");
		} else if (type == "image/vnd.microsoft.icon") {
			uri = this.toUri().resolve("/callimachus/IconGraphic");
		} else if (type == "image/gif") {
			uri = this.toUri().resolve("/callimachus/AnimatedGraphic");
		}
		if (uri) {
			return this.objectConnection.getObject(uri.toString());
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x132"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/image.ttl#LookupImage">
	<msg:script>
		var uri = null;
		if (type == "image/x-png" || type == "image/png") {
			uri = this.toUri().resolve("/callimachus/NetworkGraphic");
		} else if (type == "image/svg+xml") {
			uri = this.toUri().resolve("/callimachus/VectorGraphic");
		} else if (type == "image/vnd.microsoft.icon") {
			uri = this.toUri().resolve("/callimachus/IconGraphic");
		} else if (type == "image/gif") {
			uri = this.toUri().resolve("/callimachus/AnimatedGraphic");
		}
		if (uri) {
			return this.objectConnection.getObject(uri.toString());
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x135"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/image.ttl#PostImageCreate">
	<msg:script>
		var con = this.objectConnection;
		var vf = con.getValueFactory();

		//# image resource
		if (location instanceof File) {
			location = location.RemoveFile();
		}
		var obj = location;
		if (!obj)
			throw new BadRequest("Missing location");

		//# designate as foaf:Image
		obj = con.addDesignation(obj, this.toString()) ;
		obj = con.addDesignation(obj, Image);

		//# add the image label
		var fileName = location.resource.localName;
		var label = fileName.replace(/([a-zA-Z_0-9])\.[a-zA-Z]+$/, "$1");
		con.add(obj.resource, RDFS.LABEL, vf.createLiteral(label), []);

		//# load image data
		var out = obj.PutImage(body) ;

		return obj;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x138"/>
	<msg:imports rdf:resource="/callimachus/File"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:java.net.URLEncoder"/>
	<msg:imports rdf:resource="java:javax.mail.util.ByteArrayDataSource"/>
	<msg:imports rdf:resource="java:javax.mail.internet.MimeMultipart"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.Conflict"/>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Image"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/image.ttl#PutImage">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x146"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x147"/>
	<calli:method>PUT</calli:method>
	<msg:script>
		var out = this.openOutputStream() ;
		var buf = java.lang.reflect.Array.newInstance(java.lang.Byte.TYPE, 1024);
		var read;
		try {
			while ((read = imageStream.read(buf)) &gt;= 0) {
				out.write(buf, 0, read);
			}
		} finally {
			out.close();
		}
		this.touchRevision();
	</msg:script>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/image.ttl#imageStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<calli:type>application/octet-stream</calli:type>
	<rdfs:domain rdf:resource="/callimachus/image.ttl#PutImage"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x124">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/AnimatedGraphic"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x125">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x126">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/IconGraphic"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x127">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x128">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/NetworkGraphic"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x129">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x130">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/VectorGraphic"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x131">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x132">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x133"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x133">
	<rdf:first rdf:nodeID="node16tas22o6x134"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x134">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x135">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x136"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x136">
	<rdf:first rdf:nodeID="node16tas22o6x137"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x137">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/Image"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x138">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x139"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x139">
	<rdf:first rdf:nodeID="node16tas22o6x140"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x140">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:nodeID="node16tas22o6x141"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x142">
	<rdf:first rdf:resource="/callimachus/NetworkGraphic"/>
	<rdf:rest rdf:nodeID="node16tas22o6x143"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x143">
	<rdf:first rdf:resource="/callimachus/VectorGraphic"/>
	<rdf:rest rdf:nodeID="node16tas22o6x144"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x144">
	<rdf:first rdf:resource="/callimachus/IconGraphic"/>
	<rdf:rest rdf:nodeID="node16tas22o6x145"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x145">
	<rdf:first rdf:resource="/callimachus/AnimatedGraphic"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x141">
	<owl:oneOf rdf:nodeID="node16tas22o6x142"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x146">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Image"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x147">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Menu">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#Menu"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Viewable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Editable"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:view rdf:resource="/callimachus/menu-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/menu-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/menu-create.xhtml"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/menu.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/menu.ttl#GetMenuItems">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x148"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x149"/>
	<calli:type>application/sparql-results+xml;q=0.1</calli:type>
	<calli:method>GET</calli:method>
	<calli:query>items</calli:query>
	<calli:transform rdf:resource="/callimachus/menu.ttl#TransformMenu"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT DISTINCT ?heading ?label ?link ?group
		WHERE {
			{
				$this calli:item ?item
			} UNION {
				$this calli:item [rdfs:label ?heading; calli:item ?item]
			}
			?item rdfs:label ?label.
			OPTIONAL {
				?item calli:position ?position
			}
			OPTIONAL {
				?item calli:link ?link
			}
			OPTIONAL {
				?item calli:group ?group
			}
		}
		ORDER BY ?position ?label
		LIMIT 100
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/menu.ttl#TransformMenu">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x150"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x151"/>
	<calli:type>application/xhtml+xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/transforms/menu.xsl"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/menu.ttl#xml">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/sparql-results+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/menu.ttl#TransformMenu"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/menu.ttl#PostEditMenu">
	<msg:script>HTTPObjectServer.resetAllCache(); return proceed();</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x152"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x148">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Menu"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x149">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x150">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Menu"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x151">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x152">
	<rdf:first rdf:resource="/callimachus/toolbox/edit.ttl#PostEdit"/>
	<rdf:rest rdf:nodeID="node16tas22o6x153"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x153">
	<rdf:first rdf:nodeID="node16tas22o6x154"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x154">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Menu"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Origin">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Origin</rdfs:label>
	<rdfs:comment>Root path of an http or https authority</rdfs:comment>
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#Origin"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Realm"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:icon rdf:resource="/callimachus/realm.png"/>
	<calli:view rdf:resource="/callimachus/folder-view.xhtml"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/origin.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/origin.ttl#GetListOfRealms">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x155"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x156"/>
	<calli:type>application/sparql-results+xml;q=0.1</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<calli:query>realms</calli:query>
	<calli:rel rdf:resource="http://callimachusproject.org/rdf/2009/framework#realms"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformIntoAtom"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT REDUCED * {
			{
				$this rdfs:label ?title
				BIND (concat(str($this),"?realms") as ?id)
				BIND ("feed" as ?type)
			} UNION {
				{ ?id a &lt;Origin&gt; } UNION { ?id a &lt;Realm&gt; }
				{
					?id rdfs:label ?title
				} UNION {
					?id audit:revision ?revision . ?revision audit:committedOn ?updated
					OPTIONAL {
						?revision audit:contributor ?contributor_uri
						OPTIONAL {
							?contributor_uri rdfs:label ?contributor_name
						}
					}
				} UNION {
					?id rdfs:comment ?summary
				} UNION {
					?id a [calli:icon ?icon]
				} UNION {
					{ ?id a &lt;Origin&gt; } UNION { ?id a &lt;Realm&gt; }
					BIND (concat(str(?id),"?view") as ?link_view_href)
					BIND (concat(str(?id),"?describe") as ?link_describedby_href)
					BIND (concat(str(?id),"?history") as ?link_history_href)
					BIND (?id as ?content_src)
					OPTIONAL {
						?id a [calli:type ?content_type]
						BIND (?id as ?link_edit_media_href)
					}
				} UNION {
					{ ?id a &lt;Origin&gt; } UNION { ?id a &lt;Realm&gt; }
					BIND (concat(str(?id),"?contents") as ?link_href)
					BIND ("contents" as ?link_rel)
					BIND ("application/atom+xml" as ?link_type)
				} UNION {
					{ ?id a &lt;Origin&gt; } UNION { ?id a &lt;Realm&gt; }
					BIND (concat(str(?id),"?archive") as ?link_href)
					BIND (calli:archive as ?link_rel)
					BIND ("application/zip" as ?link_type)
				}
			}
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x155">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Origin"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x156">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/page.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Page">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Page</rdfs:label>
	<rdfs:comment>New pages can be created in a folder</rdfs:comment>
	<rdfs:subClassOf rdf:resource="/callimachus/File"/>
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#Page"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/page.png"/>
	<calli:edit rdf:resource="/callimachus/page-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/page-create.xhtml"/>
	<calli:type>application/xhtml+xml</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/page.ttl#GetPage">
	<msg:script>
		return this.calliConstruct(this);
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x157"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/page.ttl#GetPageSource">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x160"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x161"/>
	<calli:type>application/xhtml+xml</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openInputStream()</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/page.ttl#LookupPage">
	<msg:script>
		if (type == "application/xhtml+xml") {
			var uri = this.toUri().resolve("/callimachus/Page").toString();
			return this.objectConnection.getObject(uri);
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x162"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/page.ttl#CreatePage">
	<msg:script>
		var con = this.objectConnection;
		var vf = con.valueFactory;
		if (!location)
			throw new BadRequest("Missing location request header");

		if (location instanceof File) {
			location = location.RemoveFile();
		}
		var created = location;

		var filename = created.resource.localName.replace(/([a-zA-Z_0-9])\.[a-zA-Z]+$/, "$1");
		var label = vf.createLiteral(URLDecoder.decode(filename, "UTF-8").replace(/-/g, " "));
		con.add(created.resource, RDFS.LABEL, label, []);

		created = con.addDesignation(created, this.toString());
		created = con.addDesignation(created, Page);
		created = con.addDesignation(created, Document);

		created.UploadPage(body);
		return created;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x165"/>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Document"/>
	<msg:imports rdf:resource="/callimachus/File"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.InternalServerError"/>
	<msg:imports rdf:resource="http://callimachusproject.org/rdf/2009/framework#Page"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/page.ttl#UploadPage">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x168"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x169"/>
	<calli:method>PUT</calli:method>
	<msg:script>
		var read;
		var buf = java.lang.reflect.Array.newInstance(java.lang.Byte.TYPE, 1024);
		var out = this.openOutputStream();
		try {
			while ((read = xhtmlStream.read(buf)) &gt;= 0) {
				out.write(buf, 0, read);
			}
		} finally {
			out.close();
		}
		var input = this.openInputStream();
		try {
			// verify we can parse it as XML
			var xslt = new org.openrdf.repository.object.xslt.XSLTransformer();
			xslt.transform(input, this.toString()).asDocument();
		} finally {
			input.close();
		}
		this.touchRevision();
		HTTPObjectServer.resetAllCache();
	</msg:script>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/page.ttl#xhtmlStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/xhtml+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/page.ttl#UploadPage"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x157">
	<rdf:first rdf:resource="/callimachus/toolbox/view.ttl#GetViewPage"/>
	<rdf:rest rdf:nodeID="node16tas22o6x158"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x158">
	<rdf:first rdf:nodeID="node16tas22o6x159"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x159">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Page"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x160">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Page"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x161">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x162">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x163"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x163">
	<rdf:first rdf:nodeID="node16tas22o6x164"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x164">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x165">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x166"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x166">
	<rdf:first rdf:nodeID="node16tas22o6x167"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x167">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/Page"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x168">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Page"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x169">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/photo.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Photo">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Photo</rdfs:label>
	<rdfs:subClassOf rdf:resource="/callimachus/Image"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/users"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/photo.png"/>
	<calli:view rdf:resource="/callimachus/photo-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/photo-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/file-create.xhtml"/>
	<calli:type>image/jpeg</calli:type>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/photo.ttl#GetPhoto">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x170"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x171"/>
	<calli:type>image/jpeg</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openInputStream()</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/photo.ttl#LookupPhotoFile">
	<msg:script>
		if (type == "image/pjpeg" || type == "image/jpeg") {
			var uri = this.toUri().resolve("/callimachus/Photo").toString();
			return this.objectConnection.getObject(uri);
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x172"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/photo.ttl#LookupPhotoImage">
	<msg:script>
		if (type == "image/pjpeg" || type == "image/jpeg") {
			var uri = this.toUri().resolve("/callimachus/Photo").toString();
			return this.objectConnection.getObject(uri);
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x175"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/photo.ttl#PostPhotoCreate">
	<msg:script>
		var con = this.objectConnection;
		var vf = con.getValueFactory();

		//# image resource
		if (location instanceof File) {
			location = location.RemoveFile();
		}
		var obj = location;
		if (!obj)
			throw new BadRequest("Missing location");

		//# designate as &lt;Image&gt; and the relevant mimetype
		obj = con.addDesignation(obj, this.toString()) ;
		obj = con.addDesignation(obj, Image) ;

		//# add the image label
		var fileName = location.resource.localName;
		var label = fileName.replace(/([a-zA-Z_0-9])\.[a-zA-Z]+$/, "$1");
		con.add(obj.resource, RDFS.LABEL, vf.createLiteral(label), []);

		//# load image data
		var out = obj.PutPhoto(body) ;

		return obj;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x178"/>
	<msg:imports rdf:resource="/callimachus/File"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:java.net.URLEncoder"/>
	<msg:imports rdf:resource="java:javax.mail.util.ByteArrayDataSource"/>
	<msg:imports rdf:resource="java:javax.mail.internet.MimeMultipart"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.Conflict"/>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Image"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/photo.ttl#PutPhoto">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x181"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x182"/>
	<calli:method>PUT</calli:method>
	<msg:script>
		var out = this.openOutputStream() ;
		var buf = java.lang.reflect.Array.newInstance(java.lang.Byte.TYPE, 1024);
		var read;
		try {
			while ((read = imageStream.read(buf)) &gt;= 0) {
				out.write(buf, 0, read);
			}
		} finally {
			out.close();
		}
		this.touchRevision();
	</msg:script>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/photo.ttl#imageStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<calli:type>application/octet-stream</calli:type>
	<rdfs:domain rdf:resource="/callimachus/photo.ttl#PutPhoto"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/photo.ttl#GetPhotoLarge">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x183"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x184"/>
	<calli:type>image/png</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		return this.ResizePhoto(this.openInputStream(), 1080);
	</msg:script>
	<calli:query>large</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/photo.ttl#GetPhotoMedium">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x185"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x186"/>
	<calli:type>image/png</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		return this.ResizePhoto(this.GetPhotoLarge(), 480);
	</msg:script>
	<calli:query>medium</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/photo.ttl#GetPhotoSmall">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x187"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x188"/>
	<calli:type>image/png</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		return this.ResizePhoto(this.GetPhotoMedium(), 240);
	</msg:script>
	<calli:query>small</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/photo.ttl#GetPhotoThumbnail">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x189"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x190"/>
	<calli:type>image/png</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		return this.ResizePhoto(this.GetPhotoSmall(), 64);
	</msg:script>
	<calli:query>thumbnail</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/photo.ttl#ResizePhoto">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x191"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x192"/>
	<msg:script>
		var image = ImageIO.read(inputStream);
		var height = Math.min(minSize, image.getHeight());
		var width = image.getWidth() * height / image.getHeight();
		if (width &lt; minSize) {
			width = Math.min(minSize,  image.getWidth());
			height = image.getHeight() * width / image.getWidth();
		}
		var blurKernel = java.lang.reflect.Array.newInstance(java.lang.Float.TYPE, 9);
		for (var i=0; i&lt;9; i++) {
			blurKernel[i] = 1.0/9.0;
		}
		var map = new java.util.HashMap();
		map.put(RenderingHints.KEY_INTERPOLATION,
		RenderingHints.VALUE_INTERPOLATION_BILINEAR);
		map.put(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_QUALITY);
		map.put(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);
		var hints = new RenderingHints(map);
		var op = new ConvolveOp(new Kernel(3, 3, blurKernel), ConvolveOp.EDGE_NO_OP, hints);
		while (height &lt; image.getHeight() &amp;&amp; width &lt; image.getWidth()) {
			var ratio = Math.floor((image.getHeight() - 1) / height);
			var w = width * ratio;
			var h = height * ratio;
			var resizedImage = new BufferedImage(w, h, BufferedImage.TYPE_INT_RGB);
			var g = resizedImage.createGraphics();
			g.drawImage(op.filter(image, null), 0, 0, w, h, null);
			g.dispose();
			g.setComposite(AlphaComposite.Src);
			g.setRenderingHint(RenderingHints.KEY_INTERPOLATION, RenderingHints.VALUE_INTERPOLATION_BILINEAR);
			g.setRenderingHint(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_QUALITY);
			g.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);
			image = resizedImage;
		}
	
		var out = new ByteArrayOutputStream();
		ImageIO.write(image, "png", out);
		return new java.io.ByteArrayInputStream(out.toByteArray());
	</msg:script>
	<msg:imports rdf:resource="java:java.awt"/>
	<msg:imports rdf:resource="java:java.awt.image"/>
	<msg:imports rdf:resource="java:javax.imageio.ImageIO"/>
	<msg:imports rdf:resource="java:java.io.ByteArrayOutputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/photo.ttl#inputStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:domain rdf:resource="/callimachus/photo.ttl#ResizePhoto"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/photo.ttl#minSize">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/photo.ttl#ResizePhoto"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#int"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/photo.ttl#AuthorizeImageResize">
	<msg:script>
		if (query == "large" || query == "medium" || query == "small" || query == "thumbnail") {
			if (method == "GET" || method == "HEAD") {
				if (this.calliIsAuthorized(credential, method, null))
					return true;
			}
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x193"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x170">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Photo"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x171">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x172">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x173"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x173">
	<rdf:first rdf:nodeID="node16tas22o6x174"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x174">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x175">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x176"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x176">
	<rdf:first rdf:nodeID="node16tas22o6x177"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x177">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/Image"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x178">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x179"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x179">
	<rdf:first rdf:nodeID="node16tas22o6x180"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x180">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/Photo"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x181">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Photo"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x182">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x183">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Photo"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x184">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x185">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Photo"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x186">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x187">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Photo"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x188">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x189">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Photo"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x190">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x191">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Photo"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x192">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x193">
	<rdf:first rdf:resource="http://callimachusproject.org/rdf/2009/framework#IsAuthorized"/>
	<rdf:rest rdf:nodeID="node16tas22o6x194"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x194">
	<rdf:first rdf:nodeID="node16tas22o6x195"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x195">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Photo"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/pipeline.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Pipeline">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Pipeline</rdfs:label>
	<rdfs:comment>New pipelines can be created from a folder</rdfs:comment>
	<rdfs:subClassOf rdf:resource="/callimachus/File"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/users"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/pipeline.png"/>
	<calli:view rdf:resource="/callimachus/pipeline-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/pipeline-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/pipeline-create.xhtml"/>
	<calli:type>application/xproc+xml</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/pipeline.ttl#GetPipelineSource">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x196"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x197"/>
	<calli:type>application/xproc+xml</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openInputStream()</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/pipeline.ttl#LookupPipelineFile">
	<msg:script>
		if (type == "application/xproc+xml") {
			var uri = this.toUri().resolve("/callimachus/Pipeline").toString();
			return this.objectConnection.getObject(uri);
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x198"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/pipeline.ttl#CreatePipeline">
	<msg:script>
		var con = this.objectConnection;
		var vf = con.valueFactory;
		if (!location)
			throw new BadRequest("Missing location request header");
		if (location instanceof File) {
			location = location.RemoveFile();
		}
		var created = location;

		var filename = created.resource.localName.replace(/([a-zA-Z_0-9])\.[a-zA-Z]+$/, "$1");
		var label = vf.createLiteral(URLDecoder.decode(filename, "UTF-8").replace(/-/g, " "));
		con.add(created.resource, RDFS.LABEL, label, []);

		created = con.addDesignation(created, this.toString());
		created = con.addDesignation(created, Document);

		created.UploadPipeline(body);
		return created;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x201"/>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Document"/>
	<msg:imports rdf:resource="/callimachus/File"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.InternalServerError"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/pipeline.ttl#UploadPipeline">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x204"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x205"/>
	<calli:method>PUT</calli:method>
	<msg:script>
		var read;
		var buf = java.lang.reflect.Array.newInstance(java.lang.Byte.TYPE, 1024);
		var out = this.openOutputStream();
		try {
			while ((read = xprocStream.read(buf)) &gt;= 0) {
				out.write(buf, 0, read);
			}
		} finally {
			out.close();
		}
		this.touchRevision();
	</msg:script>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Document"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/pipeline.ttl#xprocStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/xproc+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/pipeline.ttl#UploadPipeline"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x196">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Pipeline"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x197">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x198">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x199"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x199">
	<rdf:first rdf:nodeID="node16tas22o6x200"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x200">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x201">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x202"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x202">
	<rdf:first rdf:nodeID="node16tas22o6x203"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x203">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/Pipeline"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x204">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Pipeline"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x205">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/profile.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Profile">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Serviceable"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/profile">
	<rdf:type rdf:resource="/callimachus/Profile"/>
	<rdfs:label>profile</rdfs:label>
	<calli:administrator rdf:resource="/group/admin"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/profile.ttl#GetProfile">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x206"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x207"/>
	<calli:type>application/rdf+xml;q=0.4</calli:type>
	<calli:type>text/turtle;q=0.5</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-validate</calli:header>
	<calli:header>cache-control:max-age=300</calli:header>
	<msg:script>
		var vf = this.objectConnection.valueFactory;
		var xsd = "http://www.w3.org/2001/XMLSchema#";
		var rdfa = "http://www.w3.org/ns/rdfa#";
		var token = vf.createURI(xsd, "NMTOKEN");
		var anyURI = vf.createURI(xsd, "anyURI");
		var ns = this.resource + "#";
		var namespaces = this.objectConnection.namespaces.asList();
		var model = new LinkedHashModel();
		for (var i = 0; i &lt; namespaces.size(); i++) {
			var prefix = namespaces.get(i).prefix;
			var uri = namespaces.get(i).name;
			var node = vf.createURI(ns, prefix);
			model.setNamespace(prefix, uri);
			model.add(node, vf.createURI(rdfa, "prefix"), vf.createLiteral(prefix, token), []);
			model.add(node, vf.createURI(rdfa, "uri"), vf.createLiteral(uri, anyURI), []);
		}
		return model;
	</msg:script>
	<msg:imports rdf:resource="java:org.openrdf.model.impl.LinkedHashModel"/>
	<calli:transform rdf:resource="/callimachus/profile.ttl#TransformProfile"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/profile.ttl#TransformProfile">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x212"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x213"/>
	<calli:type>application/xhtml+xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/profile.xhtml"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformLayout"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/profile.ttl#GetJsonProfile">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x208"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x209"/>
	<calli:type>application/json;q=0.3</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-validate</calli:header>
	<calli:header>cache-control:max-age=60</calli:header>
	<msg:script>
		var output = new java.io.ByteArrayOutputStream();
		var writer = new java.io.OutputStreamWriter(output, "UTF-8");
		var namespaces = this.objectConnection.namespaces.asList();
		writer.write("{");
		for (var i = 0; i &lt; namespaces.size(); i++) {
			var prefix = namespaces.get(i).prefix;
			var uri = namespaces.get(i).name;
			writer.write('"');
			writer.write(prefix);
			writer.write('":"');
			writer.write(uri);
			writer.write('"');
			if (i &lt; namespaces.size() - 1) {
				writer.write(",\n");
			}
		}
		writer.write("}");
		writer.flush();
		return output;
	</msg:script>
	<msg:imports rdf:resource="java:java.io.ByteArrayOutputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/profile.ttl#PostProfile">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x210"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x211"/>
	<calli:method>POST</calli:method>
	<msg:script>
		var iter = form.entrySet().iterator();
		while (iter.hasNext()) {
			var entry = iter.next();
			this.objectConnection.setNamespace(entry.key, entry.value[0]);
		}
		var namespaces = this.objectConnection.namespaces.asList();
		for (var i = 0; i &lt; namespaces.size(); i++) {
			var prefix = namespaces.get(i).prefix;
			if (!form.containsKey(prefix)) {
				this.objectConnection.removeNamespace(prefix);
			}
		}
		return this;
	</msg:script>
	<calli:realm rdf:resource="/"/>
	<calli:expect>303-see-other</calli:expect>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/profile.ttl#form">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/x-www-form-urlencoded</calli:type>
	<rdfs:domain rdf:resource="/callimachus/profile.ttl#PostProfile"/>
	<rdfs:range rdf:resource="java:java.util.Map"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/profile.ttl#inputStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/rdf+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/profile.ttl#TransformProfile"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x206">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Profile"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x207">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:org.openrdf.model.impl.LinkedHashModel"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x208">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Profile"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x209">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.ByteArrayOutputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x210">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Profile"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x211">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Profile"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x212">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Profile"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x213">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/NamedQuery">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Query</rdfs:label>
	<rdfs:comment>Saved SPARQL queries</rdfs:comment>
	<rdfs:subClassOf rdf:resource="/callimachus/File"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/query.png"/>
	<calli:view rdf:resource="/callimachus/query-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/query-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/query-create.xhtml"/>
	<calli:type>application/sparql-query</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#GetNamedQuery">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x214"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x215"/>
	<calli:type>application/sparql-query</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openInputStream()</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#LookupNamedQueryFile">
	<msg:script>
		if (type == "application/sparql-query") {
			var uri = this.toUri().resolve("/callimachus/NamedQuery").toString();
			return this.objectConnection.getObject(uri);
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x216"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#CreateNamedQuery">
	<msg:script>
		var con = this.objectConnection;
		var vf = con.valueFactory;
		if (!location)
			throw new BadRequest("Missing location request header");
		if (location instanceof File) {
			location = location.RemoveFile();
		}
		var created = location;

		var filename = created.resource.localName.replace(/([a-zA-Z_0-9])\.[a-zA-Z]+$/, "$1");
		var label = vf.createLiteral(URLDecoder.decode(filename, "UTF-8").replace(/-/g, " "));
		con.add(created.resource, RDFS.LABEL, label, []);

		created = con.addDesignation(created, this.toString());
		created = con.addDesignation(created, Document);

		created.UploadNamedQuery(body);
		return created;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x219"/>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Document"/>
	<msg:imports rdf:resource="/callimachus/File"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.InternalServerError"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#UploadNamedQuery">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x222"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x223"/>
	<calli:method>PUT</calli:method>
	<msg:script>
		if (!stream)
			throw new BadRequest("Missing PUT request payload");
		var read;
		var buf = java.lang.reflect.Array.newInstance(java.lang.Byte.TYPE, 1024);
		var out = this.openOutputStream();
		try {
			while ((read = stream.read(buf)) &gt;= 0) {
				out.write(buf, 0, read);
			}
		} finally {
			out.close();
		}
		this.touchRevision();

		var con = this.objectConnection;
		var parser = ParameterizedQueryParser.newInstance();
		var query = parser.parseQuery(this.openInputStream(), this.toString());
		con.repository.createNamedQuery(this.resource, QueryLanguage.SPARQL, query.prepare(), this.toString());
	</msg:script>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
	<msg:imports rdf:resource="java:org.openrdf.query.QueryLanguage"/>
	<msg:imports rdf:resource="/callimachus/NamedQuery"/>
	<msg:imports rdf:resource="java:org.callimachusproject.engine.ParameterizedQueryParser"/>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#stream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/sparql-query</calli:type>
	<rdfs:domain rdf:resource="/callimachus/query.ttl#UploadNamedQuery"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#GetResult">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x224"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x225"/>
	<calli:type>message/x-response</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		var map = {};
		if (tqx) {
			var pairs = tqx.split(';');
			for (var i = 0; i &lt; pairs.length; i++) {
				var pair = pairs[i].split(':', 2);
				map[pair[0]] = pair[1];
			}
		}
		if (!map.responseHandler) {
			map.responseHandler = 'google.visualization.Query.setResponse';
		}
		if (!map.reqId) {
			map.reqId = '0';
		}
		var con = this.objectConnection;
		var nq = con.repository.getNamedQuery(this.resource);
		var etag = "";
		var http11 = new ProtocolVersion("HTTP", 1, 1);
		var resp = new BasicHttpResponse(http11, 200, "OK");
		if (nq) {
			etag = 'W/"' + nq.getResultTag() + '"';
			if (match == etag) {
				resp = new BasicHttpResponse(http11, 304, "Not Modified");
			}
			resp.setHeader("Last-Modified", nq.getResultLastModifiedString());
			resp.setHeader("ETag", etag);
		}
		resp.setHeader("Cache-Control", "no-cache");
		if (map.outFileName) {
			resp.setHeader("Content-Disposition", 'inline;filename="' + map.outFileName + '"');
		}
		if (nq &amp;&amp; match == etag)
			return resp;
		var entity = null;
		try {
			var parser = ParameterizedQueryParser.newInstance();
			var query = parser.parseQuery(this.openInputStream(), this.toString());
			var sparql = query.prepare(queryParameters);
			var rs = con.prepareTupleQuery(QueryLanguage.SPARQL, sparql, this.toString()).evaluate();
			if (map.out == "html") {
				entity = new InputStreamEntity(this.TransformIntoHtml(rs), -1);
				entity.contentType = "text/html;charset=UTF-8";
			} else if (map.out == "csv") {
				entity = new InputStreamEntity(this.TransformIntoCSV(rs), -1);
				entity.contentType = "text/csv;charset=UTF-8";
			} else if (map.out == "tsv-excel") {
				entity = new InputStreamEntity(this.TransformIntoTSV(rs), -1);
				entity.contentType = "text/tab-separated-values;charset=UTF-16";
			} else {
				var out = this.TransformIntoWire(map.responseHandler, map.reqId, rs);
				entity = new InputStreamEntity(out, -1);
				entity.contentType = "text/javascript;charset=UTF-8";
			}
		} catch(e) {
			if (e.javaException) {
				e = e.javaException;
			}
			if (!map.out || map.out == "json") {
				var reason = null;
				var msg = e.message;
				if (!msg) {
					msg = e.toString();
				}
				msg = msg.replace(/\n[\s\S]*/, '').replace(/'/g, '"');
				if (e instanceof MalformedQueryException) {
					reason = "reason:'invalid_query',message:'" + msg + "'";
				} else if (e instanceof IllegalArgumentException) {
					reason = "reason:'not_supported',message:'" + msg + "'";
				} else {
					reason = "reason:'internal_error',message:'" + msg + "'";
				}
				var sw = new java.io.StringWriter();
				var print = new java.io.PrintWriter(sw);
				e.printStackTrace(print);
				print.close();
				var trace = sw.toString().replace(/\n/g, '\\n').replace(/'/g, '"');
				reason = reason + ",detailed_message:'" + trace + "'";
				var json = map.responseHandler + "({reqId:'" + map.reqId + "',status:'error',errors:[{" + reason + "}]})";
				var resp = new BasicHttpResponse(http11, 200, "Internal Server Error");
				entity = new StringEntity(json);
				entity.contentType = "text/javascript;charset=UTF-8";
				e.printStackTrace(); // log the error
			} else {
				throw new InternalServerError(e.toString(), e);
			}
		}
		resp.setEntity(entity);
		return resp;
	</msg:script>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.InternalServerError"/>
	<msg:imports rdf:resource="java:org.apache.http.ProtocolVersion"/>
	<msg:imports rdf:resource="java:org.apache.http.message.BasicHttpResponse"/>
	<msg:imports rdf:resource="java:org.apache.http.entity.InputStreamEntity"/>
	<msg:imports rdf:resource="java:org.openrdf.query.QueryLanguage"/>
	<msg:imports rdf:resource="java:org.callimachusproject.engine.ParameterizedQueryParser"/>
	<msg:imports rdf:resource="java:org.apache.http.entity.StringEntity"/>
	<msg:imports rdf:resource="java:java.lang.IllegalArgumentException"/>
	<msg:imports rdf:resource="java:org.openrdf.query.MalformedQueryException"/>
	<calli:query>results</calli:query>
	<calli:query>tqx</calli:query>
	<calli:query>eval</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#tqx">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/query.ttl#GetResult"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
	<calli:query>tqx</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#queryParameters">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:domain rdf:resource="/callimachus/query.ttl#GetResult"/>
	<rdfs:range rdf:resource="java:java.util.Map"/>
	<calli:query>*</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#match">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<calli:header>If-None-Match</calli:header>
	<rdfs:domain rdf:resource="/callimachus/query.ttl#GetResult"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#TransformSparqlResult">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x226"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x227"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#xml">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/sparql-results+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/query.ttl#TransformSparqlResult"/>
	<rdfs:range rdf:resource="java:org.openrdf.query.TupleQueryResult"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#TransformIntoHtml">
	<rdfs:subClassOf rdf:resource="/callimachus/query.ttl#TransformSparqlResult"/>
	<calli:type>text/csv;charset=UTF-8</calli:type>
	<msg:xslt rdf:resource="/callimachus/transforms/sparql-results-html.xsl"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#TransformIntoCSV">
	<rdfs:subClassOf rdf:resource="/callimachus/query.ttl#TransformSparqlResult"/>
	<calli:type>text/csv;charset=UTF-8</calli:type>
	<msg:xslt rdf:resource="/callimachus/transforms/sparql-results-csv.xsl"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#TransformIntoTSV">
	<rdfs:subClassOf rdf:resource="/callimachus/query.ttl#TransformSparqlResult"/>
	<calli:type>text/csv;charset=UTF-8</calli:type>
	<msg:xslt rdf:resource="/callimachus/transforms/sparql-results-tsv.xsl"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#TransformIntoWire">
	<rdfs:subClassOf rdf:resource="/callimachus/query.ttl#TransformSparqlResult"/>
	<calli:type>text/javascript;charset=UTF-8</calli:type>
	<msg:xslt rdf:resource="/callimachus/transforms/sparql-results-wire.xsl"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#handler">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/query.ttl#TransformIntoWire"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/query.ttl#reqId">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/query.ttl#TransformIntoWire"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x214">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/NamedQuery"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x215">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x216">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x217"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x217">
	<rdf:first rdf:nodeID="node16tas22o6x218"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x218">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x219">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x220"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x220">
	<rdf:first rdf:nodeID="node16tas22o6x221"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x221">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/NamedQuery"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x222">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/NamedQuery"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x223">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x224">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/NamedQuery"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x225">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:org.apache.http.HttpResponse"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x226">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/NamedQuery"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x227">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Realm">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#Realm"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Folder"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/realm.png"/>
	<calli:edit rdf:resource="/callimachus/realm-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/realm-create.xhtml"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/realm.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/realm.ttl#GetOldTemplate">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x228"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x229"/>
	<calli:type>text/uri-list</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		return "/callimachus/template.xsl";
	</msg:script>
	<calli:expect>302-found</calli:expect>
	<calli:query>template</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/realm.ttl#AuthorizeLogin">
	<owl:intersectionOf rdf:nodeID="node16tas22o6x230"/>
	<msg:sparql>
		ASK {
			$this a &lt;Realm&gt;
			FILTER ($method = "GET" || $method = "HEAD")
			FILTER ($query = "login")
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/realm.ttl#GetLogin">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x233"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x234"/>
	<calli:type>text/html</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:max-age:3600</calli:header>
	<msg:script>
		var iter = this.calliAuthentication.iterator();
		while (iter.hasNext()) {
			var manager = iter.next();
			var credential = manager.findCredential(cookies);
			if (credential) {
				var title = manager.findCredentialLabel(cookies);
				return '&lt;html&gt;&lt;head&gt;&lt;title&gt;' + title + '&lt;/title&gt;'
					+ '&lt;meta http-equiv="REFRESH" content="0; url=' + credential + '"/&gt;&lt;/head&gt;'
					+ '&lt;body resource="' + credential + '"&gt;' + title  + '&lt;/body&gt;&lt;/html&gt;';
			}
		}
		return null;
	</msg:script>
	<calli:realm rdf:resource="/"/>
	<calli:query>login</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/realm.ttl#cookies">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<calli:header>Authorization</calli:header>
	<calli:header>Cookie</calli:header>
	<rdfs:domain rdf:resource="/callimachus/realm.ttl#GetLogin"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/realm.ttl#GetLogout">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x235"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x236"/>
	<calli:type>message/x-response</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		var ver = new ProtocolVersion("HTTP", 1, 1);
		if (!authorization || authorization.indexOf('username="logout"') &lt; 0) {
			var iter = this.calliAuthentication.iterator();
			while (iter.hasNext()) {
				var manager = iter.next();
				if (manager.calliAuthName) {
					//# the browser must send invalid credentials to logout
					var resp = new BasicHttpResponse(ver, 401, "Unauthorized");
					var hd = 'Digest realm="' + manager.calliAuthName + '", domain="'
						+ manager.protectionDomain() + '", nonce="logout", algorithm="MD5", qop="auth"';
					resp.setHeader('WWW-Authenticate', hd);
					return resp;
				}
			}
		}
		//# bogus credentials received or not needed
		var resp = new BasicHttpResponse(ver, 303, "See Other");
		if (logoutContinue) {
			resp.setHeader("Location", logoutContinue);
		} else {
			resp.setHeader("Location", "/");
		}
		var iter = this.calliAuthentication.iterator();
		while (iter.hasNext()) {
			var manager = iter.next();
			var headers = manager.logout().getAllHeaders();
			for (var i=0; i&lt;headers.length; i++) {
				resp.addHeadecr(headers[i]);
			}
		}
		return resp;
	</msg:script>
	<msg:imports rdf:resource="java:org.apache.http.ProtocolVersion"/>
	<msg:imports rdf:resource="java:org.apache.http.message.BasicHttpResponse"/>
	<calli:query>logout</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/realm.ttl#authorization">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<calli:header>Authorization</calli:header>
	<rdfs:domain rdf:resource="/callimachus/realm.ttl#GetLogout"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/realm.ttl#logoutContinue">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/realm.ttl#GetLogout"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
	<calli:query>continue</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/realm.ttl#GetSettings">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x237"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x238"/>
	<calli:type>text/uri-list</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		if (this.calliAuthentication.isEmpty())
			return null;
		return this.calliAuthentication.iterator().next() + "?settings";
	</msg:script>
	<calli:expect>302-found</calli:expect>
	<calli:query>settings</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/realm.ttl#GetContributions">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x239"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x240"/>
	<calli:type>text/uri-list</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		if (this.calliAuthentication.isEmpty())
			return null;
		return this.calliAuthentication.iterator().next() + "?contributions";
	</msg:script>
	<calli:expect>302-found</calli:expect>
	<calli:query>contributions</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/realm.ttl#GetForgotPasswordPage">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x241"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x242"/>
	<calli:type>text/uri-list</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		if (this.calliAuthentication.isEmpty())
			return null;
		return this.calliAuthentication.iterator().next() + "?forgotpassword";
	</msg:script>
	<calli:expect>302-found</calli:expect>
	<calli:query>forgotpassword</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/realm.ttl#GetLayout">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x243"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x244"/>
	<calli:type>text/xsl</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		var layout = layout_xhtml;
		try {
			if (this.calliTheme) {
				layout = this.calliTheme.calliLayout;
			}
		} catch (e) {
			if (e.javaException) e.javaException.printStackTrace();
			else println(e);
		}
		var sb = [];
		sb.push('&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;');
		sb.push('&lt;xsl:param name="systemId" /&gt;');
		sb.push('&lt;xsl:variable name="realm"&gt;' + this + '&lt;/xsl:variable&gt;');
		sb.push('&lt;xsl:variable name="styles"&gt;' + styles + '&lt;/xsl:variable&gt;');
		sb.push('&lt;xsl:variable name="scripts"&gt;' + scripts + '&lt;/xsl:variable&gt;');
		sb.push('&lt;xsl:variable name="layout"&gt;' + layout + '&lt;/xsl:variable&gt;');
		sb.push('&lt;xsl:variable name="favicon"&gt;' + (this.calliFavicon ? this.calliFavicon : '') + '&lt;/xsl:variable&gt;');
		sb.push('&lt;xsl:variable name="menu"&gt;' + (this.calliMenu ? (this.calliMenu + '?items') : '') + '&lt;/xsl:variable&gt;');
		sb.push('&lt;xsl:variable name="variation"&gt;' + (this.calliVariation ? this.calliVariation : '') + '&lt;/xsl:variable&gt;');
		sb.push('&lt;xsl:variable name="rights"&gt;');
		try {
			if (this.calliRights) {
				var xslt = new org.openrdf.repository.object.xslt.XSLTransformer();
				var p;
				var rights = this.calliRights;
				if (rights.childNodes.length == 1 &amp;&amp; rights.firstChild.tagName == "p") {
					var xml = xslt.transform(rights, this.toString()).asString();
					sb.push(xml.replace(/^.*?&lt;p[^&gt;]*&gt;/,'').replace(/&lt;.p&gt;.*?$/,''));
				} else {
					var doc = rights.ownerDocument;
					p = doc.createElement("p");
					p.appendChild(rights);
					var xml = xslt.transform(p, this.toString()).asString();
					sb.push(xml.replace(/^.*?&lt;p[^&gt;]*&gt;/,'').replace(/&lt;.p&gt;.*?$/,''));
				}
			}
		} catch (e) {
			if (e.javaException) e.javaException.printStackTrace();
			else println(e);
		}
		sb.push('&lt;/xsl:variable&gt;');
		sb.push('&lt;xsl:include href="' + layout_xsl + '" /&gt;');
		sb.push('&lt;/xsl:stylesheet&gt;');
		return sb.join('');
	</msg:script>
	<msg:imports rdf:resource="/callimachus/transforms/layout.xsl"/>
	<msg:imports rdf:resource="/callimachus/styles"/>
	<msg:imports rdf:resource="/callimachus/scripts"/>
	<msg:imports rdf:resource="/callimachus/theme/layout.xhtml"/>
	<calli:query>layout</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/realm.ttl#PostEditRealm">
	<msg:script>HTTPObjectServer.resetAllCache(); return proceed();</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x245"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x228">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/manifest"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x229">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x230">
	<rdf:first rdf:resource="http://callimachusproject.org/rdf/2009/framework#IsAuthorized"/>
	<rdf:rest rdf:nodeID="node16tas22o6x231"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x231">
	<rdf:first rdf:nodeID="node16tas22o6x232"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x232">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Realm"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x233">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Realm"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x234">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x235">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Realm"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x236">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:org.apache.http.HttpResponse"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x237">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Realm"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x238">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x239">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Realm"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x240">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x241">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Realm"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x242">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x243">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Realm"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x244">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x245">
	<rdf:first rdf:resource="/callimachus/toolbox/edit.ttl#PostEdit"/>
	<rdf:rest rdf:nodeID="node16tas22o6x246"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x246">
	<rdf:first rdf:nodeID="node16tas22o6x247"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x247">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Realm"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/schema.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Schema">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Schema</rdfs:label>
	<rdfs:comment>RELAX NG (REgular LAnguage for XML Next Generation) schema language</rdfs:comment>
	<rdfs:subClassOf rdf:resource="/callimachus/File"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/users"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/schema.png"/>
	<calli:view rdf:resource="/callimachus/schema-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/schema-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/schema-create.xhtml"/>
	<calli:type>application/relax-ng-compact-syntax</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/schema.ttl#GetPipelineSource">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x248"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x249"/>
	<calli:type>application/relax-ng-compact-syntax</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openInputStream()</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/schema.ttl#LookupPipelineFile">
	<msg:script>
		if (type == "application/relax-ng-compact-syntax") {
			var uri = this.toUri().resolve("/callimachus/Schema").toString();
			return this.objectConnection.getObject(uri);
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x250"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/schema.ttl#CreateSchema">
	<msg:script>
		var con = this.objectConnection;
		var vf = con.valueFactory;
		if (!location)
			throw new BadRequest("Missing location request header");
		if (location instanceof File) {
			location = location.RemoveFile();
		}
		var created = location;

		var filename = created.resource.localName.replace(/([a-zA-Z_0-9])\.[a-zA-Z]+$/, "$1");
		var label = vf.createLiteral(URLDecoder.decode(filename, "UTF-8").replace(/-/g, " "));
		con.add(created.resource, RDFS.LABEL, label, []);

		created = con.addDesignation(created, this.toString());
		created = con.addDesignation(created, Document);

		created.UploadSchema(body);
		return created;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x253"/>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Document"/>
	<msg:imports rdf:resource="/callimachus/File"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.InternalServerError"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/schema.ttl#UploadSchema">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x256"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x257"/>
	<calli:method>PUT</calli:method>
	<msg:script>
		var read;
		var buf = java.lang.reflect.Array.newInstance(java.lang.Byte.TYPE, 1024);
		var out = this.openOutputStream();
		try {
			while ((read = schemaStream.read(buf)) &gt;= 0) {
				out.write(buf, 0, read);
			}
		} finally {
			out.close();
		}
		this.touchRevision();
	</msg:script>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Document"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
	<msg:imports rdf:resource="java:org.callimachusproject.util.RelaxNGValidator"/>
	<msg:imports rdf:resource="/callimachus/schemas/xproc.rng"/>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/schema.ttl#schemaStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/relax-ng-compact-syntax</calli:type>
	<rdfs:domain rdf:resource="/callimachus/schema.ttl#UploadSchema"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x248">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Schema"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x249">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x250">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x251"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x251">
	<rdf:first rdf:nodeID="node16tas22o6x252"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x252">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x253">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x254"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x254">
	<rdf:first rdf:nodeID="node16tas22o6x255"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x255">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/Schema"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x256">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Schema"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x257">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/script.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Script">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Script</rdfs:label>
	<rdfs:comment>Script files</rdfs:comment>
	<rdfs:subClassOf rdf:resource="/callimachus/File"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/script.png"/>
	<calli:view rdf:resource="/callimachus/script-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/script-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/script-create.xhtml"/>
	<calli:type>text/javascript</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/script.ttl#GetJavaScript">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x258"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x259"/>
	<calli:type>text/javascript</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openReader(true)</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/script.ttl#LookupScriptFile">
	<msg:script>
		if (type == "text/javascript" || type == "application/javascript") {
			var uri = this.toUri().resolve("/callimachus/Script").toString();
			return this.objectConnection.getObject(uri);
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x260"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/script.ttl#CreateScript">
	<msg:script>
		var con = this.objectConnection;
		var vf = con.valueFactory;
		if (!location)
			throw new BadRequest("Missing location request header");
		if (location instanceof File) {
			location = location.RemoveFile();
		}
		var created = location;

		var filename = created.resource.localName.replace(/([a-zA-Z_0-9])\.[a-zA-Z]+$/, "$1");
		var label = vf.createLiteral(URLDecoder.decode(filename, "UTF-8").replace(/-/g, " "));
		con.add(created.resource, RDFS.LABEL, label, []);

		created = con.addDesignation(created, this.toString());
		created = con.addDesignation(created, Document);

		created.UploadScript(new java.io.InputStreamReader(body, "UTF-8"));
		return created;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x263"/>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Document"/>
	<msg:imports rdf:resource="/callimachus/File"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.InternalServerError"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/script.ttl#UploadScript">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x266"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x267"/>
	<calli:method>PUT</calli:method>
	<msg:script>
		if (!reader)
			throw new BadRequest("Missing PUT request payload");
		var read;
		var buf = java.lang.reflect.Array.newInstance(java.lang.Character.TYPE, 1024);
		var out = this.openWriter();
		try {
			while ((read = reader.read(buf)) &gt;= 0) {
				out.write(buf, 0, read);
			}
		} finally {
			out.close();
		}
		var con = this.objectConnection;
		var bundles = con.getStatements(null, null, this.resource, true, []);
		try {
			while (bundles.hasNext()) {
				var st = bundles.next();
				if (st.predicate.stringValue().indexOf("http://www.w3.org/1999/02/22-rdf-syntax-ns#_") == 0) {
					con.getObject(st.subject).touchRevision();
				}
			}
		} finally {
			bundles.close();
		}
		this.touchRevision();
	</msg:script>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
	<msg:imports rdf:resource="java:org.openrdf.query.QueryLanguage"/>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/script.ttl#reader">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>text/javascript</calli:type>
	<rdfs:domain rdf:resource="/callimachus/script.ttl#UploadScript"/>
	<rdfs:range rdf:resource="java:java.io.Reader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x258">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Script"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x259">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.Reader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x260">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x261"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x261">
	<rdf:first rdf:nodeID="node16tas22o6x262"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x262">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x263">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x264"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x264">
	<rdf:first rdf:nodeID="node16tas22o6x265"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x265">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/Script"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x266">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Script"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x267">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Serviceable">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Serviceable</rdfs:label>
	<rdfs:comment>All resources served by this host</rdfs:comment>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Composite">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Composite</rdfs:label>
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#Composite"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Serviceable"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/serviceable.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/SparqlService">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdf:type rdf:resource="/callimachus/Serviceable"/>
	<rdfs:subClassOf rdf:resource="http://www.w3.org/ns/sparql-service-description#Service"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Viewable"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:view rdf:resource="/callimachus/sparql-view.xhtml"/>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl#EvaluateSparql">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x268"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x269"/>
	<msg:script>
		if (!qry)
			throw new BadRequest("Missing query");
		try {
			var query = this.AddPrefix(qry);
			var con = this.objectConnection;
			var mime;
			var rs;
			var type;
			var base = this.resource.stringValue();
			var reg = QueryParserRegistry.getInstance();
			var parser = reg.get(QueryLanguage.SPARQL).getParser();
			var parsed = parser.parseQuery(query, base);
			if (parsed instanceof ParsedBooleanQuery) {
				mime = "application/sparql-results+xml";
				rs = con.prepareBooleanQuery(QueryLanguage.SPARQL, query, base).evaluate();
				type = java.lang.Boolean.TYPE;
			} else if (parsed instanceof ParsedGraphQuery) {
				mime = "application/rdf+xml";
				rs = con.prepareGraphQuery(QueryLanguage.SPARQL, query, base).evaluate();
				type = rs.getClass();
			} else if (parsed instanceof ParsedTupleQuery) {
				mime = "application/sparql-results+xml";
				rs = con.prepareTupleQuery(QueryLanguage.SPARQL, query, base).evaluate();
				type = rs.getClass();
			} else {
				throw new InternalServerError("Unknown query type: "
						+ parsed.getClass());
			}
			var http11 = new ProtocolVersion("HTTP", 1, 1);
			var resp = new BasicHttpResponse(http11, 200, "OK");
			var writer = AggregateWriter.getInstance();
			var body = writer.write(new MessageType(mime, type, type, con), rs, base, null);
			resp.setEntity(new ReadableHttpEntityChannel(mime, -1, body));
			return resp;
		} catch (e if e.javaException instanceof MalformedQueryException) {
			throw new BadRequest(e.javaException.toString());
		} catch (e if e.javaException instanceof java.lang.IllegalArgumentException) {
			throw new BadRequest("Missing accept header: " + e.javaException.getMessage());
		}
	</msg:script>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.InternalServerError"/>
	<msg:imports rdf:resource="java:org.apache.http.ProtocolVersion"/>
	<msg:imports rdf:resource="java:org.apache.http.message.BasicHttpResponse"/>
	<msg:imports rdf:resource="java:org.openrdf.query.GraphQueryResult"/>
	<msg:imports rdf:resource="java:org.openrdf.query.QueryLanguage"/>
	<msg:imports rdf:resource="java:org.openrdf.query.MalformedQueryException"/>
	<msg:imports rdf:resource="java:org.openrdf.query.TupleQueryResult"/>
	<msg:imports rdf:resource="java:org.openrdf.query.parser.QueryParserRegistry"/>
	<msg:imports rdf:resource="java:org.openrdf.query.parser.ParsedBooleanQuery"/>
	<msg:imports rdf:resource="java:org.openrdf.query.parser.ParsedGraphQuery"/>
	<msg:imports rdf:resource="java:org.openrdf.query.parser.ParsedTupleQuery"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.writers.AggregateWriter"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.util.MessageType"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.model.ReadableHttpEntityChannel"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl#qry">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/sparql.ttl#EvaluateSparql"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl#PostQuery">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x270"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x271"/>
	<msg:script>
		if (!query)
			throw new BadRequest("Missing query body");
		return this.EvaluateSparql(new java.lang.String(query, "UTF-8"));
	</msg:script>
	<msg:imports rdf:resource="java:org.openrdf.http.object.exceptions.BadRequest"/>
	<msg:method>POST</msg:method>
	<msg:type>message/x-response</msg:type>
	<msg:transform rdf:resource="/callimachus/sparql.ttl#TransformResult"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl#TransformResult">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x280"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x281"/>
	<calli:type>application/xml</calli:type>
	<msg:script>return msg &amp;&amp; msg.entity ? msg.entity.content : null</msg:script>
	<calli:transform rdf:resource="/callimachus/sparql.ttl#TransformXml"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl#query">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/sparql.ttl#PostQuery"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#hexBinary"/>
	<msg:type>application/sparql-query</msg:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl#PostUpdate">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x272"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x273"/>
	<msg:script>
		if (!update)
			throw new BadRequest("Missing update body");
		try {
			var query = this.AddPrefix(update);
			var con = this.objectConnection;
			var base = this.resource.stringValue();
			con.prepareUpdate(QueryLanguage.SPARQL, query, base).execute();
			return null;
		} catch (e if e.javaException instanceof MalformedQueryException) {
			throw new BadRequest(e.javaException.toString());
		}
	</msg:script>
	<msg:imports rdf:resource="java:org.openrdf.http.object.exceptions.BadRequest"/>
	<msg:method>POST</msg:method>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl#update">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/sparql.ttl#PostUpdate"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#hexBinary"/>
	<msg:type>application/sparql-update</msg:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl#PostForm">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x274"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x275"/>
	<calli:type>message/x-response</calli:type>
	<calli:method>POST</calli:method>
	<msg:script>
		if (map &amp;&amp; map.containsKey("query"))
			return this.EvaluateSparql(map.get("query")[0]);
		if (!map || !map.containsKey("update"))
			throw new org.callimachusproject.server.exceptions.BadRequest("Missing query");
		var qry = map.get("update")[0];
		try {
			var query = this.AddPrefix(qry);
			var con = this.objectConnection;
			var base = this.resource.stringValue();
			con.prepareUpdate(QueryLanguage.SPARQL, query, base).execute();
			return null;
		} catch (e if e.javaException instanceof MalformedQueryException) {
			throw new BadRequest(e.javaException.toString());
		}
	</msg:script>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.apache.http.ProtocolVersion"/>
	<msg:imports rdf:resource="java:org.apache.http.message.BasicHttpResponse"/>
	<msg:imports rdf:resource="java:org.openrdf.query.QueryLanguage"/>
	<msg:imports rdf:resource="java:org.apache.http.entity.StringEntity"/>
	<msg:imports rdf:resource="java:org.openrdf.query.MalformedQueryException"/>
	<calli:transform rdf:resource="/callimachus/sparql.ttl#TransformResult"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl#map">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/x-www-form-urlencoded</calli:type>
	<rdfs:domain rdf:resource="/callimachus/sparql.ttl#PostForm"/>
	<rdfs:range rdf:resource="java:java.util.Map"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl#GetQueryResult">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x276"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x277"/>
	<calli:type>message/x-response</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-validate</calli:header>
	<msg:script>
		if (queryStr)
			return this.EvaluateSparql(queryStr);
		var http11 = new ProtocolVersion("HTTP", 1, 1);
		var resp = new BasicHttpResponse(http11, 302, "see-other");
		resp.setHeader("Location", this.toString() + "?view");
		resp.setEntity(new StringEntity(""));
		return resp;
	</msg:script>
	<msg:imports rdf:resource="java:org.apache.http.ProtocolVersion"/>
	<msg:imports rdf:resource="java:org.apache.http.message.BasicHttpResponse"/>
	<msg:imports rdf:resource="java:org.apache.http.entity.StringEntity"/>
	<calli:query>query</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl#queryStr">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/sparql.ttl#GetQueryResult"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
	<calli:query>query</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl#AddPrefix">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x278"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x279"/>
	<msg:script>
		if (inputString.search(/^[^#]*\bPREFIX\b/im) &gt;= 0)
			return inputString;
		var sb = new java.lang.StringBuilder();
		var con = this.objectConnection;
		var namespaces = con.namespaces.asList();
		for (var i = 0; i &lt; namespaces.size(); i++) {
			var prefix = namespaces.get(i).prefix;
			var uri = namespaces.get(i).name;
			if (inputString.indexOf(prefix) &gt;= 0) {
				sb.append("PREFIX ").append(prefix);
				sb.append(":&lt;").append(uri).append("&gt;\n");
			}
		}
		return sb.append(inputString).toString();
	</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl#inputString">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/sparql.ttl#AddPrefix"/>
	<rdfs:rang rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl#TransformXml">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x282"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x283"/>
	<calli:type>application/xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/transforms/sparql.xsl"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformLayout"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl#msg">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>message/x-response</calli:type>
	<rdfs:domain rdf:resource="/callimachus/sparql.ttl#TransformResult"/>
	<rdfs:range rdf:resource="java:org.apache.http.HttpResponse"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/sparql.ttl#inputStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/sparql.ttl#TransformXml"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x268">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/SparqlService"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x269">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:org.apache.http.HttpResponse"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x270">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/SparqlEndPoint"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x271">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:org.apache.http.HttpResponse"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x272">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/SparqlEndPoint"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x273">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x274">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/SparqlService"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x275">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:org.apache.http.HttpResponse"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x276">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/SparqlService"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x277">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:org.apache.http.HttpResponse"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x278">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/SparqlService"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x279">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x280">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/SparqlService"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x281">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x282">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/SparqlService"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x283">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/style.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Style">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Style</rdfs:label>
	<rdfs:comment>Style files</rdfs:comment>
	<rdfs:subClassOf rdf:resource="/callimachus/File"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/style.png"/>
	<calli:view rdf:resource="/callimachus/style-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/style-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/style-create.xhtml"/>
	<calli:type>text/css</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/style.ttl#GetStyleSheet">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x284"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x285"/>
	<calli:type>text/css</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openReader(true)</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/style.ttl#LookupStyleFile">
	<msg:script>
		if (type == "text/css") {
			var uri = this.toUri().resolve("/callimachus/Style").toString();
			return this.objectConnection.getObject(uri);
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x286"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/style.ttl#CreateStyle">
	<msg:script>
		var con = this.objectConnection;
		var vf = con.valueFactory;
		if (!location)
			throw new BadRequest("Missing location request header");
		if (location instanceof File) {
			location = location.RemoveFile();
		}
		var created = location;

		var filename = created.resource.localName.replace(/([a-zA-Z_0-9])\.[a-zA-Z]+$/, "$1");
		var label = vf.createLiteral(URLDecoder.decode(filename, "UTF-8").replace(/-/g, " "));
		con.add(created.resource, RDFS.LABEL, label, []);

		created = con.addDesignation(created, this.toString());
		created = con.addDesignation(created, Document);

		created.UploadStyle(new java.io.InputStreamReader(body, "UTF-8"));
		return created;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x289"/>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Document"/>
	<msg:imports rdf:resource="/callimachus/File"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.InternalServerError"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/style.ttl#UploadStyle">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x292"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x293"/>
	<calli:method>PUT</calli:method>
	<msg:script>
		if (!reader)
			throw new BadRequest("Missing PUT request payload");
		var read;
		var buf = java.lang.reflect.Array.newInstance(java.lang.Character.TYPE, 1024);
		var out = this.openWriter();
		try {
			while ((read = reader.read(buf)) &gt;= 0) {
				out.write(buf, 0, read);
			}
		} finally {
			out.close();
		}
		this.touchRevision();
	</msg:script>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
	<msg:imports rdf:resource="java:org.openrdf.query.QueryLanguage"/>
	<msg:imports rdf:resource="/callimachus/Style"/>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/style.ttl#reader">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>text/css</calli:type>
	<rdfs:domain rdf:resource="/callimachus/style.ttl#UploadStyle"/>
	<rdfs:range rdf:resource="java:java.io.Reader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x284">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Style"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x285">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.Reader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x286">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x287"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x287">
	<rdf:first rdf:nodeID="node16tas22o6x288"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x288">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x289">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x290"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x290">
	<rdf:first rdf:nodeID="node16tas22o6x291"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x291">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/Style"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x292">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Style"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x293">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/text.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/TextFile">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Text File</rdfs:label>
	<rdfs:comment>Text files</rdfs:comment>
	<rdfs:subClassOf rdf:resource="/callimachus/File"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/text.png"/>
	<calli:view rdf:resource="/callimachus/text-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/text-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/text-create.xhtml"/>
	<calli:type>text/plain</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/text.ttl#GetTextFile">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x294"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x295"/>
	<calli:type>text/plain</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openReader(true)</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/text.ttl#LookupTextFile">
	<msg:script>
		if (type == "text/plain") {
			var uri = this.toUri().resolve("/callimachus/TextFile").toString();
			return this.objectConnection.getObject(uri);
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x296"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/text.ttl#CreateTextFile">
	<msg:script>
		var con = this.objectConnection;
		var vf = con.valueFactory;
		if (!location)
			throw new BadRequest("Missing location request header");
		if (location instanceof File) {
			location = location.RemoveFile();
		}
		var created = location;

		var filename = created.resource.localName.replace(/([a-zA-Z_0-9])\.[a-zA-Z]+$/, "$1");
		var label = vf.createLiteral(URLDecoder.decode(filename, "UTF-8").replace(/-/g, " "));
		con.add(created.resource, RDFS.LABEL, label, []);

		created = con.addDesignation(created, this.toString());
		created = con.addDesignation(created, Document);

		created.UploadTextFile(new java.io.InputStreamReader(body, "UTF-8"));
		return created;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x299"/>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Document"/>
	<msg:imports rdf:resource="/callimachus/File"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.InternalServerError"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/text.ttl#UploadTextFile">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x302"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x303"/>
	<calli:method>PUT</calli:method>
	<msg:script>
		if (!reader)
			throw new BadRequest("Missing PUT request payload");
		var read;
		var buf = java.lang.reflect.Array.newInstance(java.lang.Character.TYPE, 1024);
		var out = this.openWriter();
		try {
			while ((read = reader.read(buf)) &gt;= 0) {
				out.write(buf, 0, read);
			}
		} finally {
			out.close();
		}
		this.touchRevision();
	</msg:script>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
	<msg:imports rdf:resource="java:org.openrdf.query.QueryLanguage"/>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/text.ttl#reader">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>text/plain</calli:type>
	<rdfs:domain rdf:resource="/callimachus/text.ttl#UploadTextFile"/>
	<rdfs:range rdf:resource="java:java.io.Reader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x294">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/TextFile"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x295">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.Reader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x296">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x297"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x297">
	<rdf:first rdf:nodeID="node16tas22o6x298"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x298">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x299">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x300"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x300">
	<rdf:first rdf:nodeID="node16tas22o6x301"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x301">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/TextFile"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x302">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/TextFile"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x303">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/theme.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Theme">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#Theme"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Viewable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Editable"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/theme.png"/>
	<calli:view rdf:resource="/callimachus/theme-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/theme-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/theme-create.xhtml"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/changes.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/changes.ttl#GetFolderChanges">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x304"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x305"/>
	<calli:type>application/sparql-results+xml;q=0.1</calli:type>
	<calli:method>GET</calli:method>
	<calli:query>changes</calli:query>
	<calli:rel>alternate</calli:rel>
	<calli:transform rdf:resource="/callimachus/transforms/TransformIntoAtom"/>
	<calli:transform rdf:resource="/callimachus/toolbox/changes.ttl#TransformRecentChanges"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;
		PREFIX skosxl:&lt;http://www.w3.org/2008/05/skos-xl#&gt;
		PREFIX dc:&lt;http://purl.org/dc/elements/1.1/&gt;
		PREFIX dcterms:&lt;http://purl.org/dc/terms/&gt;
		PREFIX foaf:&lt;http://xmlns.com/foaf/0.1/&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT * {
			{
				$this rdfs:label ?title
				BIND (concat(str($this),"?changes") as ?id)
				BIND ("feed" as ?type)
			} UNION {
				$this audit:revision [audit:committedOn ?updated]
				BIND (concat(str($this),"?changes") as ?id)
				BIND ("feed" as ?type)
			} UNION {
				{
					SELECT ?id (max(?title)  as ?title) (max(?updated) as ?updated) (max(?summary) as ?summary) (max(?icon) as ?icon)
							(?id as ?content_src) (max(?content_type) as ?content_type) ("entry" as ?type)
							(?id as ?link_edit_media_href) (concat(str(?id),"?view") as ?link_view_href) (concat(str(?id),"?history") as ?link_history_href)
							(concat(str(?revision),"?view") as ?link_href) (audit:revision as ?link_rel) ("text/html" as ?link_type)
							(max(?contributor_uri) as ?contributor_uri) (max(?contributor_name) as ?contributor_name)  {
						?revision a audit:RecentTransaction; audit:committedOn ?updated .
						?id audit:revision ?revision .
						FILTER strstarts(str(?id), str($this))
						OPTIONAL {
							?revision audit:contributor ?contributor_uri
							OPTIONAL {
								?contributor_uri rdfs:label ?contributor_name
							}
						} OPTIONAL {
							?id skos:prefLabel ?title
						} OPTIONAL {
							?id foaf:name ?title
						} OPTIONAL {
							?id rdfs:label ?title
						} OPTIONAL {
							?id skosxl:literalForm ?title
						} OPTIONAL {
							?id dcterms:title ?title
						} OPTIONAL {
							GRAPH ?revision { ?id skos:changeNote ?summary }
						} OPTIONAL {
							?id a [calli:icon ?icon]
						} OPTIONAL {
							?id a [calli:type ?content_type]
						}
					} GROUP BY ?id ?revision ORDER BY desc(?updated) LIMIT 100
				}
				FILTER bound(?id)
			}
		} ORDER BY desc(?type) desc(?updated) ?id
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/changes.ttl#TransformRecentChanges">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x306"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x307"/>
	<calli:type>application/xhtml+xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/toolbox/changes.xsl"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformLayout"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/changes.ttl#inputStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/sparql-results+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/toolbox/changes.ttl#TransformRecentChanges"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x304">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Folder"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x305">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x306">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Folder"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x307">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/contributions.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/contributions.ttl#GetContributions">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x308"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x309"/>
	<calli:type>application/sparql-results+xml;q=0.1</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-store</calli:header>
	<calli:query>contributions</calli:query>
	<calli:transform rdf:resource="/callimachus/transforms/TransformIntoAtom"/>
	<calli:transform rdf:resource="/callimachus/toolbox/contributions.ttl#TransformContributions"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;
		PREFIX skosxl:&lt;http://www.w3.org/2008/05/skos-xl#&gt;
		PREFIX dc:&lt;http://purl.org/dc/elements/1.1/&gt;
		PREFIX dcterms:&lt;http://purl.org/dc/terms/&gt;
		PREFIX foaf:&lt;http://xmlns.com/foaf/0.1/&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT * {
			{
				$this rdfs:label ?title
				BIND (concat(str($this),"?contributions") as ?id)
				BIND ("feed" as ?type)
			} UNION {
				$this audit:revision [audit:committedOn ?updated]
				BIND (concat(str($this),"?contributions") as ?id)
				BIND ("feed" as ?type)
			} UNION {
				$this rdfs:label ?contributor_name
				BIND ($this as ?contributor_uri)
				BIND ("feed" as ?type)
			} UNION {
				{
					SELECT ?id (max(?title)  as ?title) (max(?updated) as ?updated) (max(?summary) as ?summary) (max(?icon) as ?icon)
							(?id as ?content_src) (max(?content_type) as ?content_type) ("entry" as ?type)
							(?id as ?link_edit_media_href) (concat(str(?id),"?view") as ?link_view_href) (concat(str(?id),"?history") as ?link_history_href)
							(concat(str(?revision),"?view") as ?link_href) (audit:revision as ?link_rel) ("text/html" as ?link_type) {
						?revision audit:contributor $this; audit:committedOn ?updated .
						?id audit:revision ?revision .
						OPTIONAL {
							?id skos:prefLabel ?title
						} OPTIONAL {
							?id foaf:name ?title
						} OPTIONAL {
							?id rdfs:label ?title
						} OPTIONAL {
							?id skosxl:literalForm ?title
						} OPTIONAL {
							?id dcterms:title ?title
						} OPTIONAL {
							?id rdfs:comment ?summary
						} OPTIONAL {
							?id a [calli:icon ?icon]
						} OPTIONAL {
							?id a [calli:type ?content_type]
						}
					} GROUP BY ?id ?revision ORDER BY desc(?updated) LIMIT 50
				}
				FILTER bound(?id)
			}
		} ORDER BY desc(?type) desc(?updated) ?id
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/contributions.ttl#TransformContributions">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x310"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x311"/>
	<calli:type>application/xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/toolbox/contributions.xsl"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformLayout"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/contributions.ttl#inputStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/sparql-results+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/toolbox/contributions.ttl#TransformContributions"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x308">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/User"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x309">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x310">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/User"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x311">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Creatable">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Creatable</rdfs:label>
	<rdfs:subClassOf rdf:resource="/callimachus/Serviceable"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl#LookupConstructor">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x318"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x319"/>
	<msg:script>return this</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl#PostCreate">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x320"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x321"/>
	<msg:script>
		var template = this.calliCreate.iterator().next();
		if (!template)
			throw new InternalServerError("Cannot create " + this.toString() + " with " + type);
		if (type != "application/rdf+xml" &amp;&amp; type.indexOf("application/rdf+xml;") != 0)
			throw new UnsupportedMediaType("File format is not recognized: " + type + " for " + location);
		var newCopy = template.calliCreateResource(body, this.toString(), location);
		newCopy = newCopy.objectConnection.addDesignation(newCopy, this.toString());
		return newCopy;
	</msg:script>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.InternalServerError"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.UnsupportedMediaType"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl#GetCreatePage">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x312"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x313"/>
	<calli:type>application/xhtml+xml</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		importClass(Packages.org.callimachusproject.server.exceptions.InternalServerError);
		if (!this.calliCreate || this.calliCreate.isEmpty())
			throw new InternalServerError("No create template");
		if (this.calliCreate.size() != 1)
			throw new InternalServerError("Multiple create templates");
		return this.calliCreate.iterator().next().calliConstruct(null);
	</msg:script>
	<calli:realm rdf:resource="/"/>
	<calli:query>create</calli:query>
	<calli:transform rdf:resource="/callimachus/transforms/TransformPage"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl#GetCreatorPage">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x314"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x315"/>
	<calli:type>application/xhtml+xml</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		importClass(Packages.org.callimachusproject.server.exceptions.InternalServerError);
		importClass(Packages.org.callimachusproject.server.exceptions.BadRequest);
		if (!(create instanceof Creatable))
			throw new BadRequest("Cannot create this class here: " + create);
		if (!create.calliCreate || create.calliCreate.isEmpty())
			throw new InternalServerError("No create template");
		if (create.calliCreate.size() != 1)
			throw new InternalServerError("Multiple create templates");
		return create.calliCreate.iterator().next().calliConstruct(null);
	</msg:script>
	<msg:imports rdf:resource="/callimachus/Creatable"/>
	<calli:realm rdf:resource="/"/>
	<calli:query>create</calli:query>
	<calli:transform rdf:resource="/callimachus/transforms/TransformPage"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl#PostFactoryCreate">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x316"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x317"/>
	<calli:type>text/plain</calli:type>
	<calli:method>POST</calli:method>
	<msg:script>
		importClass(Packages.org.callimachusproject.io.MultipartParser);
		importClass(Packages.org.callimachusproject.server.exceptions.BadRequest);
		importClass(Packages.org.callimachusproject.server.exceptions.Forbidden);
		if (!location)
			throw new BadRequest("No location provided");
		if (!(create instanceof Creatable))
			throw new BadRequest("Cannot create: " + create);
		var creatorUri = this.toString();
		var createdUri = location.toString();
		var dest = createdUri.substring(0, createdUri.lastIndexOf('/', createdUri.length - 2) + 1);
		if (creatorUri != dest &amp;&amp; creatorUri != dest.substring(0, dest.length - 1))
			throw new BadRequest("Location URI must be nested");
		if (createdUri.search(/[\s\#\?]/) &gt;= 0 || createdUri.search(/^\w+:\/\/\S+/) != 0)
			throw new BadRequest("Fragement or name resources are not supported");
		var ftype = type;
		var bio = new org.callimachusproject.io.LatencyInputStream(body);
		if (type &amp;&amp; type.indexOf("multipart/form-data") == 0) {
			bio.mark(1024);
			var parser = new MultipartParser(bio);
			var file = parser.next();
			var headers = parser.getHeaders();
			var disposition = headers.get("content-disposition");
			if (disposition &amp;&amp; disposition.indexOf("filename=") &gt;= 0) {
				ftype = headers.get("content-type");
				var xml = ftype == "text/xml" || ftype == "application/xml";
				if (xml || ftype == "application/octet-stream" || ftype.indexOf("application/x-") == 0) {
					var fileName = disposition.replace(/.*filename="/g, '').replace(/".*/g, '');
					var mimetypes = new javax.activation.MimetypesFileTypeMap();
					var mtype = mimetypes.getContentType(fileName);
					if (!"application/octet-stream".equals(mtype)) {
						ftype = mtype;
					}
				}
				bio = file;
			} else { // not a file upload
				bio.reset();
			}
		} else if (!ftype) {
			var mimetypes = new javax.activation.MimetypesFileTypeMap();
			ftype = mimetypes.getContentType(location.toString());
		}
		var construct = create.LookupConstructor(ftype);
		var iter = this.FindCreator(location).iterator();
		while (iter.hasNext()) {
			var user = iter.next();
			if (!construct.calliIsAuthorized(user, "POST", "create"))
				throw new Forbidden("You are not permitted to create " + construct + " resources");
		}
		var newCopy = construct.PostCreate(bio, location, ftype);
		newCopy.calliEditor.addAll(this.FindContributor(newCopy));
		newCopy.calliReader.addAll(this.SelectAllReaders());
		newCopy.calliEditor.addAll(this.SelectAllEditors());
		newCopy.calliAdministrator.addAll(this.SelectAllAdministrators());
		if (intermediate) {
			var revision = this.auditRevision;
			this.calliHasComponent.add(newCopy);
			this.auditRevision = revision; // restore the previous revision
		} else {
			this.calliHasComponent.add(newCopy);
		}
		return newCopy;
	</msg:script>
	<msg:imports rdf:resource="/callimachus/Creatable"/>
	<calli:realm rdf:resource="/"/>
	<calli:expect>201-created</calli:expect>
	<calli:query>create</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl#body">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>*/*</calli:type>
	<rdfs:domain rdf:nodeID="node16tas22o6x322"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl#create">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:domain rdf:nodeID="node16tas22o6x325"/>
	<rdfs:range rdf:resource="/callimachus/Creatable"/>
	<calli:query>create</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl#intermediate">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/toolbox/create.ttl#PostFactoryCreate"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#boolean"/>
	<calli:query>intermediate</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl#location">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:domain rdf:nodeID="node16tas22o6x328"/>
	<calli:query>location</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl#type">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:header>Content-Type</calli:header>
	<rdfs:domain rdf:nodeID="node16tas22o6x331"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl#FindCreator">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x335"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT DISTINCT ?contributor
		WHERE {
			audit:current-trx audit:contributor ?contributor
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl#thing">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:domain rdf:resource="/callimachus/toolbox/create.ttl#FindCreator"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl#FindContributor">
	<rdfs:subClassOf rdf:resource="/callimachus/toolbox/create.ttl#FindCreator"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT DISTINCT ?contributor
		WHERE {
			{
				audit:current-trx audit:contributor ?contributor
			} UNION {
				GRAPH ?graph { $thing a ?type }
				?graph audit:contributor ?contributor
			} OPTIONAL {
				{
					$this ?editor ?contributor
				} UNION {
					$this ?editor [calli:member ?contributor]
				} UNION {
					$this rdf:type/rdfs:subClassOf* [?editor ?contributor]
				} UNION {
					$this rdf:type/rdfs:subClassOf* [?editor [calli:member ?contributor]]
				}
				FILTER (?editor = calli:editor || ?editor = calli:administrator)
			}
			FILTER (!bound(?editor))
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl#SelectAllReaders">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x336"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x337"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT DISTINCT ?reader
		WHERE {
			{
				$this calli:reader ?reader
			} UNION {
				$this rdf:type/rdfs:subClassOf*/calli:reader ?reader
			}
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl#SelectAllEditors">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x338"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x339"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT DISTINCT ?editor
		WHERE {
			{
				$this calli:editor ?editor
			} UNION {
				$this rdf:type/rdfs:subClassOf*/calli:editor ?editor
			}
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/create.ttl#SelectAllAdministrators">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x340"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x341"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT DISTINCT ?admin
		WHERE {
			{
				$this calli:administrator ?admin
			} UNION {
				$this rdf:type/rdfs:subClassOf*/calli:administrator ?admin
			}
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x312">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Creatable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x313">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:javax.xml.stream.XMLEventReader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x314">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Composite"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x315">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:javax.xml.stream.XMLEventReader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x316">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Composite"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x317">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x318">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Creatable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x319">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Creatable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x320">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Creatable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x321">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x323">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x324"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x324">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostFactoryCreate"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x322">
	<owl:unionOf rdf:nodeID="node16tas22o6x323"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x326">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#GetCreatorPage"/>
	<rdf:rest rdf:nodeID="node16tas22o6x327"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x327">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostFactoryCreate"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x325">
	<owl:unionOf rdf:nodeID="node16tas22o6x326"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x329">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x330"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x330">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostFactoryCreate"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x328">
	<owl:unionOf rdf:nodeID="node16tas22o6x329"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x332">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x333"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x333">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x334"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x334">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostFactoryCreate"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x331">
	<owl:unionOf rdf:nodeID="node16tas22o6x332"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x335">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Composite"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x336">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Composite"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x337">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#objectSet"/>
	<owl:allValuesFrom rdf:resource="http://callimachusproject.org/rdf/2009/framework#Party"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x338">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Composite"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x339">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#objectSet"/>
	<owl:allValuesFrom rdf:resource="http://callimachusproject.org/rdf/2009/framework#Party"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x340">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Composite"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x341">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#objectSet"/>
	<owl:allValuesFrom rdf:resource="http://callimachusproject.org/rdf/2009/framework#Party"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/delete.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/delete.ttl#Delete">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x342"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x343"/>
	<calli:method>DELETE</calli:method>
	<msg:script>
		var con = this.objectConnection;
		var stmts = con.getStatements(null, null, this.resource, []);
		try {
			while (stmts.hasNext()) {
				var st = stmts.next();
				var subj = st.subject;
				var pred = st.predicate.stringValue();
				if (pred != "http://www.w3.org/1999/02/22-rdf-syntax-ns#subject"
						&amp;&amp; pred != "http://www.w3.org/1999/02/22-rdf-syntax-ns#object") {
					//# Don't allow removal if used in a complex structure (like an rdf:List)
					if (subj instanceof BNode)
						throw new Conflict("This resource is currently is use and cannot be removed");
					if (subj.stringValue().indexOf('#') &gt;= 0)
						throw new Conflict("This resource is currently referenced: " + subj);
					con.remove(st, []);
				}
			}
		} finally {
			stmts.close();
		}

		function removeTriples(subject, hash) {
			var stmts = con.getStatements(subject, null, null, []);
			try {
				while (stmts.hasNext()) {
					var st = stmts.next();
					if (st.object instanceof BNode &amp;&amp; !st.object.equals(subject)) {
						removeTriples(st.object, hash);
					} else if (st.object instanceof URI &amp;&amp; !st.object.equals(subject)) {
						if (st.object.stringValue().indexOf(hash) == 0) {
							removeTriples(st.object, hash);
						} else {
							con.getObjectFactory().createObject(st.object).touchRevision();
						}
					}
					con.remove(st, []);
				}
			} finally {
				stmts.close();
			}
		}

		con.clear([this.resource]); //# clear graph
		removeTriples(this.resource, this.resource.stringValue() + '#'); //# follow blank and hash references
		if (this instanceof FileObject) {
			this['delete'](); //# remove document
		}
	</msg:script>
	<msg:imports rdf:resource="java:org.openrdf.model.BNode"/>
	<msg:imports rdf:resource="java:org.openrdf.model.URI"/>
	<msg:imports rdf:resource="java:javax.tools.FileObject"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.Conflict"/>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/delete.ttl#DeleteComposite">
	<msg:script>
		if (this.HasComponents())
			throw new Conflict("Child resources must be deleted first");
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x344"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.Conflict"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/delete.ttl#HasComponents">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x350"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x351"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x352"/>
	<msg:sparql>
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		ASK {
			$this calli:hasComponent ?child
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/delete.ttl#DeleteCreatable">
	<msg:script>
		if (this.HasInstanceChildren())
			throw new Conflict("Member resources must be deleted first");
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x353"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.Conflict"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/delete.ttl#HasInstanceChildren">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x359"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x360"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x361"/>
	<msg:sparql>
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		ASK {
			?child a $this
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x342">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Editable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x343">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x344">
	<rdf:first rdf:resource="/callimachus/toolbox/delete.ttl#Delete"/>
	<rdf:rest rdf:nodeID="node16tas22o6x345"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x345">
	<rdf:first rdf:nodeID="node16tas22o6x346"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x346">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:nodeID="node16tas22o6x347"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x348">
	<rdf:first rdf:resource="/callimachus/Editable"/>
	<rdf:rest rdf:nodeID="node16tas22o6x349"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x349">
	<rdf:first rdf:resource="/callimachus/Composite"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x347">
	<owl:intersectionOf rdf:nodeID="node16tas22o6x348"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x350">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Composite"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x351">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2001/XMLSchema#boolean"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x352">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:cardinality rdf:datatype="http://www.w3.org/2001/XMLSchema#integer">1</owl:cardinality>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x353">
	<rdf:first rdf:resource="/callimachus/toolbox/delete.ttl#Delete"/>
	<rdf:rest rdf:nodeID="node16tas22o6x354"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x354">
	<rdf:first rdf:nodeID="node16tas22o6x355"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x355">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:nodeID="node16tas22o6x356"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x357">
	<rdf:first rdf:resource="/callimachus/Editable"/>
	<rdf:rest rdf:nodeID="node16tas22o6x358"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x358">
	<rdf:first rdf:resource="/callimachus/Creatable"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x356">
	<owl:intersectionOf rdf:nodeID="node16tas22o6x357"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x359">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Creatable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x360">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2001/XMLSchema#boolean"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x361">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:cardinality rdf:datatype="http://www.w3.org/2001/XMLSchema#integer">1</owl:cardinality>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/describe.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/describe.ttl#GetDescription">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x362"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x363"/>
	<calli:type>application/rdf+xml;q=0.4</calli:type>
	<calli:type>text/turtle;q=0.5</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		var queue = [];
		queue.push(this.resource);
		var con = this.objectConnection;
		var base = this.resource.stringValue();
		var baseIsHash = base.charAt(base.length - 1) == '#';
		var stmts = con.getStatements(null, org.openrdf.model.vocabulary.RDFS.ISDEFINEDBY, this.resource, false, []);
		try {
			while (stmts.hasNext()) {
				queue.push(stmts.next().subject);
			}
		} finally {
			stmts.close();
		}
		return new org.openrdf.query.GraphQueryResult({
			close: function() {
				stmts.close();
			},
			getNamespaces: function() {
				var namespaces = con.getNamespaces();
				var map = new java.util.HashMap();
				while (namespaces.hasNext()) {
					var ns = namespaces.next();
					map.put(ns.getPrefix(), ns.getName());
				}
				return map;
			},
			hasNext: function() {
				while (!stmts.hasNext() &amp;&amp; queue.length &gt; 0) {
					stmts.close();
					stmts = con.getStatements(queue.shift(), null, null, false, []);
				}
				return stmts.hasNext();
			},
			next: function() {
				while (!stmts.hasNext() &amp;&amp; queue.length &gt; 0) {
					stmts.close();
					stmts = con.getStatements(queue.shift(), null, null, false, []);
				}
				var st = stmts.next();
				var uri = st.object.stringValue()
				if (st.object instanceof org.openrdf.model.URI) {
					if (uri.length &gt; base.length &amp;&amp; uri.indexOf(base) == 0) {
						var chr = uri.charAt(base.length);
						if (baseIsHash || chr == '#') {
							queue.push(st.object);
						}
					}
				} else if (st.object instanceof org.openrdf.model.Resource) {
					queue.push(st.object);
				}
				return st;
			},
			remove: function() {
				stmts.remove();
			},
		});
	</msg:script>
	<calli:query>describe</calli:query>
	<calli:rel>describedby</calli:rel>
	<calli:title>RDF Describe</calli:title>
	<calli:transform rdf:resource="/callimachus/toolbox/describe.ttl#TransformDescription"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/describe.ttl#TransformDescription">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x364"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x365"/>
	<calli:type>application/xhtml+xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/toolbox/describe.xsl"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformLayout"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/describe.ttl#inputStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/rdf+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/toolbox/describe.ttl#TransformDescription"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/describe.ttl#PostInsertData">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x366"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x367"/>
	<calli:type>text/plain</calli:type>
	<calli:method>POST</calli:method>
	<msg:script>
		var con = this.objectConnection;
		var vf = con.valueFactory;
		var of = con.objectFactory;

		//# Parse INSERT DATA
		var analyzer = new TripleAnalyzer();
		var string = analyzer.parseInsertData(insertData, this.toString());
		
		//# Verify input
		if (analyzer.isEmpty())
			throw new BadRequest("Missing data");
		if (!analyzer.isSingleton())
			throw new BadRequest("Only one entity can be inserted per request");
		if (analyzer.isDisconnectedNodePresent())
			throw new BadRequest("Blank nodes must be connected");
		var location = analyzer.subject;
		if (location.toString().indexOf(this.toString()) != 0)
			throw new BadRequest("Resource URI must start with: " + this);
		var local = location.toString().substring(this.toString().length);
		if (local.indexOf('/') == 0 &amp;&amp; this.toString().lastIndexOf('/') != this.toString().length - 1) {
			local = local.substring(1);
		}
		if (local.lastIndexOf('/') == local.length - 1) {
			local = local.substring(0, local.length -1);
		}
		if (local.indexOf('/') &gt;= 0)
			throw new BadRequest("Can only created nested components here");
		var newCopy = of.createObject(location, analyzer.getTypes(location));
		if (this.calliHasComponent.contains(newCopy))
			throw new Conflict("Resource already exists");
		if (!(newCopy instanceof Editable))
			throw new BadRequest("Resource is not Editable");
		var iter = this.FindCreator(newCopy).iterator();
		while (iter.hasNext()) {
			var user = iter.next();
			function findConcepts(klass, visited, callback) {
				if (visited.contains(klass))
					return true;
				visited.add(klass);
				if (klass.isAnnotationPresent(Iri)) {
					callback(klass.getAnnotation(Iri).value());
				}
				var sup = klass.getSuperclass();
				if (sup) {
					findConcepts(sup, visited, callback);
				}
				var interfaces = klass.getInterfaces();
				for (var i = 0; i &lt; interfaces.length; i++) {
					findConcepts(interfaces[i], visited, callback);
				}
				return false;
			}
			findConcepts(newCopy.getClass(), new java.util.HashSet(), function(type) {
				var cls = con.getObject(type);
				if (cls instanceof Serviceable &amp;&amp; !cls.calliIsAuthorized(user, "POST", "create"))
					throw new Forbidden("You are not permitted to create " + cls + " resources");
			});
		}

		//# Execute input
		var update = con.prepareUpdate(QueryLanguage.SPARQL, string, this.toString());
		update.setBinding("this", this.resource);
		update.execute();

		//# Add permissions and component membership
		newCopy.calliEditor.addAll(this.FindContributor(newCopy));
		newCopy.calliReader.addAll(this.SelectAllReaders());
		newCopy.calliEditor.addAll(this.SelectAllEditors());
		newCopy.calliAdministrator.addAll(this.SelectAllAdministrators());
		this.calliHasComponent.add(newCopy);
		var iter = analyzer.getResources().iterator();
		while (iter.hasNext()) {
			var partner = iter.next();
			if (!partner.toString().equals(this.toString())) {
				con.getObject(partner).touchRevision(); // FIXME this shouldn't be needed
			}
		}
		return newCopy;
	</msg:script>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="/callimachus/Serviceable"/>
	<msg:imports rdf:resource="/callimachus/Editable"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.Conflict"/>
	<msg:imports rdf:resource="java:org.openrdf.query.QueryLanguage"/>
	<msg:imports rdf:resource="java:org.openrdf.annotations.Iri"/>
	<msg:imports rdf:resource="java:org.callimachusproject.form.helpers.TripleAnalyzer"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.Forbidden"/>
	<calli:realm rdf:resource="/"/>
	<calli:expect>201-created</calli:expect>
	<calli:query>describe</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/describe.ttl#insertData">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/sparql-update</calli:type>
	<rdfs:domain rdf:resource="/callimachus/toolbox/describe.ttl#PostInsertData"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/describe.ttl#PatchDeleteInsert">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x368"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x369"/>
	<calli:method>PATCH</calli:method>
	<msg:script>
		var con = this.objectConnection;

		//# Parse DELETE INSERT
		var analyzer = new TripleAnalyzer();
		var string = analyzer.parseUpdate(deleteInsert, this.toString());
		
		//# Verify input
		if (analyzer.isEmpty())
			throw new BadRequest("Missing data");
		if (!analyzer.isAbout(this.resource))
			throw new BadRequest("Can only delete or insert triples of the entity: " + this.toString());
		if (!analyzer.getTypes(this.resource).isEmpty())
			throw new BadRequest("Cannot change entity type");
		if (analyzer.isDisconnectedNodePresent())
			throw new BadRequest("Blank nodes must be connected");
		//# FIXME possible security hole if hash or blank resources are added with a restricted type

		//# Evaluate input
		var update = con.prepareUpdate(QueryLanguage.SPARQL, string, this.toString());
		update.setBinding("this", this.resource);
		update.execute();

		this.touchRevision();
		//# FIXME we shouldn't need to touch anything
		var parent = this.SelectParentComposite();
		if (parent) {
			parent.touchRevision();
		}
	</msg:script>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="/callimachus/Serviceable"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.Conflict"/>
	<msg:imports rdf:resource="java:org.openrdf.query.QueryLanguage"/>
	<msg:imports rdf:resource="java:org.callimachusproject.form.helpers.TripleAnalyzer"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.Forbidden"/>
	<calli:realm rdf:resource="/"/>
	<calli:query>describe</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/describe.ttl#deleteInsert">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/sparql-update</calli:type>
	<rdfs:domain rdf:resource="/callimachus/toolbox/describe.ttl#PatchDeleteInsert"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x362">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x363">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:org.openrdf.query.GraphQueryResult"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x364">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x365">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x366">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Composite"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x367">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x368">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x369">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/discussion.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/discussion.ttl#GetDiscussion">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x370"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x371"/>
	<calli:type>application/sparql-results+xml;q=0.1</calli:type>
	<calli:method>GET</calli:method>
	<calli:query>discussion</calli:query>
	<calli:transform rdf:resource="/callimachus/toolbox/discussion.ttl#TransformDiscussion"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		SELECT REDUCED ?label ?note ?revision ?modified ?user ?name
		WHERE {
			{
				$this skos:prefLabel ?label
			} UNION {
				$this rdfs:label ?label
			} UNION {
				GRAPH ?revision { $this skos:editorialNote ?note }
				?revision audit:committedOn ?modified
				OPTIONAL { ?revision audit:contributor ?user
					OPTIONAL { ?user skos:prefLabel ?name }
					OPTIONAL { ?user rdfs:label ?name }
				}
			}
		}
		ORDER BY ?modified
		LIMIT 100
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/discussion.ttl#TransformDiscussion">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x374"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x375"/>
	<calli:type>application/xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/toolbox/discussion.xhtml"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformLayout"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/discussion.ttl#PostDiscussion">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x372"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x373"/>
	<calli:method>POST</calli:method>
	<msg:script>
		var vf = this.objectConnection.valueFactory;
		var lit = vf.createLiteral(form.get('note')[0]);
		this.objectConnection.add(this.resource, editorialNote.resource, lit, []);
		return this.resource + "?discussion";
	</msg:script>
	<msg:imports rdf:resource="http://www.w3.org/2004/02/skos/core#editorialNote"/>
	<calli:realm rdf:resource="/"/>
	<calli:expect>303-see-other</calli:expect>
	<calli:query>discussion</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/discussion.ttl#form">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/x-www-form-urlencoded</calli:type>
	<rdfs:domain rdf:resource="/callimachus/toolbox/discussion.ttl#PostDiscussion"/>
	<rdfs:range rdf:resource="java:java.util.Map"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/discussion.ttl#inputStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/sparql-results+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/toolbox/discussion.ttl#TransformDiscussion"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x370">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x371">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x372">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x373">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x374">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x375">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Editable">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Editable</rdfs:label>
	<rdfs:subClassOf rdf:resource="/callimachus/Serviceable"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/edit.ttl#PostEdit">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x378"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x379"/>
	<calli:type>text/uri-list</calli:type>
	<calli:method>POST</calli:method>
	<msg:script rdf:resource="/callimachus/toolbox/operations.js#postEdit"/>
	<calli:realm rdf:resource="/"/>
	<calli:expect>201-modified</calli:expect>
	<calli:query>edit</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/edit.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/edit.ttl#GetEditPage">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x376"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x377"/>
	<calli:type>application/xhtml+xml</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<msg:script rdf:resource="/callimachus/toolbox/operations.js#getEditPage"/>
	<calli:realm rdf:resource="/"/>
	<calli:query>edit</calli:query>
	<calli:transform rdf:resource="/callimachus/transforms/TransformPage"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/edit.ttl#input">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/sparql-update</calli:type>
	<rdfs:domain rdf:resource="/callimachus/toolbox/edit.ttl#PostEdit"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x376">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Editable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x377">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:javax.xml.stream.XMLEventReader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x378">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Editable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x379">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Editable"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/history.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/history.ttl#GetHistory">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x380"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x381"/>
	<calli:type>application/sparql-results+xml;q=0.1</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<calli:query>history</calli:query>
	<calli:rel>version-history</calli:rel>
	<calli:transform rdf:resource="/callimachus/transforms/TransformIntoAtom"/>
	<calli:transform rdf:resource="/callimachus/toolbox/history.ttl#TransformHistory"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;
		PREFIX skosxl:&lt;http://www.w3.org/2008/05/skos-xl#&gt;
		PREFIX dc:&lt;http://purl.org/dc/elements/1.1/&gt;
		PREFIX dcterms:&lt;http://purl.org/dc/terms/&gt;
		PREFIX foaf:&lt;http://xmlns.com/foaf/0.1/&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT * {
			{
				$this rdfs:label ?title
				BIND (concat(str($this),"?history") as ?id)
				BIND ("feed" as ?type)
			} UNION {
				$this audit:revision [audit:committedOn ?updated]
				BIND (concat(str($this),"?history") as ?id)
				BIND ("feed" as ?type)
			} UNION {
				{
					SELECT ?id (max(?title) as ?title) (max(?updated) as ?updated) (max(?summary) as ?summary) (max(?icon) as ?icon)
							("entry" as ?type) (concat(str(?id),"?view") as ?link_view_href)
							(max(?contributor_uri) as ?contributor_uri) (max(?contributor_name) as ?contributor_name)  {
						?id audit:contributedTo $this; audit:committedOn ?updated .
						OPTIONAL {
							?id audit:contributor ?contributor_uri
							OPTIONAL {
								?contributor_uri rdfs:label ?contributor_name
							}
						} OPTIONAL {
							$this skos:prefLabel ?title
						} OPTIONAL {
							$this foaf:name ?title
						} OPTIONAL {
							$this rdfs:label ?title
						} OPTIONAL {
							$this skosxl:literalForm ?title
						} OPTIONAL {
							$this dcterms:title ?title
						} OPTIONAL {
							GRAPH ?id { $this skos:changeNote ?summary }
						} OPTIONAL {
							$this a [calli:icon ?icon]
						}
					} GROUP BY ?id ORDER BY desc(?updated) LIMIT 50
				}
				FILTER bound(?id)
			}
		} ORDER BY desc(?type) desc(?updated) ?id
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/history.ttl#TransformHistory">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x382"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x383"/>
	<calli:type>application/xhtml+xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/toolbox/history.xsl"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformLayout"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/history.ttl#inputStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/sparql-results+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/toolbox/history.ttl#TransformHistory"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x380">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x381">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x382">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x383">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/introspect.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/introspect.ttl#GetIntrospect">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x384"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x385"/>
	<calli:type>application/xhtml+xml</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		return this.calliIntrospect(this);
	</msg:script>
	<calli:query>introspect</calli:query>
	<calli:transform rdf:resource="/callimachus/transforms/TransformLayout"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x384">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x385">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.ByteArrayOutputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/permissions.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/permissions.ttl#GetPermissions">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x386"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x387"/>
	<calli:type>application/xhtml+xml</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<msg:script>
		return permissions_xhtml.calliConstruct(this);
	</msg:script>
	<msg:imports rdf:resource="/callimachus/toolbox/permissions.xhtml"/>
	<calli:realm rdf:resource="/"/>
	<calli:query>permissions</calli:query>
	<calli:transform rdf:resource="/callimachus/transforms/TransformPage"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/permissions.ttl#GetRdfTypes">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x388"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x389"/>
	<calli:type>text/uri-list</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		function addConcepts(klass, concepts, visited) {
			if (visited.contains(klass))
				return concepts;
			visited.add(klass);
			if (klass.isAnnotationPresent(Iri)) {
				concepts.add(klass.getAnnotation(Iri).value());
			}
			var sup = klass.getSuperclass();
			if (sup) {
				addConcepts(sup, concepts, visited);
			}
			var interfaces = klass.getInterfaces();
			for (var i = 0; i &lt; interfaces.length; i++) {
				addConcepts(interfaces[i], concepts, visited);
			}
			return concepts;
		}
		return addConcepts(this.getClass(), new java.util.TreeSet(), new java.util.HashSet());
	</msg:script>
	<msg:imports rdf:resource="java:org.openrdf.annotations.Iri"/>
	<calli:query>rdftype</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/permissions.ttl#PostPermissions">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x390"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x391"/>
	<calli:method>POST</calli:method>
	<msg:script>
		permissions_xhtml.calliEditResource(this, msg.input);
		var parent = this.SelectParentComposite();
		if (parent) {
			parent.touchRevision();
		}
		return this;
	</msg:script>
	<msg:imports rdf:resource="/callimachus/toolbox/permissions.xhtml"/>
	<calli:realm rdf:resource="/"/>
	<calli:expect>201-modified</calli:expect>
	<calli:query>permissions</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/permissions.ttl#input">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/sparql-update</calli:type>
	<rdfs:domain rdf:resource="/callimachus/toolbox/permissions.ttl#PostPermissions"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/permissions.ttl#PostClassPermissions">
	<msg:script>
		var before = this.calliAdministrator.empty;
		var ret = proceed();
		if (!before) {
			var obj = this.objectConnection.getObject(this.resource);
			if (obj.calliAdministrator.empty) {
				throw new BadRequest("Cannot remove all class administrators");
			}
		}
		var con = this.objectConnection;
		var of = con.objectFactory;
		con.addDesignation(of.createObject(Audit.CURRENT_TRX), SchemaGraph);
		con.recompileSchemaOnClose();
		return ret;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x392"/>
	<msg:imports rdf:resource="/callimachus/SchemaGraph"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.openrdf.sail.auditing.vocabulary.Audit"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDF"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/permissions.ttl#SelectParentComposite">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x395"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x396"/>
	<msg:sparql>
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT ?composite
		WHERE {
			?composite calli:hasComponent $this
		}
		LIMIT 1
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x386">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x387">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:javax.xml.stream.XMLEventReader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x388">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x389">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literalSet"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x390">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x391">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:cardinality rdf:datatype="http://www.w3.org/2001/XMLSchema#integer">1</owl:cardinality>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x392">
	<rdf:first rdf:resource="/callimachus/toolbox/permissions.ttl#PostPermissions"/>
	<rdf:rest rdf:nodeID="node16tas22o6x393"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x393">
	<rdf:first rdf:nodeID="node16tas22o6x394"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x394">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Class"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x395">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x396">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://callimachusproject.org/rdf/2009/framework#Composite"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/related-changes.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/related-changes.ttl#GetRelatedChanges">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x397"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x398"/>
	<calli:type>application/sparql-results+xml;q=0.1</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-store</calli:header>
	<calli:query>relatedchanges</calli:query>
	<calli:transform rdf:resource="/callimachus/transforms/TransformIntoAtom"/>
	<calli:transform rdf:resource="/callimachus/toolbox/related-changes.ttl#TransformRelatedChanges"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;
		PREFIX skosxl:&lt;http://www.w3.org/2008/05/skos-xl#&gt;
		PREFIX dc:&lt;http://purl.org/dc/elements/1.1/&gt;
		PREFIX dcterms:&lt;http://purl.org/dc/terms/&gt;
		PREFIX foaf:&lt;http://xmlns.com/foaf/0.1/&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT * {
			{
				$this rdfs:label ?title
				BIND (concat(str($this),"?relatedchanges") as ?id)
				BIND ("feed" as ?type)
			} UNION {
				$this audit:revision [audit:committedOn ?updated]
				BIND (concat(str($this),"?relatedchanges") as ?id)
				BIND ("feed" as ?type)
			} UNION {
				{
					SELECT ?id (max(?title)  as ?title) (max(?updated) as ?updated) (max(?summary) as ?summary) (max(?icon) as ?icon)
							(?id as ?content_src) (max(?content_type) as ?content_type) ("entry" as ?type)
							(?id as ?link_edit_media_href) (concat(str(?id),"?view") as ?link_view_href) (concat(str(?id),"?history") as ?link_history_href)
							(concat(str(?revision),"?view") as ?link_href) (audit:revision as ?link_rel) ("text/html" as ?link_type)
							(max(?contributor_uri) as ?contributor_uri) (max(?contributor_name) as ?contributor_name)  {
						$this ?rel ?id .
						?id audit:revision ?revision .
						?revision audit:committedOn ?updated .
						OPTIONAL {
							?revision audit:contributor ?contributor_uri
							OPTIONAL {
								?contributor_uri rdfs:label ?contributor_name
							}
						} OPTIONAL {
							?id skos:prefLabel ?title
						} OPTIONAL {
							?id foaf:name ?title
						} OPTIONAL {
							?id rdfs:label ?title
						} OPTIONAL {
							?id skosxl:literalForm ?title
						} OPTIONAL {
							?id dcterms:title ?title
						} OPTIONAL {
							GRAPH ?revision { ?id skos:changeNote ?summary }
						} OPTIONAL {
							?id a [calli:icon ?icon]
						} OPTIONAL {
							?id a [calli:type ?content_type]
						}
					} GROUP BY ?id ?revision ORDER BY desc(?updated) LIMIT 50
				}
				FILTER bound(?id)
			}
		} ORDER BY desc(?type) desc(?updated) ?id
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/related-changes.ttl#TransformRelatedChanges">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x399"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x400"/>
	<calli:type>application/xhtml+xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/toolbox/related-changes.xsl"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformLayout"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/related-changes.ttl#inputStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/sparql-results+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/toolbox/related-changes.ttl#TransformRelatedChanges"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x397">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x398">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x399">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x400">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/resolve-view.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/resolve-view.ttl#ResolveView">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x401"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x402"/>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-store</calli:header>
	<msg:script>
		var con = this.objectConnection;
		var vf = con.valueFactory;

		function canonicalize(uri) {
			uri = uri.normalize();
			var sch = uri.scheme.toLowerCase();
			var frag = uri.fragment;
			if (uri.isOpaque()) {
				return new java.net.URI(sch, uri.schemeSpecificPart, frag);
			} else {
				var auth = uri.authority.toLowerCase();
				return new java.net.URI(sch, auth, uri.path, uri.query, frag);
			}
		}

		function parseAbsoluteURI(string) {
			try {
				if (string.indexOf("/") == 0) {
					var origin = java.net.URI.create(diverted.toString());
					var sch = origin.scheme;
					var auth = origin.authority;
					var uri = java.net.URI.create(string);
					var frag = uri.fragment;
					uri = new java.net.URI(sch, auth, uri.path, uri.query, frag);
					return canonicalize(uri);
				} else {
					var uri = java.net.URI.create(string);
					if (uri.isAbsolute())
						return canonicalize(uri);
					return null;
				}
			} catch (e) {
				throw new BadRequest(e);
			}
		}

		function redirectURL(uri) {
			var origin = uri.authority ? new java.net.URI(uri.scheme, uri.authority, "/", null, null).toASCIIString() : null;
			var iri = uri.toASCIIString();
			var viewable = con.getObject(iri) instanceof Viewable;
			var Origin = vf.createURI("http://callimachusproject.org/rdf/2009/framework#Origin");
			var authority = origin &amp;&amp; con.hasStatement(vf.createURI(origin), RDF.TYPE, Origin, []);
			if (viewable &amp;&amp; authority &amp;&amp; (uri.query || uri.fragment)) { //# complex resource URI
				return origin + "diverted;" + URLEncoder.encode(iri) + '?view';
			} else if (viewable &amp;&amp; authority) { //# Self resolving URL
				return iri + '?view';
			} else if (viewable) { //# Foreign IRI, but can be presented here
				return diverted.toString() + ";" + URLEncoder.encode(iri) + '?view';
			} else { //# Unknown resource
				return iri;
			}
		}

		if (q) {
			var uri = parseAbsoluteURI(q);
			if (uri) //# absolute URI redirect
				return redirectURL(uri);
		}
		return null; //# 404
	</msg:script>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="/callimachus/Viewable"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDF"/>
	<msg:imports rdf:resource="java:java.net.URLEncoder"/>
	<msg:imports rdf:resource="/diverted"/>
	<calli:expect>302-found</calli:expect>
	<calli:query>q</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/resolve-view.ttl#q">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/toolbox/resolve-view.ttl#ResolveView"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
	<calli:query>q</calli:query>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x401">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/view"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x402">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/search.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/search.ttl#AuthorizeSearchFolder">
	<owl:intersectionOf rdf:nodeID="node16tas22o6x403"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX owl:&lt;http://www.w3.org/2002/07/owl#&gt;
		PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;
		PREFIX skosxl:&lt;http://www.w3.org/2008/05/skos-xl#&gt;
		PREFIX dc:&lt;http://purl.org/dc/elements/1.1/&gt;
		PREFIX dcterms:&lt;http://purl.org/dc/terms/&gt;
		PREFIX foaf:&lt;http://xmlns.com/foaf/0.1/&gt;
		PREFIX keyword:&lt;http://www.openrdf.org/rdf/2011/keyword#&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		ASK {
			?accounts calli:authNamespace [calli:hasComponent $credential]
			FILTER ($method = "GET" || $method = "HEAD")
			FILTER (substr($query,1,2) = "q=")
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/search.ttl#SearchDescription">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x406"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x407"/>
	<calli:type>application/opensearchdescription+xml</calli:type>
	<calli:method>GET</calli:method>
	<msg:script>
		var sb = [];
		sb.push('&lt;?xml version="1.0" encoding="UTF-8"?&gt;');
		sb.push('&lt;OpenSearchDescription xmlns="http://a9.com/-/spec/opensearch/1.1/"&gt;');
		sb.push('&lt;ShortName&gt;' + this.rdfsLabel + '&lt;/ShortName&gt;');
		sb.push('&lt;Url type="application/atom+xml" template="' + this + '?q={searchTerms}"/&gt;');
		sb.push('&lt;/OpenSearchDescription&gt;');
		var xml = sb.join('\n');
		return new java.io.ByteArrayInputStream(new java.lang.String(xml).getBytes("UTF-8"));
	</msg:script>
	<calli:query>search</calli:query>
	<calli:rel>search</calli:rel>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/search.ttl#SearchFolder">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x408"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x409"/>
	<calli:type>application/sparql-results+xml;q=0.1</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-store</calli:header>
	<calli:realm rdf:resource="/"/>
	<calli:query>q</calli:query>
	<calli:transform rdf:resource="/callimachus/transforms/TransformIntoAtom"/>
	<calli:transform rdf:resource="/callimachus/toolbox/search.ttl#TransformSearchFolder"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX owl:&lt;http://www.w3.org/2002/07/owl#&gt;
		PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;
		PREFIX skosxl:&lt;http://www.w3.org/2008/05/skos-xl#&gt;
		PREFIX dc:&lt;http://purl.org/dc/elements/1.1/&gt;
		PREFIX dcterms:&lt;http://purl.org/dc/terms/&gt;
		PREFIX foaf:&lt;http://xmlns.com/foaf/0.1/&gt;
		PREFIX keyword:&lt;http://www.openrdf.org/rdf/2011/keyword#&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT * {
			{
				$this rdfs:label ?title
				BIND (concat(str($this),"?q=",encode_for_uri($q)) as ?id)
				BIND ("feed" as ?type)
			} UNION {
				$this audit:revision [audit:committedOn ?updated]
				BIND (concat(str($this),"?q=",encode_for_uri($q)) as ?id)
				BIND ("feed" as ?type)
			} UNION {
				{
					SELECT DISTINCT (max(?label) as ?title) (max(?comment) as ?summary) (max(?icon) as ?icon) (?url as ?id) (max(?modified) as ?updated) (max(?content_type) as ?content_type)
					WHERE {
						{
							?url keyword:phone ?soundex
							FILTER sameTerm(?soundex, keyword:soundex($q))
							FILTER (isIRI(?url))
							FILTER (
								strstarts(str(?url), str($this)) ||
								$this = &lt;/&gt; &amp;&amp; (
									EXISTS {
										{
											?realm a &lt;../Origin&gt;
											FILTER strstarts(str(?url), str(?realm))
										} UNION {
											?realm a &lt;../Realm&gt;
											FILTER strstarts(str(?url), str(?realm))
										} UNION {
											&lt;../Serviceable&gt; owl:equivalentClass rdfs:Resource
										}
									}
								)
							)
						} OPTIONAL {
							?url skos:prefLabel ?label
						} OPTIONAL {
							?url foaf:name ?label
						} OPTIONAL {
							?url rdfs:label ?label
						} OPTIONAL {
							?url skosxl:literalForm ?label
						} OPTIONAL {
							?url dcterms:title ?label
						}
						FILTER EXISTS {
							?url ?p ?string
							FILTER regex(?string, keyword:regex($q))
						}
						OPTIONAL { ?url a [calli:icon ?icon] }
						OPTIONAL { ?url rdfs:comment ?comment }
						OPTIONAL { ?url audit:revision ?revision
							OPTIONAL { ?revision audit:committedOn ?modified }
						} OPTIONAL {
							?id a [calli:type ?content_type]
						}
					}
					GROUP BY ?url
					ORDER BY ?title ?id ?icon
					LIMIT 100
				}
				FILTER (bound(?id))
				BIND ("entry" as ?type)
				BIND (concat(str(?id),"?view") as ?link_href)
				BIND ("alternate" as ?link_rel)
				BIND ("text/html" as ?link_type)
				BIND (?id as ?content_src)
			}
		}
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/search.ttl#TransformSearchFolder">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x410"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x411"/>
	<calli:type>application/xhtml+xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/toolbox/search.xsl"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformLayout"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/search.ttl#q">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/toolbox/search.ttl#SearchFolder"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
	<calli:query>q</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/search.ttl#inputStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/sparql-results+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/toolbox/search.ttl#TransformSearchFolder"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x403">
	<rdf:first rdf:resource="http://callimachusproject.org/rdf/2009/framework#IsAuthorized"/>
	<rdf:rest rdf:nodeID="node16tas22o6x404"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x404">
	<rdf:first rdf:nodeID="node16tas22o6x405"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x405">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Realm"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x406">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Realm"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x407">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x408">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Realm"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x409">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x410">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Realm"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x411">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/view.ttl#GetViewPage">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x412"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x413"/>
	<calli:type>application/xhtml+xml</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<msg:script rdf:resource="/callimachus/toolbox/operations.js#getViewPage"/>
	<calli:query>view</calli:query>
	<calli:rel>alternate</calli:rel>
	<calli:transform rdf:resource="/callimachus/transforms/TransformPage"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Viewable">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Viewable</rdfs:label>
	<rdfs:subClassOf rdf:resource="/callimachus/Serviceable"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/view.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x412">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Viewable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x413">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:javax.xml.stream.XMLEventReader"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/what-links-here.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/what-links-here.ttl#GetWhatLinksHere">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x414"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x415"/>
	<calli:type>application/sparql-results+xml;q=0.1</calli:type>
	<calli:method>GET</calli:method>
	<calli:query>whatlinkshere</calli:query>
	<calli:transform rdf:resource="/callimachus/toolbox/what-links-here.ttl#TransformWhatLinksHere"/>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT DISTINCT ?label ?comment ?icon ?url ?modified
		WHERE {
			?url ?rel $this
			FILTER (isIRI(?url))
			FILTER (?rel != audit:contributor)
			OPTIONAL { ?url a [calli:icon ?icon] }
			OPTIONAL { ?url skos:prefLabel ?label }
			OPTIONAL { ?url rdfs:label ?label }
			OPTIONAL { ?url rdfs:comment ?comment }
			OPTIONAL { ?url audit:revision ?revision
				OPTIONAL { ?revision audit:committedOn ?modified }
			}
		}
		ORDER BY ?label ?url ?icon
		LIMIT 100
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/what-links-here.ttl#TransformWhatLinksHere">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x416"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x417"/>
	<calli:type>application/xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/toolbox/what-links-here.xsl"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformLayout"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/toolbox/what-links-here.ttl#inputStream">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdfs:domain rdf:resource="/callimachus/toolbox/what-links-here.ttl#TransformWhatLinksHere"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x414">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x415">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x416">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x417">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transform.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/Transform">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>Transform</rdfs:label>
	<rdfs:comment>Transform files</rdfs:comment>
	<rdfs:subClassOf rdf:resource="/callimachus/File"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/transform.png"/>
	<calli:view rdf:resource="/callimachus/transform-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/transform-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/transform-create.xhtml"/>
	<calli:type>text/xsl</calli:type>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transform.ttl#GetTransform">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x418"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x419"/>
	<calli:type>text/xsl</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<calli:header>cache-control:cache-range</calli:header>
	<msg:script>return this.openReader(true)</msg:script>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transform.ttl#LookupTransformFile">
	<msg:script>
		if (type == "application/xslt+xml" || type == "text/xsl") {
			var uri = this.toUri().resolve("/callimachus/Transform").toString();
			return this.objectConnection.getObject(uri);
		}
		return proceed();
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x420"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transform.ttl#CreateTransform">
	<msg:script>
		var con = this.objectConnection;
		var vf = con.valueFactory;
		if (!location)
			throw new BadRequest("Missing location request header");
		if (location instanceof File) {
			location = location.RemoveFile();
		}
		var created = location;

		var filename = created.resource.localName.replace(/([a-zA-Z_0-9])\.[a-zA-Z]+$/, "$1");
		var label = vf.createLiteral(URLDecoder.decode(filename, "UTF-8").replace(/-/g, " "));
		con.add(created.resource, RDFS.LABEL, label, []);

		created = con.addDesignation(created, this.toString());
		created = con.addDesignation(created, Document);

		created.UploadTransform(new java.io.InputStreamReader(body, "UTF-8"));
		return created;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x423"/>
	<msg:imports rdf:resource="http://xmlns.com/foaf/0.1/Document"/>
	<msg:imports rdf:resource="/callimachus/File"/>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.InternalServerError"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transform.ttl#UploadTransform">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x426"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x427"/>
	<calli:method>PUT</calli:method>
	<msg:script>
		if (!reader)
			throw new BadRequest("Missing PUT request payload");
		var read;
		var buf = java.lang.reflect.Array.newInstance(java.lang.Character.TYPE, 1024);
		var out = this.openWriter();
		try {
			while ((read = reader.read(buf)) &gt;= 0) {
				out.write(buf, 0, read);
			}
		} finally {
			out.close();
		}
		this.touchRevision();
	</msg:script>
	<msg:imports rdf:resource="java:org.openrdf.model.vocabulary.RDFS"/>
	<msg:imports rdf:resource="java:java.net.URLDecoder"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.HTTPObjectServer"/>
	<msg:imports rdf:resource="java:org.openrdf.query.QueryLanguage"/>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transform.ttl#reader">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>text/xsl</calli:type>
	<rdfs:domain rdf:resource="/callimachus/transform.ttl#UploadTransform"/>
	<rdfs:range rdf:resource="java:java.io.Reader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x418">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Transform"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x419">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.Reader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x420">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#LookupConstructor"/>
	<rdf:rest rdf:nodeID="node16tas22o6x421"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x421">
	<rdf:first rdf:nodeID="node16tas22o6x422"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x422">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/File"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x423">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x424"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x424">
	<rdf:first rdf:nodeID="node16tas22o6x425"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x425">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/Transform"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x426">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Transform"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x427">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2002/07/owl#Nothing"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transforms/TransformLayout">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x432"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x433"/>
	<calli:type>application/xhtml+xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/template.xsl"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformPage"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transforms/TransformPage">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x434"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x435"/>
	<calli:type>application/xhtml+xml</calli:type>
	<msg:xslt rdf:resource="/callimachus/transforms/page.xsl"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformXhtml"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transforms/TransformIntoAtom">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x428"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x429"/>
	<calli:type>application/atom+xml;q=0.5</calli:type>
	<msg:xslt rdf:resource="/callimachus/transforms/sparql-results-atom.xsl"/>
	<calli:transform rdf:resource="/callimachus/transforms/TransformAtomLinks"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transforms/index.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transforms/TransformAtomLinks">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x430"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x431"/>
	<calli:type>application/atom+xml;q=0.5</calli:type>
	<msg:xslt rdf:resource="/callimachus/transforms/divert-atom-links.xsl"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transforms/TransformIntoAtom#sparqlResult">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/sparql-results+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/transforms/TransformIntoAtom"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transforms/TransformAtomLinks#xml">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/atom+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/transforms/TransformAtomLinks"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transforms/TransformLayout#xml">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/xhtml+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/transforms/TransformLayout"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transforms/TransformXhtml">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x436"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x437"/>
	<calli:type>text/html</calli:type>
	<msg:xslt rdf:resource="/callimachus/transforms/xhtml-to-html.xsl"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transforms/TransformPage#query">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/transforms/TransformPage"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
	<calli:query>*</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transforms/TransformPage#xhtml">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/xhtml+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/transforms/TransformPage"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transforms/TransformXhtml#xhtml">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/xhtml+xml</calli:type>
	<rdfs:domain rdf:resource="/callimachus/transforms/TransformXhtml"/>
	<rdfs:range rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transforms/index.ttl#ResourceInfo">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x438"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x439"/>
	<calli:type>application/sparql-results+xml</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-store</calli:header>
	<msg:sparql>
		PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
		PREFIX rdfs:&lt;http://www.w3.org/2000/01/rdf-schema#&gt;
		PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;
		PREFIX skosxl:&lt;http://www.w3.org/2008/05/skos-xl#&gt;
		PREFIX dc:&lt;http://purl.org/dc/elements/1.1/&gt;
		PREFIX dcterms:&lt;http://purl.org/dc/terms/&gt;
		PREFIX foaf:&lt;http://xmlns.com/foaf/0.1/&gt;
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		PREFIX calli:&lt;http://callimachusproject.org/rdf/2009/framework#&gt;
		SELECT DISTINCT ?updated ?iri ?label {
			{
				?term audit:revision [audit:committedOn ?updated]
				FILTER sameTerm(?term,iri($resource))
			} UNION {
				?iri calli:hasComponent* ?term
				FILTER sameTerm(?term,iri($resource))
				OPTIONAL {
					?iri skos:prefLabel ?label
				} OPTIONAL {
					?iri foaf:name ?label
				} OPTIONAL {
					?iri rdfs:label ?label
				} OPTIONAL {
					?iri skosxl:literalForm ?label
				} OPTIONAL {
					?iri dcterms:title ?label
				}
			}
		} ORDER BY ?iri
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/transforms/index.ttl#resource">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<rdfs:domain rdf:resource="/callimachus/transforms/index.ttl#ResourceInfo"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
	<calli:query>*</calli:query>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x428">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x429">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x430">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x431">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x432">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x433">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x434">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x435">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x436">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/Serviceable"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x437">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.Reader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x438">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/transforms/page-info"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x439">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:java.io.InputStream"/>
</rdf:Description>

<rdf:Description rdf:about="http://www.w3.org/2000/01/rdf-schema#label">
	<rdf:type rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"/>
</rdf:Description>

<rdf:Description rdf:about="http://www.w3.org/2000/01/rdf-schema#comment">
	<rdf:type rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/User">
	<rdf:type rdf:resource="/callimachus/Creatable"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdfs:label>User</rdfs:label>
	<rdfs:comment>Username and password associated with an email address</rdfs:comment>
	<rdfs:subClassOf rdf:resource="http://callimachusproject.org/rdf/2009/framework#User"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Viewable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Editable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Composite"/>
	<rdfs:isDefinedBy rdf:resource="/callimachus"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:icon rdf:resource="/callimachus/user.png"/>
	<calli:view rdf:resource="/callimachus/user-view.xhtml"/>
	<calli:edit rdf:resource="/callimachus/user-edit.xhtml"/>
	<calli:create rdf:resource="/callimachus/user-create.xhtml"/>
	<calli:realm rdf:resource="/"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/user.ttl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/user.ttl#PostUserCreate">
	<msg:script>
		var ds = new ByteArrayDataSource(body, "multipart/form-data") ;
		var multipart = new MimeMultipart(ds);
		//# read form
		var username = multipart.getBodyPart(0).content;
		var email = multipart.getBodyPart(1).content;
		var label = multipart.getBodyPart(2).content;
		var comment = multipart.getBodyPart(3).content;
		var subject = multipart.getBodyPart(4).content;
		var body5 = multipart.getBodyPart(5).content;
		if (!label)
			throw new BadRequest("Missing label");
		if (!username)
			throw new BadRequest("Missing name");
		if (!email)
			throw new BadRequest("Missing email");
		if (!subject)
			throw new BadRequest("Missing subject");
		if (!body5)
			throw new BadRequest("Missing message");

		var newUser = location;
		if (!newUser)
			throw new BadRequest("Missing resource location");
		if (newUser instanceof User)
			throw new Conflict("User already exists: " + newUser);
		if (username.toLowerCase() != username)
			throw new BadRequest("Username must be in lowercase");
		if (URLEncoder.encode(username, "UTF-8") != username)
			throw new BadRequest("Invalid username: '" + username + "'");
		if (newUser.resource.localName != username)
			throw new BadRequest("Invalid username: '" + username + "'");

		var folder = location.resource.namespace;
		var con = this.objectConnection;
		var vf = con.valueFactory;
		if (!con.hasStatement(null, vf.createURI("http://callimachusproject.org/rdf/2009/framework#authNamespace"), vf.createURI(folder), []))
			throw new BadRequest("Cannot create a user here");
		newUser = con.addDesignation(newUser, User);
		newUser = con.addDesignation(newUser, "http://callimachusproject.org/rdf/2009/framework#Party");
		newUser = con.addDesignation(newUser, "http://callimachusproject.org/rdf/2009/framework#User");

		//# populate resource
		newUser.calliName = username;
		newUser.calliEmail = email;
		newUser.rdfsLabel.add(label);
		if (comment) {
			newUser.rdfsComment.add(comment);
		}

		//# generate and save a password
		var password = accounts.generatePassword();
		var token = username + ":" + accounts.calliAuthName + ":" + password;
		newUser.calliAlgorithm = "MD5";
		newUser.calliEncoded = DigestUtils.md5(new java.lang.String(token).getBytes("UTF-8"));
		//# email the password to the email address provided
		var fromUser = newUser.FindUserCreator();
		if (!fromUser || !fromUser.sendMessage)
			throw new BadRequest("Could not find administrator");
		body5 = body5.replace(/@@PASSWORD@@/g, password);
		fromUser.sendMessage(subject + '\n' + body5, label + " &lt;" + email + "&gt;");
		return newUser;
	</msg:script>
	<owl:intersectionOf rdf:nodeID="node16tas22o6x440"/>
	<msg:imports rdf:resource="/accounts"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.apache.commons.codec.digest.DigestUtils"/>
	<msg:imports rdf:resource="java:java.net.URLEncoder"/>
	<msg:imports rdf:resource="java:javax.mail.util.ByteArrayDataSource"/>
	<msg:imports rdf:resource="java:javax.mail.internet.MimeMultipart"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.Conflict"/>
	<msg:imports rdf:resource="/callimachus/User"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/user.ttl#FindUserCreator">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x443"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x444"/>
	<msg:sparql>
		PREFIX audit:&lt;http://www.openrdf.org/rdf/2009/auditing#&gt;
		SELECT ?contributor
		WHERE {
			{
				audit:current-trx audit:contributor ?contributor
			} UNION {
				GRAPH ?graph { $this a ?type }
				?graph audit:contributor ?contributor
			}
		} LIMIT 1
	</msg:sparql>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/user.ttl#GetUserPasswordPage">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x445"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x446"/>
	<calli:type>application/xhtml+xml</calli:type>
	<calli:method>GET</calli:method>
	<calli:header>cache-control:no-cache</calli:header>
	<msg:script>
		return user_password_xhtml.calliConstruct(this);
	</msg:script>
	<msg:imports rdf:resource="/callimachus/pages/user-password.xhtml"/>
	<calli:realm rdf:resource="/"/>
	<calli:query>password</calli:query>
	<calli:transform rdf:resource="/callimachus/transforms/TransformPage"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/user.ttl#PostUserPassword">
	<rdfs:subClassOf rdf:resource="http://www.openrdf.org/rdf/2011/messaging#Message"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x447"/>
	<rdfs:subClassOf rdf:nodeID="node16tas22o6x448"/>
	<calli:method>POST</calli:method>
	<msg:script>
		var credential = accounts.findCredential(authorization);
		//# read form
		var email = form.get("email") ? form.get("email")[0] : null;
		var current = form.get("current") ? form.get("current")[0] : null;
		var password = form.get("password") ? form.get("password")[0] : null;
		if (this.toString().equals(credential.toString())) {
			//# check if they know their own password
			if (!current)
				throw new BadRequest("What is your current password?");
			var encoded = Hex.decodeHex(new java.lang.String(current).toCharArray());
			if (!java.util.Arrays.equals(this.calliEncoded, encoded))
				throw new BadRequest("That is not your current password");
		}
		//# save email
		if (email &amp;&amp; email != this.calliEmail) {
			this.calliEmail = email;
		}
		//# save password
		if (password) {
			this.calliEncoded = Hex.decodeHex(new java.lang.String(password).toCharArray());
		}
		return this + "?view";
	</msg:script>
	<msg:imports rdf:resource="/accounts"/>
	<msg:imports rdf:resource="java:org.callimachusproject.server.exceptions.BadRequest"/>
	<msg:imports rdf:resource="java:org.apache.commons.codec.binary.Hex"/>
	<calli:realm rdf:resource="/"/>
	<calli:expect>201-modified</calli:expect>
	<calli:query>password</calli:query>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/user.ttl#form">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#ObjectProperty"/>
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
	<calli:type>application/x-www-form-urlencoded</calli:type>
	<rdfs:domain rdf:resource="/callimachus/user.ttl#PostUserPassword"/>
	<rdfs:range rdf:resource="java:java.util.Map"/>
</rdf:Description>

<rdf:Description rdf:about="/callimachus/user.ttl#authorization">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#DatatypeProperty"/>
	<calli:header>Authorization</calli:header>
	<calli:header>Cookie</calli:header>
	<rdfs:domain rdf:resource="/callimachus/user.ttl#PostUserPassword"/>
	<rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x440">
	<rdf:first rdf:resource="/callimachus/toolbox/create.ttl#PostCreate"/>
	<rdf:rest rdf:nodeID="node16tas22o6x441"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x441">
	<rdf:first rdf:nodeID="node16tas22o6x442"/>
	<rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x442">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:hasValue rdf:resource="/callimachus/User"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x443">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/User"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x444">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="http://callimachusproject.org/rdf/2009/framework#User"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x445">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/User"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x446">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#object"/>
	<owl:allValuesFrom rdf:resource="java:javax.xml.stream.XMLEventReader"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x447">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#target"/>
	<owl:allValuesFrom rdf:resource="/callimachus/User"/>
</rdf:Description>

<rdf:Description rdf:nodeID="node16tas22o6x448">
	<owl:onProperty rdf:resource="http://www.openrdf.org/rdf/2011/messaging#literal"/>
	<owl:allValuesFrom rdf:resource="http://www.w3.org/2001/XMLSchema#string"/>
</rdf:Description>

<rdf:Description rdf:about="/notes/Note.owl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/notes/Note">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdf:type rdf:resource="/callimachus/Class"/>
	<rdfs:label>Note</rdfs:label>
	<calli:reader rdf:resource="/group/users"/>
	<calli:editor rdf:resource="/group/staff"/>
	<calli:administrator rdf:resource="/group/admin"/>
	<rdfs:comment>Daily meeting notes taken in or after a meeting</rdfs:comment>
	<rdfs:subClassOf rdf:resource="/callimachus/Viewable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Editable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Composite"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Local"/>
	<calli:author rdf:resource="/group/users"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:view rdf:resource="/notes/note-view.xhtml"/>
	<calli:edit rdf:resource="/notes/note-edit.xhtml"/>
	<calli:create rdf:resource="/notes/note-create.xhtml"/>
</rdf:Description>

<rdf:Description rdf:about="/notes/Journal.owl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/notes/Journal">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdf:type rdf:resource="/callimachus/Class"/>
	<rdfs:label>Journal</rdfs:label>
	<calli:reader rdf:resource="/group/users"/>
	<calli:editor rdf:resource="/group/staff"/>
	<calli:administrator rdf:resource="/group/admin"/>
	<rdfs:comment>Collection of team's meeting notes</rdfs:comment>
	<rdfs:subClassOf rdf:resource="/callimachus/Viewable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Editable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Composite"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Local"/>
	<calli:author rdf:resource="/group/users"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:view rdf:resource="/notes/journal-view.xhtml"/>
	<calli:edit rdf:resource="/notes/journal-edit.xhtml"/>
	<calli:create rdf:resource="/notes/journal-create.xhtml"/>
</rdf:Description>

<rdf:Description rdf:about="/notes/Topic.owl">
	<rdf:type rdf:resource="/callimachus/SchemaGraph"/>
</rdf:Description>

<rdf:Description rdf:about="/notes/Topic">
	<rdf:type rdf:resource="http://www.w3.org/2002/07/owl#Class"/>
	<rdf:type rdf:resource="/callimachus/Class"/>
	<rdfs:label>Topic</rdfs:label>
	<calli:reader rdf:resource="/group/users"/>
	<calli:editor rdf:resource="/group/staff"/>
	<calli:administrator rdf:resource="/group/admin"/>
	<rdfs:comment>Topic discussed in a meeting</rdfs:comment>
	<rdfs:subClassOf rdf:resource="/callimachus/Viewable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Editable"/>
	<rdfs:subClassOf rdf:resource="/callimachus/Local"/>
	<calli:author rdf:resource="/group/users"/>
	<calli:author rdf:resource="/group/staff"/>
	<calli:author rdf:resource="/group/admin"/>
	<calli:view rdf:resource="/notes/topic-view.xhtml"/>
	<calli:edit rdf:resource="/notes/topic-edit.xhtml"/>
	<calli:create rdf:resource="/notes/topic-create.xhtml"/>
</rdf:Description>

</rdf:RDF>
