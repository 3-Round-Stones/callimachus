<?xml version="1.0" encoding="UTF-8" ?>
<?xml-stylesheet type="text/xsl" href="../../layout/template.xsl"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
	xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
	xmlns:calli="http://callimachusproject.org/rdf/2009/framework#"
	xmlns:xsd="http://www.w3.org/2001/XMLSchema#">
	<head>
		<title>Administrator Account</title>
		<link type="text/css" href="/accounts/jquery.validate.password.css" rel="stylesheet" />	
		<script src="/accounts/jquery.validate.password.js">
		</script>
		<script src="/accounts/md5.js">
		</script>
		<script>//<![CDATA[
			function savePassword() {
				var value = document.getElementById("password").value
				var name = document.getElementById("username").value
				var realm = document.getElementById("realm-link").href
				var encoded = hex_md5(name + ':' + realm + ':' + value)
				var input = document.getElementById("algorithm-input")
				if (input) {
					input.setAttribute("property", "calli:algorithm")
					input.setAttribute("content", "MD5")
					input = document.getElementById("encoded-input")
					input.setAttribute("property", "calli:encoded")
					input.setAttribute("content", encoded)
					input.setAttribute("datatype", "xsd:hexBinary")
				} else {
					setTimeout(function() {savePassword(value)}, 500);
				}
			}
			$(document).ready(function() {
				$("form[about]").bind("calliRedirect", function(event) {
					// remove bogus data
					if (window.sessionStorage) {
						sessionStorage.removeItem('Profile')
					}
					if (window.localStorage) {
						localStorage.removeItem('Authorization')
					}
					jQuery.ajax({ async: false, type: 'GET', url: event.location,
						username: this.elements['username'].value,
						password: this.elements['password'].value
					})
				})
			});
			// ]]>
		</script>
	</head>
	<body>
		<ul class="aside">
			<li>The username cannot be changed once the created</li>
			<li>Provide your full name for identification</li>
			<li>The password can be changed using the settings link</li>
			<li><label>Choosing a good password</label>
				<ul>
					<li>Don't give your password to colleagues, friends, or family members, even when asked.</li>
					<li>Don't choose passwords that relate to you as a person.</li>
					<li>Don't use your last name, your wife's name, the name of your cat, the date of birth, your favourite flower etc.</li>
					<li>Don't use single word passwords, use complex multiple word pass phrases.</li>
				</ul>
			</li>
		</ul>
		<h1>Initial Setup</h1>
		<form action="" about="?this" autocomplete="off" onsubmit="savePassword()">
			<div rel="rdf:type" resource="/accounts/user/User" />
			<span style="display:none">
				<span data-cardinality="1">
					<input id="encoded-input" type="hidden" property="calli:encoded" />
				</span>
				<span data-cardinality="1">
					<input id="algorithm-input" type="hidden" property="calli:algorithm" />
				</span>
				<a id="realm-link" href="/" />
			</span>
			<label for="username">Username</label>
			<div data-cardinality="1">
				<input id="username" property="calli:name" type="text" class="auto-expand"
					onchange="$(form).attr('about', '../user/' + encodeURI(value).replace(/%20/g,'+').toLowerCase())" />
			</div>
			<label for="name">Full name</label>
			<div data-cardinality="1">
				<input id="name" property="rdfs:label" type="text" class="required auto-expand" />
			</div>
			<label for="password">Password</label>
			<div>
				<input id="password" type="password" password="#username" onkeyup="$(this).valid()" />
				<div class="password-meter">
					<label for="password" class="password-meter-message" />
					<div class="password-meter-bg">
						<div class="password-meter-bar"></div>
					</div>
				</div>
			</div>
			<button id="submit" type="submit">Create</button>
			<button id="cancel" type="button" onclick="location.replace('/')">Cancel</button>
		</form>
	</body>
</html>
